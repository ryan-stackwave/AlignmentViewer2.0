{"version":3,"sources":["common/Utils.ts","common/MolecularStyles.ts","common/SequenceLogoGlyphs.tsx","common/Residues.ts","common/Alignment.ts","common/ScrollSync.ts","common/AceAlignmentMode.ts","components/SequenceLogoComponent.tsx","components/SequenceBarplotComponent.tsx","components/AlignmentCanvasComponent.tsx","components/MiniMapComponent.tsx","components/AceEditorComponent.tsx","components/AceMultipleSequenceAlignmentComponent.tsx","components/AceConsensusSequenceComponent.tsx","components/AceTargetSequenceComponent.tsx","components/AceTextualRulerComponent.tsx","components/AlignmentViewerComponent.tsx","components/FileInputComponent.tsx","components/ExampleFileComponent.tsx","App.tsx","serviceWorker.js","index.js","common/MolecularStyles.module.scss"],"names":["stringToColor","str","ctx","document","createElement","getContext","fillStyle","hex","replace","m","r","g","b","rgbaResult","exec","rgb","red","parseInt","green","blue","mapGroupBy","items","fn","reduce","acc","item","key","existing","get","set","Map","ALL_AMINOACID_COLORSCHEMES","assembleColorSchemes","ALL_NUCLEOTIDE_COLORSCHEMES","moleculeType","Object","keys","styles","styleName","indexOf","colorSchemeName","split","colorOrder","hexValues","description","push","commonName","className","backgroundAlpha","parseFloat","colors","fromEntries","map","_","i","AlignmentTypes","allColorSchemes","list","find","at","AMINOACID","aaAlignTypeClass","NUCLEOTIDE","ntAlignTypeClass","PositionsToStyle","ALL","styPosAllClass","QUERY","styPosQueryClass","QUERY_DIFF","styPosQueryDiffClass","CONSENSUS","styPosConsensusClass","CONSENSUS_DIFF","styPosConsensusDiffClass","ResidueDetailTypes","BOTH","LETTER_ONLY","transparentBackgroundClass","BACKGROUND_ONLY","transparentLetterClass","AlignmentStyle","alignmentType","colorScheme","positionsToStyle","residueDetail","AminoAcidAlignmentStyle","NucleotideAlignmentStyle","aceResidueParentClass","generateFastClassLookup","isForAceItself","ALL_POSSIBLE_CHARS","String","fromCharCode","letter","letterInClass","prefix","acePrefix","preAceConsensusClass","preAceQueryClass","LETTER_CLASS_NAMES","LETTER_CLASS_NAMES_FOR_ACE","getLetterClassNames","isConsensus","isQuery","forAceItself","GlyphFactory","letterToGlyphHM","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","singleton","props","d","transform","fill","cx","cy","stroke","strokeOpacity","fillOpacity","strokeWidth","AminoAcid","singleLetterCode","threeLetterCode","fullName","glyph","this","glyphFromChar","cs","colorPair","entries","aa","colorString","colorInfo","hexString","bySingleLetterCode","UNKNOWN","byThreeLetterCode","canonicalAminoAcids","DistanceFunctions","Nucleotide","toUpperCase","allNucleotides","SequenceSortOptions","isTargetSequenceDependent","distanceFn","INPUT","HAMMING_DIST_TARGET","hamming","ScrollType","Alignment","name","sequencesAsInput","uuid","aceEditorMode","predictedNT","sequences","targetSequence","positionalLetterCounts","globalAlphaLetterCounts","allUpperAlphaLettersSorted","consensus","c","window","crypto","getRandomValues","Uint8Array","toString","start","Date","allLetters","sequenceIdx","length","seq","sequence","positionIdx","letterIsAlpha","match","fromSingleLetterCode","position","letterCounts","sort","arr","value","Array","from","topLetter","a","aIsLetter","bIsLetter","occurrences","console","log","getTime","fileName","fileContents","fastaSplitCaret","seqArr","seqObj","id","slice","join","seq1","seq2","distFn","minLength","distance","Error","validLetters","totalCounts","includes","mode","alignment","modeSplit","modeName","ace","define","require","exports","module","oop","TextHighlightRules","AlignmentHighlightRules","rules","re","stateName","nextStateName","getMaxSequenceLength","token","getConsensus","getTargetSequence","regex","next","$rules","inherits","TextMode","Mode","Tokenizer","$tokenizer","getRules","call","prototype","defineNewAlignmentMode","isNaN","normalize","normalizeLetterCounts","getSequences","asFraction","acc2","sortBy","forceReSort","has","sortByDistanceToTargetSequence","newTarget","undefined","forEach","inputSequences","s","getSequenceDistance","LOGO_TYPES","ScrollSync","scrollDirection","aceEditorDirection","scrollers","scrollFnHandles","handleScroll","scroller","event","filter","possibleSib","siblingScroller","syncScrollPosition","horizontal","addEventListener","addScrollEvents","removeScrollEvents","parentElem","x","newScrollLeft","isAceEditor","session","getScrollLeft","scrollLeft","setScrollLeft","newScrollTop","getScrollTop","scrollTop","setScrollTop","bind","scrollFn","on","off","removeEventListener","SequenceLogoComponent","scrollerDiv","loaded","e","logoLoaded","nextProps","logoType","glyphWidth","getPositionalLetterCounts","lettersSorted","getSortedUpperAlphaLetters","frequencies","totalCountAtPosition","total","frequenciesAtPosition","freq","sortedAlphabet","classNames","logoData","frequency","letterIdx","totalWidth","ref","divLoaded","preserveAspectRatio","viewBox","style","width","height","xmlns","singlePositionData","positionalFrequencies","dy","idx","BARS","xscale","generateStack","React","Component","defaultProps","LETTERS","SequenceBarplotComponent","cache","state","svgHovered","positionsSelected","handleSvgHover","handlePositionHover","handlePositionClicked","isHovered","setState","onPositionMouseEnter","onPositionMouseLeave","relatedTarget","getBars","barsGroupedByPosition","positionHovered","element","bars","onPositionSelectionChanged","newPositionsSelected","some","p","allHeights","bar","overallMinHeight","Math","min","overallMaxHeight","max","minHeight","maxHeight","dataSeries","plotOptions","fixYMax","normalizedHeight","POSITION_VIEWBOX_HEIGHT","maxSeqLength","allBars","ds","getPositionalInfo","groupBy","categoryBars","normalizeBarHeights","flat","barsGroupedByDataseries","barsObj","effect","type","border","getContent","pos","posInt","barsAtPostion","posPlusOne","cssClass","toFixed","positionWidth","POSITION_VIEWBOX_WIDTH","onMouseEnter","onMouseLeave","maxBarHeight","onClick","data-for","data-tip","data-class","dataseriesIdx","size","renderTooltip","renderBarPlot","ENTROPY_BARPLOT","al","plc","values","frac","log2","GAPS_BARPLOT","getGapCountAtColumn","AlignmentHighlighter","PixiComponent","create","Graphics","applyProps","instance","y","fillColor","fillAlpha","clear","beginFill","drawRect","endFill","AlignmentCanvasComponent","app","scaleX","scaleY","renderAlignmentHighlighter","body","overflow","onWheel","newValue","xy","stage","children","sprite","scale","highlightRows","stageResolution","viewportProps","numSequences","PIXI","skipHello","SCALE_MODE","NEAREST","options","transparent","Consumer","PixiViewport","numColumns","numRows","mouseDown","useDrag","usePinch","useWheel","zoomPercent","PixiAlignmentTiled","fullWidth","fullHeight","sizes","targetTileWidth","targetTileHeight","tiledImages","initializeTiledImages","tileYNumber","numYTiles","tileXNumber","numXTiles","tiledImage","generateCanvasForTile","tiles","tile","source","image","pixelX","pixelY","tileX","tileY","getName","tileImageData","tileCanvasContext","tileCanvas","offsets","imageDataIdx","seqIdx","seqY","letterX","getCurrentMoleculeColors","data","putImageData","lastTileHeight","lastTileWidth","fillRect","getImageData","colorCanvasWithSequence","consensusSequence","querySequence","moleculeClass","molecule","floor","renderer","backgroundColor","vp","Viewport","screenWidth","screenHeight","worldWidth","worldHeight","interaction","plugins","decelerate","clamp","direction","bounce","friction","time","underflow","clampZoom","maxWidth","drag","pinch","wheel","world","oldProps","newProps","fitWorld","setZoom","MiniMapComponent","renderCanvasComponent","getSizing","frameWidth","frameHeight","onMouseDown","borderWidth","margin","alignHorizontal","zIndex","left","right","top","bottom","borderColor","borderStyle","AceEditorComponent","editor","lastText","lastMode","lastElementWidth","lastElementHeight","text","editorMode","el","edit","setShowPrintMargin","setReadOnly","setHighlightActiveLine","setHighlightGutterLine","setFontSize","fontSize","setShowGutter","setPadding","$cursorLayer","display","getMousePosition","getDocumentPosition","screenCoordinates","textToScreenCoordinates","row","column","mouseRow","mouseColumn","mousePageX","pageX","mousePageY","pageY","mouseMove","getFontSize","characterSizeChanged","characterWidth","getEditorMode","newMode","setMode","getText","selectAll","removeLines","newText","insert","clientWidth","clientHeight","setupEditorAndEventListeners","addMouseEventListeners","setText","editorLoaded","resize","mouseEnter","mouseLeave","initialLoad","AceMultipleSequenceAlignmentComponent","getAceEditorMode","AceConsensusSequenceComponent","AceTargetSequenceComponent","AceTextualRulerComponent","generateTextualRuler","maxLength","sn","np","substr","logoPlotStyle","zoomLevel","showMiniMap","showAnnotations","AlignmentViewer","verticalScrollSync","horizontalScrollSync","handleCharacterSizeChanged","newCharSize","aceCharacterWidth","aceEditorLoaded","scrollSyncDirection","both","registerAceScroller","vertical","aceEditors","concat","setTimeout","alignmentEditorVisibleFirstRow","getFirstFullyVisibleRow","alignmentEditorVisibleLastRow","getLastFullyVisibleRow","windowDimensionsUpdated","windowWidth","innerWidth","windowHeight","innerHeight","renderSequenceLogo","renderConservationBox","defaultBarplotData","renderConsensusQueryBox","renderQuerySeqBox","renderPositionBox","renderAlignmentBox","renderAlignmentAnnotationBox","onMinimapClick","alignmentEditorFirstRow","alignmentEditorLastRow","rowCount","scrollToRow","annotation","content","addAsElementToScrollSync","registerElementScroller","annotationClass","renderMiniMap","generateWidget","mmClassName","FileInputComponent","fileInput","handleSubmit","onFileLoadCb","preventDefault","current","files","target","labelText","onInput","ExampleFileComponent","fileURL","onStartLoading","onFileLoaded","async","File","fetch","blob","f","App","renderSettingsBox","alignmentDescription","showSettings","renderAlignmentTypeLabel","renderSortControl","renderColorScheme","renderResidueDetail","renderPositionStyling","renderZoomButtons","renderMiniMapToggle","renderAnnotationToggle","renderFileUpload","renderExampleLinks","loading","onChange","fromKey","sso","fromAlignmentType","index","rd","pts","disabled","onFileUpload","process","checked","file","reader","FileReader","onload","fileText","result","fromFileContents","getDefaultStyle","readAsText","alignmentElement","Boolean","location","hostname","ReactDOM","render","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.c4ddd897.chunk.js","sourcesContent":["/**\n * Convert any valid color string into a hex code and RGB\n * value using the built in browser converter.\n * taken from\n * https://stackoverflow.com/questions/1573053/\n * and\n * https://stackoverflow.com/questions/5623838/\n * @param str The string to convert\n * @returns An object that contains the hex and rgb values for that string\n *          Default to black (#000000) if the string is not recognized.\n */\nexport function stringToColor(\n  str: string\n): {\n  hex: string;\n  rgb: { red: number; green: number; blue: number };\n} {\n  const ctx = document.createElement(\"canvas\").getContext(\"2d\");\n  ctx!.fillStyle = str;\n  let hex = ctx!.fillStyle!;\n\n  // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\n  // https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\n  // (I think only necessary in testing, but might catch odd browser behavior)\n  var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n  hex = hex.replace(shorthandRegex, function (m, r, g, b) {\n    return \"#\" + r + r + g + g + b + b;\n  });\n\n  var rgbaResult = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex)!;\n  return {\n    hex: hex,\n    rgb: {\n      red: parseInt(rgbaResult[1], 16),\n      green: parseInt(rgbaResult[2], 16),\n      blue: parseInt(rgbaResult[3], 16),\n    },\n  };\n}\n\n/**\n * Generate a UUID. Modified from:\n * https://stackoverflow.com/questions/105034\n */\nexport function generateUUIDv4() {\n  const x = (([1e7] as any) + -1e3 + -4e3 + -8e3 + -1e11) as string;\n  return x.replace(/[018]/g, function (c: string) {\n    return (\n      parseInt(c) ^\n      (window.crypto.getRandomValues(new Uint8Array(1))[0] &\n        (15 >> (parseInt(c) / 4)))\n    ).toString(16);\n  });\n}\n\n/**\n * Creates an object composed of keys generated from the results of\n * running each element of collection through fn. The corresponding\n * value of each key is an array of the elements responsible for\n * generating the key. (description taken from lodash documentation)\n *\n * The difference between this function and the lodash \"groupBy\",\n * function is that this returns a Map object, allowing for more complex\n * keys.\n *\n * @param items\n * @param fn\n */\nexport function mapGroupBy<T1, T2>(\n  items: T1[],\n  fn: (item: T1) => T2\n): Map<T2, T1[]> {\n  //{ [key: string]: T[] } {\n  return items.reduce((acc, item) => {\n    const key = fn(item);\n    const existing = acc.get(key) ? acc.get(key)! : [];\n    acc.set(key, [...existing, item]);\n    return acc;\n  }, new Map<T2, T1[]>());\n}\n\n/*\n//TESTING groupBy\nconst items = [\n  { cat: \"x\", b: 2 },\n  { cat: \"x\", b: 4 },\n  { cat: \"y\", b: 4 },\n];\nconsole.log(groupBy(items, (item) => item.cat));\nconsole.log(groupBy(items, (item) => \"\" + item.b));\nconsole.log(groupBy(items, (item) => item.cat + item.b));\n\nconst barItems = [\n  { name: \"nick\", categoryName: \"boy\", categoryCssClass: \"boyclass\" },\n  { name: \"bob\", categoryName: \"boy\", categoryCssClass: \"boyclass\" },\n  { name: \"john\", categoryName: \"boy\", categoryCssClass: \"boyclass\" },\n  { name: \"sam\", categoryName: \"boy\", categoryCssClass: \"boyclass\" },\n  { name: \"soha\", categoryName: \"girl\", categoryCssClass: \"girlclass\" },\n  { name: \"leyla\", categoryName: \"girl\", categoryCssClass: \"girlclasses\" },\n  { name: \"raha\", categoryName: \"girl\", categoryCssClass: \"girlclass\" },\n];\n\nconst barItemsGrouped = groupBy(barItems, \"categoryName\");\nconst allCategoryNames = Object.entries(\n  barItems.reduce((acc, bar) => {\n    if (!acc[bar.categoryName]) {\n      acc[bar.categoryName] = [];\n    }\n    if (!acc[bar.categoryName].includes(bar.categoryCssClass)) {\n      acc[bar.categoryName].push(bar.categoryCssClass);\n    }\n    return acc;\n  }, {} as { [categoryName: string]: string[] })\n);\n\n//[...new Set(barItems.map((bar) => [bar.categoryName, bar.categoryCssClass]))];\n//const allCategoryNames = [...new Set(tmpobjs.map((bar) => bar.categoryName))];\n//const group = groupBy(allCategoryNames, \"category\");\nconsole.log(allCategoryNames);\n\n//console.log(barItemsGrouped);\n\n\n/**\n * Returns the unique subset of items that contain the properties sepecified\n * using === for equality.\n * @param items\n * @param properties\n */\n/*\nexport function shallowUnique<T, K extends keyof T>(\n  items: T[],\n  properties: K[]\n): Partial<T>[] {\n  return items.reduce((acc, current) => {\n    const alreadyAdded = acc.find((item) => {\n      //already added?\n      return properties.find(\n        (prop) => current[prop] && current[prop] !== item[prop]\n      )\n        ? false\n        : true;\n    });\n    if (!alreadyAdded) {\n      return acc.concat([\n        properties.reduce((acc, prop) => {\n          //pluck only\n          if (current[prop]) {\n            acc[prop] = current[prop];\n          }\n          return acc;\n        }, {} as Partial<T>),\n      ]);\n    }\n    return acc;\n  }, [] as Partial<T>[]);\n}\n\n//testing shallowUnique\nconst items = [\n  { cat: \"x\", b: 2, c: 123 },\n  { cat: \"x\", b: 4, c: 180 },\n  { cat: \"y\", b: 4 },\n  { cat: \"z\", b: 4 },\n  { cat: \"x\", b: 4 },\n];\nconsole.log(shallowUnique(items, [\"b\"]));\nconsole.log(shallowUnique(items, [\"cat\"]));\nconsole.log(shallowUnique(items, [\"c\"]));\nconsole.log(shallowUnique(items, [\"c\", \"cat\"]));\nconsole.log(shallowUnique(items, [\"b\", \"cat\"]));\n*/\n","/**\n * This file centralizes the location of javascript style definitions\n * for nucleotide and amino acid styles.\n */\nimport styles from \"./MolecularStyles.module.scss\";\n//console.log(\"STYLES AS INPUT ::::: \", styles);\n\n/**\n * Defines a single color scheme interface which consists of\n * a name, className, background alpha, and set of colors for\n * all residues (hex string format).\n *\n * @export\n * @interface IColorScheme\n */\nexport interface IColorScheme {\n  commonName: string;\n  description: string;\n  backgroundAlpha: number;\n  className: string;\n  colors: {\n    [residueCode: string]: string;\n  };\n}\n\nexport const ALL_AMINOACID_COLORSCHEMES = assembleColorSchemes(\"aa\");\nexport const ALL_NUCLEOTIDE_COLORSCHEMES = assembleColorSchemes(\"nt\");\n\n/**\n * Read in class names and colors for amino acid or nucleotide\n * color schemes from the scss file.\n *\n * @param {(\"aa\" | \"nt\")} moleculeType\n * @returns\n */\nfunction assembleColorSchemes(moleculeType: \"aa\" | \"nt\") {\n  return Object.keys(styles).reduce((acc, styleName) => {\n    if (styleName.indexOf(moleculeType + \"StyClass_\") !== -1) {\n      const colorSchemeName = styleName.split(moleculeType + \"StyClass_\")[1];\n      const colorOrder = styles[\n        moleculeType + \"StyColorOrder_\" + colorSchemeName\n      ]\n        .replace(/ /g, \"\")\n        .split(\",\"); // \"build\" removes spaces, but local \"run\" does not\n      const hexValues = styles[moleculeType + \"StyColors_\" + colorSchemeName]\n        .replace(/ /g, \"\")\n        .split(\",\"); // \"build\" removes spaces, but local \"run\" does not\n      const description = styles[moleculeType + \"StyDesc_\" + colorSchemeName];\n      acc.push({\n        commonName: colorSchemeName,\n        description: description,\n        className: styles[styleName],\n        backgroundAlpha: parseFloat(\n          styles[moleculeType + \"StyBGAlpha_\" + colorSchemeName]\n        ),\n        colors: Object.fromEntries(\n          colorOrder.map((_, i) => [colorOrder[i], hexValues[i]])\n        ),\n      });\n    }\n    return acc;\n  }, [] as IColorScheme[]);\n}\n\n/**\n * Top level alignment type descriptions. There are two supported\n * alignment types: AMINOACID and NUCLEOTIDE.\n *\n * @export\n * @class AlignmentTypes\n */\nexport class AlignmentTypes {\n  static readonly AMINOACID = new AlignmentTypes(\n    \"aminoacid-alignment\",\n    \"Amino Acid Sequences\",\n    styles.aaAlignTypeClass,\n    ALL_AMINOACID_COLORSCHEMES\n  );\n  static readonly NUCLEOTIDE = new AlignmentTypes(\n    \"nucleotide-alignment\",\n    \"Nucleotide Sequences\",\n    styles.ntAlignTypeClass,\n    ALL_NUCLEOTIDE_COLORSCHEMES\n  );\n\n  static list = [AlignmentTypes.AMINOACID, AlignmentTypes.NUCLEOTIDE];\n\n  static fromKey(key: string) {\n    return AlignmentTypes.list.find((at) => {\n      return at.key === key;\n    });\n  }\n\n  private constructor(\n    public readonly key: string,\n    public readonly description: string,\n    public readonly className: string,\n    public readonly allColorSchemes: IColorScheme[]\n  ) {}\n}\n\n/**\n * This class represents different position styling modes.\n *\n * @export\n * @class PositionsToStyle\n */\nexport class PositionsToStyle {\n  static readonly ALL = new PositionsToStyle(\n    \"all\",\n    \"All\",\n    styles.styPosAllClass\n  );\n  static readonly QUERY = new PositionsToStyle(\n    \"query\",\n    \"Same as Query\",\n    styles.styPosQueryClass\n  );\n  static readonly QUERY_DIFF = new PositionsToStyle(\n    \"query-diff\",\n    \"Different from Query\",\n    styles.styPosQueryDiffClass\n  );\n  static readonly CONSENSUS = new PositionsToStyle(\n    \"consensus\",\n    \"Same as Consensus\",\n    styles.styPosConsensusClass\n  );\n  static readonly CONSENSUS_DIFF = new PositionsToStyle(\n    \"consensus-diff\",\n    \"Different from Consensus\",\n    styles.styPosConsensusDiffClass\n  );\n\n  static list = [\n    PositionsToStyle.ALL,\n    PositionsToStyle.QUERY,\n    PositionsToStyle.QUERY_DIFF,\n    PositionsToStyle.CONSENSUS,\n    PositionsToStyle.CONSENSUS_DIFF,\n  ];\n\n  static fromKey(key: string) {\n    return PositionsToStyle.list.find((at) => {\n      return at.key === key;\n    });\n  }\n\n  // private to disallow creating other instances of this type\n  private constructor(\n    public readonly key: string,\n    public readonly description: string,\n    public readonly className: string\n  ) {}\n}\n\nexport class ResidueDetailTypes {\n  static readonly BOTH = new ResidueDetailTypes(\n    \"both\",\n    \"Style Background and Letters\",\n    \"\"\n  );\n  static readonly LETTER_ONLY = new ResidueDetailTypes(\n    \"letter-only\",\n    \"Only Style Letters\",\n    styles.transparentBackgroundClass\n  );\n  static readonly BACKGROUND_ONLY = new ResidueDetailTypes(\n    \"background-only\",\n    \"Only Style Background\",\n    styles.transparentLetterClass\n  );\n\n  static list = [\n    ResidueDetailTypes.BOTH,\n    ResidueDetailTypes.LETTER_ONLY,\n    ResidueDetailTypes.BACKGROUND_ONLY,\n  ];\n\n  static fromKey(key: string) {\n    return ResidueDetailTypes.list.find((at) => {\n      return at.key === key;\n    });\n  }\n\n  private constructor(\n    public readonly key: string,\n    public readonly description: string,\n    public readonly className: string\n  ) {}\n}\n\n/**\n * Object to describe the style of a set of sequences (MSA, logo, etc).\n * Contains 2 key parameters:\n *     \"alignmentType\": should be set by implementing classes\n *     \"colorScheme\": describes the color scheme to apply to the alignment.\n *                    defaults to the first available from the scss file\n *     \"positionsToStyle\": description of which positions should be styled.\n *                         defaults to all positions.\n *\n * @interface AlignmentStyle\n */\nexport abstract class AlignmentStyle {\n  abstract readonly alignmentType: AlignmentTypes;\n  abstract colorScheme: IColorScheme;\n  abstract positionsToStyle: PositionsToStyle;\n  abstract residueDetail: ResidueDetailTypes;\n\n  static fromAlignmentType(alignmentType: AlignmentTypes) {\n    if (alignmentType === AlignmentTypes.AMINOACID)\n      return new AminoAcidAlignmentStyle();\n    return new NucleotideAlignmentStyle();\n  }\n}\n\n/**\n * Object to describe an amino acid alignment style\n * @class AminoAcidAlignmentStyle\n * @implements {AlignmentStyle}\n */\nexport class AminoAcidAlignmentStyle implements AlignmentStyle {\n  readonly allColorSchemes = ALL_AMINOACID_COLORSCHEMES;\n  readonly alignmentType = AlignmentTypes.AMINOACID;\n\n  constructor(\n    public colorScheme: IColorScheme = ALL_AMINOACID_COLORSCHEMES[0],\n    public positionsToStyle: PositionsToStyle = PositionsToStyle.ALL,\n    public residueDetail: ResidueDetailTypes = ResidueDetailTypes.BOTH\n  ) {}\n}\n\n/**\n * Object to describe an nucleotide alignment style\n *\n * @export\n * @class NucleotideAlignmentStyle\n * @implements {AlignmentStyle}\n */\nexport class NucleotideAlignmentStyle implements AlignmentStyle {\n  readonly allColorSchemes = ALL_NUCLEOTIDE_COLORSCHEMES;\n  readonly alignmentType = AlignmentTypes.NUCLEOTIDE;\n\n  constructor(\n    public colorScheme: IColorScheme = ALL_NUCLEOTIDE_COLORSCHEMES[0],\n    public positionsToStyle: PositionsToStyle = PositionsToStyle.ALL,\n    public residueDetail: ResidueDetailTypes = ResidueDetailTypes.BOTH\n  ) {}\n}\n\n/**\n * Export globals\n */\nconst transparentLetterClass = styles.transparentLetterClass;\nconst transparentBackgroundClass = styles.transparentBackgroundClass;\nconst aceResidueParentClass = styles.aceResidueParentClass;\nexport {\n  transparentBackgroundClass,\n  transparentLetterClass,\n  aceResidueParentClass, // place above any residue (e.g., ace_A) to get default coloring\n};\n\n/**\n * Export ace helper parameters and functions.\n */\n\n/**\n * fast lookup of the query, consensus classes\n * @param isForAceItself If it is for ace, do not include the ace_ prefix\n *                       as this is added automatically by ace itself.\n */\nfunction generateFastClassLookup(isForAceItself?: boolean) {\n  let ALL_POSSIBLE_CHARS = \"\";\n  for (var i = 32; i <= 126; i++) {\n    ALL_POSSIBLE_CHARS += String.fromCharCode(i);\n  }\n\n  return ALL_POSSIBLE_CHARS.split(\"\") //\".-abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n    .reduce((acc, letter) => {\n      const letterInClass = letter === \".\" ? \"dot\" : letter;\n      const prefix = isForAceItself\n        ? letterInClass\n        : styles.acePrefix + letterInClass;\n      acc.set(\n        letter,\n        new Map([\n          [\n            true,\n            new Map([\n              [\n                true,\n                prefix +\n                  \" \" +\n                  styles.preAceConsensusClass +\n                  \" \" +\n                  styles.preAceQueryClass,\n              ], //is consensus and query\n              [false, prefix + \" \" + styles.preAceConsensusClass], //is consensus, not query\n            ]),\n          ],\n          [\n            false,\n            new Map([\n              [true, prefix + \" \" + styles.preAceQueryClass], //is query, not consensus\n              [false, prefix], //not query and not consensus\n            ]),\n          ],\n        ])\n      );\n      return acc;\n    }, new Map<string, Map<boolean, Map<boolean, string>>>());\n}\n\nconst LETTER_CLASS_NAMES = generateFastClassLookup(false);\nconst LETTER_CLASS_NAMES_FOR_ACE = generateFastClassLookup(true);\n\n/**\n * Export a class name array that is used by the ace editor\n * mode to fill class names for each letter. The structure\n * of this string is just the list of class names, separated\n * by a period. Ace subsequently prepends ace_ to each value\n * when adding the classes to the editor.\n *\n * Update: I only use a single class name separated by a space.\n *         I think this helps with performance:(1) ace no\n *         longer needs to split the returned value by periods\n *         and apply any multi-class logic, and (2) the dom has\n *         shorter classnames. I did rough tests and this seems\n *         to help with performance, but admittedly they were not\n *         rigerous or scientific and it doesn't seem to make a\n *         large impact.\n *\n * @param letter\n * @param isConsensus\n * @param isQuery\n * @param forAceItself if set to true, the first returned class will\n *                     not have ace_ prepended as the ace editor will\n *                     do the prepending on its own.\n */\nexport function getLetterClassNames(\n  letter: string,\n  isConsensus: boolean,\n  isQuery: boolean,\n  forAceItself?: boolean\n) {\n  return forAceItself\n    ? LETTER_CLASS_NAMES_FOR_ACE.get(letter)!.get(isConsensus)!.get(isQuery)!\n    : LETTER_CLASS_NAMES.get(letter)!.get(isConsensus)!.get(isQuery)!;\n}\n","/**\n *\n * Glyph definitions for the logo component.\n * Inspired / derived from https://github.com/weng-lab/logojs-package\n *\n */\nimport React from \"react\";\n\nexport class GlyphFactory {\n  private static singleton: undefined | GlyphFactory;\n\n  private letterToGlyphHM: {\n    [key: string]: (props: { [key: string]: string }) => JSX.Element;\n  } = {\n    A: GlyphFactory.A,\n    B: GlyphFactory.B,\n    C: GlyphFactory.C,\n    D: GlyphFactory.D,\n    E: GlyphFactory.E,\n    F: GlyphFactory.F,\n    G: GlyphFactory.G,\n    H: GlyphFactory.H,\n    I: GlyphFactory.I,\n    J: GlyphFactory.J,\n    K: GlyphFactory.K,\n    L: GlyphFactory.L,\n    M: GlyphFactory.M,\n    N: GlyphFactory.N,\n    O: GlyphFactory.O,\n    P: GlyphFactory.P,\n    Q: GlyphFactory.Q,\n    R: GlyphFactory.R,\n    S: GlyphFactory.S,\n    T: GlyphFactory.T,\n    U: GlyphFactory.U,\n    V: GlyphFactory.V,\n    W: GlyphFactory.W,\n    X: GlyphFactory.X,\n    Y: GlyphFactory.Y,\n    Z: GlyphFactory.Z\n  };\n\n  static glyphFromChar(letter: string) {\n    if (!GlyphFactory.singleton) {\n      GlyphFactory.singleton = new GlyphFactory();\n    }\n    return GlyphFactory.singleton.letterToGlyphHM[letter];\n  }\n\n  private static A = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <path\n        {...props}\n        d=\"M 0 100 L 33 0 L 66 0 L 100 100 L 75 100 L 66 75 L 33 75 L 25 100 L 0 100\"\n      />\n      <path\n        key={props.key + \"_p2\"}\n        transform={props.transform}\n        fill=\"#ffffff\"\n        d=\"M 41 55 L 50 25 L 58 55 L 41 55\"\n      />\n    </g>\n  );\n\n  private static B = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <path\n        {...props}\n        d=\"M 0 0 L 80 0 C 105 0 105 50 80 50 C 105 50 105 100 80 100 L 00 100 L 0 0\"\n      />\n      <path\n        key={props.key + \"_p2\"}\n        transform={props.transform}\n        d=\"M 20 15 L 70 15 C 80 15 80 35 70 35 L 20 35 L 20 15\"\n        fill=\"#ffffff\"\n      />\n      <path\n        key={props.key + \"_p3\"}\n        transform={props.transform}\n        d=\"M 20 65 L 70 65 C 80 65 80 85 70 85 L 20 85 L 20 65\"\n        fill=\"#ffffff\"\n      />\n    </g>\n  );\n\n  private static C = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 100 28 C 100 -13 0 -13 0 50\n      C 0 113 100 113 100 72 L 75 72\n      C 75 90 30 90 30 50 C 30 10 75 10 75 28\n      L 100 28\"\n    />\n  );\n\n  private static D = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <path {...props} d=\"M 0 0 L 60 0 C 110 0 110 100 60 100 L 0 100 L 0 0\" />\n      <path\n        key={props.key + \"_p2\"}\n        transform={props.transform}\n        fill=\"#ffffff\"\n        d=\"M 20 15 L 40 15 C 85 15 85 85 40 85 L 20 85 L 20 15\"\n      />\n    </g>\n  );\n\n  private static E = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 100 0 L 100 20 L 20 20 L 20 40 L 90 40 L 90 60 L 20 60 L 20 80 L 100 80 L 100 100 L 0 100 L 0 0\"\n    />\n  );\n\n  private static F = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 100 0 L 100 20 L 20 20 L 20 40 L 80 40 L 80 60 L 20 60 L 20 100 L 0 100 L 0 0\"\n    />\n  );\n\n  private static G = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 100 28 C 100 -13 0 -13 0 50 C 0 113 100 113 100 72 L 100 48 L 55 48 L 55 72 L 75 72 C 75 90 30 90 30 50 C 30 10 75 5 75 28 L 100 28\"\n    />\n  );\n\n  private static H = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 20 40 L 80 40 L 80 0 L 100 0 L 100 100 L 80 100 L 80 60 L 20 60 L 20 100 L 0 100 L 0 0\"\n    />\n  );\n\n  private static I = (props: { [key: string]: string }) => (\n    <path {...props} d=\"M 40 0 L 60 0 L 60 100 L 40 100 L 40 0\" />\n  );\n\n  private static J = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 60 C 0 111 100 111 100 60 L 100 0 L 75 0 L 75 60 C 80 90 20 90 25 60\"\n    />\n  );\n\n  private static K = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 20 40 L 75 0 L 100 0 L 50 50 L 100 100 L 75 100 L 30 65 L 20 75 L 20 100 L 0 100 L 0 0\"\n    />\n  );\n\n  private static L = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 0 100 L 100 100 L 100 80 L 20 80 L 20 0 L 0 0\"\n    />\n  );\n\n  private static M = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 50 35 L 80 0 L 100 0 L 100 100 L 80 100 L 80 30 L 50 65 L 20 30 L 20 100 L 0 100 L 0 0\"\n    />\n  );\n\n  private static N = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 100 L 0 0 L 20 0 L 80 75 L 80 0 L 100 0 L 100 100 L 80 100 L 20 25 L 20 100 L 0 100\"\n    />\n  );\n\n  private static O = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <circle cx=\"50\" cy=\"50\" r=\"50\" {...props} />\n      <circle\n        key={props.key + \"_c2\"}\n        transform={props.transform}\n        cx=\"50\"\n        cy=\"50\"\n        r=\"32\"\n        fill=\"#ffffff\"\n      />\n    </g>\n  );\n\n  private static P = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <path\n        {...props}\n        d=\"M 0 0 L 80 0 C 105 0 105 50 80 50 L 20 50 L 20 100 L 0 100 L 0 0\"\n      />\n      <path\n        key={props.key + \"_p2\"}\n        transform={props.transform}\n        fill=\"#ffffff\"\n        d=\"M 20 15 L 70 15 C 80 15 80 35 70 35 L 20 35 L 20 15\"\n      />\n    </g>\n  );\n\n  private static Q = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <circle\n        cx=\"50\"\n        cy=\"50\"\n        r=\"50\"\n        {...{ ...props, key: props.key + \"_c1\" }}\n      />\n      <circle\n        key={props.key + \"_c2\"}\n        transform={props.transform}\n        cx=\"50\"\n        cy=\"50\"\n        r=\"32\"\n        fill=\"#ffffff\"\n      />\n      <path d=\"M 85 100 L 55 70 L 70 55 L 100 85 L 85 100\" {...props} />\n    </g>\n  );\n\n  private static R = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <path\n        {...props}\n        d=\"M 0 0 L 80 0 C 105 0 105 50 80 50 C 100 50 100 70 100 70 L 100 100 L 80 100 L 80 80 C 80 80 80 60 50 60 L 20 60 L 20 100 L 0 100 L 0 0\"\n      />\n      <path\n        key={props.key + \"_p2\"}\n        transform={props.transform}\n        fill=\"#ffffff\"\n        d=\"M 20 15 L 70 15 C 80 15 80 35 70 35 L 20 35 L 20 15\"\n      />\n    </g>\n  );\n\n  /**\n   *NOTE: Requires \"stroke\" and \"strokeOpacity\" instead of just the fill prop.\n   */\n  private static S = (props: { [key: string]: string }) => {\n    if (!props.stroke) {\n      props.stroke = props.fill;\n    }\n    if (!props.strokeOpacity) {\n      props.strokeOpacity = props.fillOpacity;\n    }\n\n    return (\n      <path\n        fill=\"#ffffff\"\n        {...props}\n        strokeWidth=\"18\"\n        d=\"M92 26 A43 20 0 1 0 43 46 A42 23 0 1 1 9 68\"\n      />\n    );\n  };\n\n  private static T = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 0 20 L 35 20 L 35 100 L 65 100 L 65 20 L 100 20 L 100 0 L 0 0\"\n    />\n  );\n\n  private static U = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 0 60 C 0 111 100 111 100 60 L 100 0 L 75 0 L 75 60 C 80 90 20 90 25 60 L 25 0 L 0 0\"\n    />\n  );\n\n  private static V = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 50 80 L 80 0 L 100 0 L 60 100 L 40 100 L 0 0\"\n    />\n  );\n\n  private static W = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 30 70 L 50 30 L 70 70 L 80 0 L 100 0 L 90 100 L 70 100 L 50 65 L 30 100 L 10 100 L 0 0\"\n    />\n  );\n\n  private static X = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 50 40 L 80 0 L 100 0 L 70 50 L 100 100 L 80 100 L 50 60 L 20 100 L 0 100 L 30 50 L 0 0\"\n    />\n  );\n\n  private static Y = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 50 45 L 80 0 L 100 0 L 60 60 L 60 100 L 40 100 L 40 60 L 0 0\"\n    />\n  );\n\n  private static Z = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 100 0 L 100 20 L 35 80 L 100 80 L 100 100 L 0 100 L 0 80 L 65 20 L 0 20 L 0 0\"\n    />\n  );\n}\n","import { GlyphFactory } from \"./SequenceLogoGlyphs\";\nimport { stringToColor } from \"./Utils\";\nimport {\n  ALL_AMINOACID_COLORSCHEMES,\n  ALL_NUCLEOTIDE_COLORSCHEMES,\n} from \"./MolecularStyles\";\n\ninterface IResidueColor {\n  [colorScheme: string]: {\n    hexString: string;\n    rgb: {\n      red: number;\n      green: number;\n      blue: number;\n    };\n    backgroundAlpha: number;\n  };\n}\n\ninterface IAminoAcid {\n  singleLetterCode: string;\n  threeLetterCode: string;\n  fullName: string;\n  glyph: (props: { [key: string]: string }) => JSX.Element;\n  colors: IResidueColor;\n}\n\ninterface INucleotide {\n  singleLetterCode: string;\n  fullName: string;\n  glyph: (props: { [key: string]: string }) => JSX.Element;\n  colors: IResidueColor;\n}\n\nexport class AminoAcid implements IAminoAcid {\n  glyph: (props: { [key: string]: string }) => JSX.Element;\n  colors: IResidueColor;\n\n  public static readonly canonicalAminoAcids: AminoAcid[] = [\n    new AminoAcid(\"A\", \"ALA\", \"Alanine\"),\n    new AminoAcid(\"R\", \"ARG\", \"Arginine\"),\n    new AminoAcid(\"N\", \"ASN\", \"Asparagine\"),\n    new AminoAcid(\"D\", \"ASP\", \"Aspartic Acid\"),\n    new AminoAcid(\"C\", \"CYS\", \"Cysteine\"),\n    new AminoAcid(\"Q\", \"GLU\", \"Glutamine\"),\n    new AminoAcid(\"E\", \"GLN\", \"Glutamic Acid\"),\n    new AminoAcid(\"G\", \"GLY\", \"Glycine\"),\n    new AminoAcid(\"H\", \"HIS\", \"Histidine\"),\n    new AminoAcid(\"I\", \"ILE\", \"Isoleucine\"),\n    new AminoAcid(\"L\", \"LEU\", \"Leucine\"),\n    new AminoAcid(\"K\", \"LYS\", \"Lysine\"),\n    new AminoAcid(\"M\", \"MET\", \"Methionine\"),\n    new AminoAcid(\"F\", \"PHE\", \"Phenylalanine\"),\n    new AminoAcid(\"P\", \"PRO\", \"Proline\"),\n    new AminoAcid(\"S\", \"SER\", \"Serine\"),\n    new AminoAcid(\"T\", \"THR\", \"Threonine\"),\n    new AminoAcid(\"W\", \"TRP\", \"Tryptophan\"),\n    new AminoAcid(\"Y\", \"TYR\", \"Tyrosine\"),\n    new AminoAcid(\"V\", \"VAL\", \"Valine\"),\n\n    new AminoAcid(\"X\", \"UKN\", \"Unknown Amino Acid\"),\n  ];\n\n  private static bySingleLetterCode = AminoAcid.canonicalAminoAcids.reduce(\n    (acc, aa) => {\n      acc[aa.singleLetterCode] = aa;\n      return acc;\n    },\n    {} as { [key: string]: AminoAcid }\n  );\n\n  private static byThreeLetterCode = AminoAcid.canonicalAminoAcids.reduce(\n    (acc, aa) => {\n      acc[aa.threeLetterCode] = aa;\n      return acc;\n    },\n    {} as { [key: string]: AminoAcid }\n  );\n\n  public static readonly UNKNOWN = AminoAcid.bySingleLetterCode[\"X\"];\n\n  static fromSingleLetterCode(singleLetterCode: string): IAminoAcid {\n    if (singleLetterCode in this.bySingleLetterCode) {\n      return AminoAcid.bySingleLetterCode[singleLetterCode];\n    }\n    return AminoAcid.UNKNOWN;\n  }\n\n  static fromThreeLetterCode(threeLetterCode: string): IAminoAcid {\n    if (threeLetterCode in this.byThreeLetterCode) {\n      return AminoAcid.byThreeLetterCode[threeLetterCode];\n    }\n    return AminoAcid.UNKNOWN;\n  }\n\n  constructor(\n    public singleLetterCode: string,\n    public threeLetterCode: string,\n    public fullName: string\n  ) {\n    this.singleLetterCode = singleLetterCode;\n    this.threeLetterCode = threeLetterCode;\n    this.fullName = fullName;\n    this.glyph = GlyphFactory.glyphFromChar(singleLetterCode);\n    this.colors = ALL_AMINOACID_COLORSCHEMES.reduce((acc, cs) => {\n      const colorPair = Object.entries(cs.colors).find(([aa, color]) => {\n        if (aa === singleLetterCode) {\n          return true;\n        }\n        return false;\n      });\n\n      let colorString = \"#ffffff\";\n      if (colorPair) {\n        colorString = colorPair[1];\n      }\n      const colorInfo = stringToColor(colorString);\n      acc[cs.commonName] = {\n        hexString: colorInfo.hex,\n        rgb: colorInfo.rgb,\n        backgroundAlpha: cs.backgroundAlpha,\n      };\n      return acc;\n    }, {} as IResidueColor);\n  }\n}\n\nexport class Nucleotide implements INucleotide {\n  glyph: (props: { [key: string]: string }) => JSX.Element;\n  colors: IResidueColor;\n\n  static allNucleotides: Nucleotide[] = [\n    new Nucleotide(\"A\", \"Adenine\"),\n    new Nucleotide(\"C\", \"Cytosine\"),\n    new Nucleotide(\"G\", \"Guanine\"),\n    new Nucleotide(\"T\", \"Thymidine\"),\n    new Nucleotide(\"U\", \"Uracil\"),\n\n    new Nucleotide(\"R\", \"Purine\"),\n    new Nucleotide(\"Y\", \"Pyrimidine\"),\n\n    new Nucleotide(\"X\", \"Unknown Nucleotide\"),\n  ];\n\n  private static bySingleLetterCode = Nucleotide.allNucleotides.reduce(\n    (acc, aa) => {\n      acc[aa.singleLetterCode] = aa;\n      return acc;\n    },\n    {} as { [key: string]: Nucleotide }\n  );\n\n  public static UNKNOWN = Nucleotide.bySingleLetterCode[\"X\"];\n\n  static fromSingleLetterCode(singleLetterCode: string): Nucleotide {\n    singleLetterCode = singleLetterCode.toUpperCase();\n    if (this.bySingleLetterCode[singleLetterCode]) {\n      return Nucleotide.bySingleLetterCode[singleLetterCode];\n    }\n    return Nucleotide.UNKNOWN;\n  }\n\n  constructor(public singleLetterCode: string, public fullName: string) {\n    this.singleLetterCode = singleLetterCode;\n    this.fullName = fullName;\n    this.glyph = GlyphFactory.glyphFromChar(singleLetterCode);\n    this.colors = ALL_NUCLEOTIDE_COLORSCHEMES.reduce((acc, cs) => {\n      const colorPair = Object.entries(cs.colors).find(([aa, color]) => {\n        if (aa === singleLetterCode) {\n          return true;\n        }\n        return false;\n      });\n\n      let colorString = \"#ffffff\";\n      if (colorPair) {\n        colorString = colorPair[1];\n      }\n      const colorInfo = stringToColor(colorString);\n      acc[cs.commonName] = {\n        hexString: colorInfo.hex,\n        rgb: colorInfo.rgb,\n        backgroundAlpha: cs.backgroundAlpha,\n      };\n      return acc;\n    }, {} as IResidueColor);\n  }\n}\n","import { generateUUIDv4 } from \"./Utils\";\nimport { defineNewAlignmentMode } from \"./AceAlignmentMode\";\nimport { Nucleotide } from \"./Residues\";\nimport {\n  AlignmentTypes,\n  AminoAcidAlignmentStyle,\n  NucleotideAlignmentStyle,\n} from \"./MolecularStyles\";\n\nexport interface ISequence {\n  id: string;\n  sequence: string;\n}\n\nenum DistanceFunctions {\n  \"hamming\",\n}\nexport class SequenceSortOptions {\n  static readonly INPUT = new SequenceSortOptions(\n    \"as-input\",\n    \"As input\",\n    false\n  );\n  static readonly HAMMING_DIST_TARGET = new SequenceSortOptions(\n    \"hamming-dist-to-target\",\n    \"Hamming distance to target sequence\",\n    true,\n    DistanceFunctions.hamming\n  );\n\n  static list = [\n    SequenceSortOptions.INPUT,\n    SequenceSortOptions.HAMMING_DIST_TARGET,\n  ];\n\n  static fromKey(key: string) {\n    return SequenceSortOptions.list.find((at) => {\n      return at.key === key;\n    });\n  }\n\n  private constructor(\n    public readonly key: string,\n    public readonly description: string,\n    public readonly isTargetSequenceDependent: boolean,\n    public readonly distanceFn?: DistanceFunctions\n  ) {}\n}\n\n/**\n * Alignment\n * This class represents a multiple sequence alignment. During initialization,\n * positional statistics are generated about the alignment and a consensus\n * sequence is determined.\n *\n * The class should be instantiated using the static methods:\n *     fromFileContents: accepts a fasta file-like string\n */\nexport class Alignment {\n  private uuid: string;\n  private aceEditorMode: string | undefined;\n  private name: string;\n  private predictedNT: boolean;\n  private sequences: Map<SequenceSortOptions, ISequence[]>;\n  private targetSequence: ISequence;\n  private positionalLetterCounts = new Map<\n    number,\n    { [letter: string]: number }\n  >();\n  private globalAlphaLetterCounts: { [letter: string]: number } = {};\n  private allUpperAlphaLettersSorted: string[];\n  private consensus: {\n    letter: string;\n    position: number;\n    occurrences: number;\n  }[] = [];\n\n  /**\n   * Create and return a new Alignment object from a fasta-type file\n   * @param fileContents the multiple sequence alignment fasta file as a string\n   */\n  static fromFileContents(fileName: string, fileContents: string): Alignment {\n    const fastaSplitCaret = fileContents.split(\">\");\n    var sequences: ISequence[] = [];\n    for (var i = 0; i < fastaSplitCaret.length; i++) {\n      const seqArr = fastaSplitCaret[i].split(/\\r?\\n/);\n      if (seqArr.length > 1) {\n        var seqObj = {\n          id: seqArr[0],\n          sequence: seqArr.slice(1).join(\"\"),\n        };\n        sequences.push(seqObj);\n      }\n    }\n    return new Alignment(fileName, sequences);\n  }\n\n  /**\n   * Determine the distance between two sequences\n   * @param seq1\n   * @param seq2\n   * @param distFn what method should be used to calculate distance\n   * @returns the distance between the sequence pair\n   * @throws an Error if an invalid distance function is provided.\n   */\n  private static getSequenceDistance(\n    seq1: ISequence,\n    seq2: ISequence,\n    distFn: DistanceFunctions\n  ) {\n    const minLength =\n      seq1.sequence.length < seq2.sequence.length\n        ? seq1.sequence.length\n        : seq2.sequence.length;\n    let distance = 0;\n\n    if (distFn === DistanceFunctions.hamming) {\n      for (var i = 0; i < minLength; i++) {\n        if (seq1.sequence[i] !== seq2.sequence[i]) {\n          distance += 1;\n        }\n      }\n      return distance;\n    }\n    throw Error(\n      \"Unable to determine sequence distance with distance function \" + distFn\n    );\n  }\n\n  /**\n   * Normalize all values in an object that contains all counts such that\n   * the sum of those counts equals 1.\n   * @param letterCounts an object that contains the same keys, but whose\n   *                     values now sum to 1.\n   * @param validLetters if provided, returned object will only contain letters\n   *                     that are in this array.\n   */\n  private static normalizeLetterCounts(\n    letterCounts: { [letter: string]: number },\n    validLetters?: string[]\n  ) {\n    const totalCounts = Object.keys(letterCounts).reduce((acc, letter) => {\n      if (!validLetters || validLetters.includes(letter)) {\n        acc += letterCounts[letter];\n      }\n      return acc;\n    }, 0);\n\n    return Object.keys(letterCounts).reduce((acc, letter) => {\n      if (!validLetters || validLetters.includes(letter)) {\n        acc[letter] = letterCounts[letter] / totalCounts;\n      }\n      return acc;\n    }, {} as { [letter: string]: number });\n  }\n\n  /**\n   * Create a new Alignment object. The default target sequence will\n   * be set to the first sequence in sequences. This can be changed\n   * by calling setTargetSequence() after creation\n   * @param sequences\n   */\n  public constructor(name: string, sequencesAsInput: ISequence[]) {\n    this.uuid = generateUUIDv4();\n    this.name = name;\n    this.sequences = new Map<SequenceSortOptions, ISequence[]>();\n    this.sequences.set(SequenceSortOptions.INPUT, sequencesAsInput);\n    this.targetSequence = sequencesAsInput[0];\n    this.predictedNT = true;\n\n    //\n    //generate statistics\n    //\n    const start = new Date();\n    const allLetters: { [key: string]: number } = {}; //all letters in the alignment\n\n    //this for loop takes the bulk of the time\n    for (\n      let sequenceIdx = 0;\n      sequenceIdx < sequencesAsInput.length;\n      sequenceIdx++\n    ) {\n      const seq = sequencesAsInput[sequenceIdx].sequence;\n      for (let positionIdx = 0; positionIdx < seq.length; positionIdx++) {\n        const letter = seq[positionIdx];\n        const letterIsAlpha = letter.match(/[a-z]/i) ? true : false;\n        if (\n          letterIsAlpha &&\n          this.predictedNT &&\n          Nucleotide.fromSingleLetterCode(letter) === Nucleotide.UNKNOWN\n        ) {\n          this.predictedNT = false;\n        }\n\n        const position = positionIdx; // zero based\n        allLetters[letter] = 1;\n\n        let letterCounts = this.positionalLetterCounts.get(position);\n        if (!letterCounts) {\n          letterCounts = {};\n          this.positionalLetterCounts.set(position, letterCounts);\n        }\n        if (letter in letterCounts === false) {\n          letterCounts[letter] = 0;\n        }\n        letterCounts[letter] += 1;\n\n        if (letterIsAlpha) {\n          if (letter in this.globalAlphaLetterCounts === false) {\n            this.globalAlphaLetterCounts[letter] = 0;\n          }\n          this.globalAlphaLetterCounts[letter] += 1;\n        }\n      }\n    }\n\n    this.allUpperAlphaLettersSorted = Object.keys(allLetters)\n      .sort()\n      .reduce((arr: string[], value: string) => {\n        if (value.match(/[A-Z]/)) {\n          // only keep letters\n          arr.push(value);\n        }\n        return arr;\n      }, []);\n\n    this.consensus = Array.from(this.positionalLetterCounts).map(\n      ([position, letterCounts]) => {\n        const topLetter = Object.keys(letterCounts).reduce((a, b) => {\n          const aIsLetter = a.match(/[a-z]/i);\n          const bIsLetter = b.match(/[a-z]/i);\n          if (aIsLetter && !bIsLetter) {\n            return a;\n          }\n          if (bIsLetter && !aIsLetter) {\n            return b;\n          }\n          return letterCounts[a] > letterCounts[b] ? a : b;\n        });\n        return {\n          position: position,\n          letter: topLetter,\n          occurrences: letterCounts[topLetter],\n        };\n      }\n    );\n    console.log(\n      \"done parsing alignment. took \" +\n        (new Date().getTime() - start.getTime()) +\n        \"ms\"\n    );\n  }\n\n  /**\n   * Is this alignment predicted to be nucleotides?\n   * @returns true if it is predicted to be nucleotide sequences.\n   */\n  getPredictedType(): AlignmentTypes {\n    return this.predictedNT\n      ? AlignmentTypes.NUCLEOTIDE\n      : AlignmentTypes.AMINOACID;\n  }\n\n  /**\n   * Returns a default nucleotide or amino acid style for this alignment,\n   * predicted from the sequence itself.\n   */\n  getDefaultStyle(): AminoAcidAlignmentStyle | NucleotideAlignmentStyle {\n    return this.predictedNT\n      ? new NucleotideAlignmentStyle()\n      : new AminoAcidAlignmentStyle();\n  }\n\n  /**\n   * Get a unique uuid for this alignment.\n   * @returns a uuid string for this alignment\n   */\n  getUUID() {\n    return this.uuid;\n  }\n\n  /**\n   * Get the name of this alignment\n   * @returns a name for the alignment - usually the filename\n   */\n  getName() {\n    return this.name;\n  }\n\n  /**\n   * Get an ace editor mode for this alignemnt. If one doesn't exist\n   * then it will be defined.\n   * @returns the ace editor mode for this alignment\n   */\n  getAceEditorMode() {\n    if (!this.aceEditorMode) {\n      this.aceEditorMode = \"ace/mode/\" + this.uuid;\n      defineNewAlignmentMode(this.aceEditorMode, this);\n    }\n    return this.aceEditorMode;\n  }\n\n  /**\n   * Get the consensus sequence\n   * @returns a position ordered array of objects that contain each letter, its number of\n   *          occurrences, and the actual position number\n   */\n  getConsensus() {\n    return this.consensus;\n  }\n\n  /**\n   * Get the number of gaps at each position\n   * @returns an array of gap counts, ordered by position\n   */\n  getGapsPerColumn(): number[] {\n    return Array.from(this.positionalLetterCounts).map(\n      ([position, letterCounts]) => {\n        return !isNaN(letterCounts[\"-\"]) ? letterCounts[\"-\"] : 0;\n      }\n    );\n  }\n\n  /**\n   * Get the number of gaps at a specific position\n   * @returns the gap counts at the specified position\n   */\n  getGapCountAtColumn(position: number): number {\n    const letterCounts = this.positionalLetterCounts.get(position);\n    if (!letterCounts || !letterCounts[\"-\"]) {\n      return 0;\n    }\n    return letterCounts[\"-\"];\n  }\n\n  /**\n   * Get the total number of times each letter appears in the alignment.\n   * @param normalize if true, will normalize the returned array such that\n   *                  it sums to 1.\n   * @param validLetters if provided, only those letters will be included\n   *                     in the resulting counts\n   */\n  getGlobalAlphaLetterCounts(normalize?: boolean, validLetters?: string[]) {\n    if (normalize) {\n      return Alignment.normalizeLetterCounts(\n        this.globalAlphaLetterCounts,\n        validLetters\n      );\n    }\n    return this.globalAlphaLetterCounts;\n  }\n\n  /**\n   * Get the length of the longest sequence\n   * @returns the length of the largest sequence in this alignment\n   */\n  getMaxSequenceLength(): number {\n    return this.getSequences().reduce((acc, seq) => {\n      if (seq.sequence.length > acc) {\n        acc = seq.sequence.length;\n      }\n      return acc;\n    }, -1);\n  }\n\n  /**\n   * Get the frequencies of all letters in this alignment for each position.\n   * @param normalize if true, will normalize the returned letter counts for each\n   *                  position such that each sums to 1.\n   * @param validLetters if provided, only those letters will be included\n   *                     in the resulting counts\n   * @returns a Map whose keys are position (ordered) and values are a dictionary\n   *          with [key = letter (e.g., amino acid code)] and [value = # occurrences].\n   * TODO: Test parameter use cases.\n   */\n  getPositionalLetterCounts(asFraction?: boolean, validLetters?: string[]) {\n    if (asFraction || validLetters) {\n      return Array.from(this.positionalLetterCounts).reduce(\n        (acc, [position, letterCounts]) => {\n          acc.set(\n            position,\n            asFraction\n              ? Alignment.normalizeLetterCounts(letterCounts, validLetters) // normalize + remove invalid letters\n              : Object.keys(letterCounts).reduce((acc2, letter) => {\n                  //don't normalize, but remove invalid letters\n                  if (validLetters!.includes(letter)) {\n                    acc2[letter] = letterCounts[letter];\n                  }\n                  return acc2;\n                }, {} as { [letter: string]: number })\n          );\n          return acc;\n        },\n        new Map<Number, { [letter: string]: number }>()\n      );\n    }\n    return this.positionalLetterCounts;\n  }\n\n  /**\n   * Get all the sequences in this alignment - ordered as they were input\n   * @param sortBy specifies the order of the returned sequences. If it isn't\n   *               provided, returns the sequences as they were input to create\n   *               the Alignment object, e.g., usually fasta order.\n   * @param forceReSort if provided, sequences are forced to be re-sorted (rather\n   *                    than possibly cached)\n   * @returns all sequences in this alignment\n   */\n  getSequences(\n    sortBy?: SequenceSortOptions,\n    forceReSort?: boolean\n  ): ISequence[] {\n    sortBy = sortBy ? sortBy : SequenceSortOptions.INPUT;\n    forceReSort = forceReSort ? forceReSort : false;\n    if (!this.sequences.has(sortBy) || forceReSort) {\n      //cache not yet populated for this sort option\n      switch (sortBy) {\n        case SequenceSortOptions.INPUT:\n          break;\n        case SequenceSortOptions.HAMMING_DIST_TARGET:\n          this.sequences.set(\n            sortBy,\n            this.sortByDistanceToTargetSequence(\n              SequenceSortOptions.HAMMING_DIST_TARGET.distanceFn!\n            )\n          );\n          break;\n        default:\n          throw Error(\n            `The sortBy option provided \"${sortBy}\" is not implemented`\n          );\n      }\n    }\n    return this.sequences.get(sortBy)!;\n  }\n\n  /**\n   * Get a sorted list of all of the letters in the alignment.\n   * @returns a list of all letters in the alignment sorted alphabetically.\n   */\n  getSortedUpperAlphaLetters(): string[] {\n    return this.allUpperAlphaLettersSorted;\n  }\n\n  /**\n   * Get all the first sequence in the alignment, aka, target / query / first\n   * @returns all sequences in this alignment\n   */\n  getTargetSequence(): ISequence {\n    return this.targetSequence;\n  }\n\n  /**\n   * Set the target sequence\n   * @param newTarget The new target sequence. Must already exist in the alignment.\n   * @throws an error if the target sequence does not yet exist in the alignment\n   *\n   * IMPORTANT: Requires re-sorting\n   */\n  setTargetSequence(newTarget: ISequence) {\n    const targetInAlignment = this.getSequences().find((seq) => {\n      if (seq === newTarget) {\n        return true;\n      }\n      return false;\n    });\n    if (targetInAlignment !== undefined) {\n      this.targetSequence = newTarget;\n\n      this.sequences.forEach(\n        (sequences: ISequence[], sortBy: SequenceSortOptions) => {\n          this.getSequences(sortBy, true); // force re-sorting, which updates cache\n        }\n      );\n    } else {\n      throw Error(\"target sequence does not exist in alignment\");\n    }\n  }\n\n  /**\n   * This method sorts sequences or\n   * Sort the current alignment similarity to the target sequence\n   * @returns a new alignment whose sequences are sorted in descending\n   *          order by similarity to the target sequence.\n   */\n  private sortByDistanceToTargetSequence(distFn: DistanceFunctions) {\n    const inputSequences = this.getSequences();\n    switch (distFn) {\n      case DistanceFunctions.hamming:\n        return inputSequences\n          .map((s) => s)\n          .sort((seq1, seq2) => {\n            const dist1 = Alignment.getSequenceDistance(\n              this.targetSequence,\n              seq1,\n              DistanceFunctions.hamming\n            );\n            const dist2 = Alignment.getSequenceDistance(\n              this.targetSequence,\n              seq2,\n              DistanceFunctions.hamming\n            );\n            return dist1 - dist2;\n          });\n      default:\n        throw Error(\n          `The distFn option provided \"${distFn}\" is not implemented`\n        );\n    }\n  }\n}\n","import { Ace } from \"ace-builds\";\n\n/**\n * ScrollSync.ts\n * This helper is used to synchronize the different ace and div scrolling\n * scrolling.\n *\n * Example usage:\n *     import ScrollSync from './ScrollSync';\n *     let scrollSyncV = new ScrollSync(ScrollType.vertical);\n *     scrollSyncV.registerScroller(domElement);\n *     scrollSyncV.registerScroller(aceEditor);\n *\n * Ideas adapted to work with both dom elements and ace from 2 projects\n * (each of which are aimed at dom elements):\n *   https://github.com/okonet/react-scroll-sync\n *   https://github.com/AhmadMHawwash/scroll-sync-react\n */\nexport enum ScrollType {\n  vertical,\n  horizontal,\n  both,\n}\n\nexport class ScrollSync {\n  private scrollDirection: ScrollType.vertical | ScrollType.horizontal;\n  private aceEditorDirection: \"changeScrollLeft\" | \"changeScrollTop\";\n  private scrollers: (Ace.Editor | HTMLElement)[];\n\n  //reuse the same scroll functions for each element / ace editor\n  private scrollFnHandles: Map<\n    Ace.Editor | HTMLElement,\n    (this: HTMLElement) => any\n  >;\n\n  /*\n   *\n   *\n   * PUBLIC METHODS\n   *\n   *\n   */\n  constructor(scrollDirection: ScrollType.vertical | ScrollType.horizontal) {\n    this.scrollDirection = scrollDirection;\n    this.aceEditorDirection =\n      scrollDirection === ScrollType.horizontal\n        ? \"changeScrollLeft\"\n        : \"changeScrollTop\";\n    this.scrollers = [];\n    this.scrollFnHandles = new Map<\n      Ace.Editor | HTMLElement,\n      (this: HTMLElement) => any\n    >();\n  }\n\n  /**\n   * Register a scroller with this scroll sync. By attaching\n   * the scroll events only when a scroll is possible, we avoid\n   * ths jerky-ness and potential forever loop of one scroll\n   * updating another back and forth.\n   * @param scroller\n   */\n  registerElementScroller(scroller: HTMLElement) {\n    if (!this.scrollers.includes(scroller)) {\n      this.scrollers.push(scroller);\n      scroller.addEventListener(\"mouseenter\", () => {\n        this.addScrollEvents(scroller);\n      });\n      scroller.addEventListener(\"mouseleave\", () => {\n        this.removeScrollEvents(scroller);\n      });\n    }\n  }\n\n  /**\n   * Register a scroller with this scroll sync. By attaching\n   * the scroll events only when a scroll is possible, we avoid\n   * ths jerky-ness and potential forever loop of one scroll\n   * updating another back and forth.\n   * Note - the ace editor doesn't have a native mouseenter/leave\n   * so we need to use the parent element's event listeners.\n   * @param scroller\n   */\n  registerAceScroller(scroller: Ace.Editor, parentElem: HTMLElement) {\n    if (!this.scrollers.includes(scroller)) {\n      this.scrollers.push(scroller);\n\n      parentElem.addEventListener(\"mouseenter\", () => {\n        this.addScrollEvents(scroller);\n      });\n      parentElem.addEventListener(\"mouseleave\", () => {\n        this.removeScrollEvents(scroller);\n      });\n    }\n  }\n\n  /**\n   * Deregister a scroller with this scroll sync\n   * Requires removal of mouse events also ..\n   * @param scroller\n   */\n  //unRegisterScroller(scroller: HTMLElement | Ace.Editor) {\n  //  this.scrollers = this.scrollers.filter((s) => s !== scroller);\n  //  this.removeScrollEvents(scroller);\n  //}\n\n  /*\n   *\n   *\n   * PRIVATE METHODS\n   *\n   *\n   */\n  private isAceEditor(x: Ace.Editor | HTMLElement): x is Ace.Editor {\n    return \"renderer\" in x;\n  }\n\n  /**\n   * Execute the scroll changes to all group scrollers.\n   *\n   * Note: the reason for jumpy scrolling I think is due\n   * to easing from the scroller, that doesn't happen with the\n   * scrollSibling. I'm not sure how to fix (one thought was\n   * to cancel the scroll event and set the position myself,\n   * but one can't cancel a scroll event).\n   */\n  private handleScroll = (\n    scroller: Ace.Editor | HTMLElement,\n    event?: Event\n  ) => {\n    const siblingScrollers = this.scrollers.filter(\n      (possibleSib) => possibleSib !== scroller\n    );\n    siblingScrollers.forEach((siblingScroller) => {\n      this.syncScrollPosition(scroller, siblingScroller);\n    });\n  };\n\n  /**\n   * This function executes the actual position sync\n   * @param scroller\n   * @param siblingScroller\n   */\n  private syncScrollPosition(\n    scroller: Ace.Editor | HTMLElement,\n    siblingScroller: Ace.Editor | HTMLElement\n  ) {\n    if (this.scrollDirection === ScrollType.horizontal) {\n      const newScrollLeft = this.isAceEditor(scroller)\n        ? scroller.session.getScrollLeft()\n        : scroller.scrollLeft;\n\n      if (this.isAceEditor(siblingScroller)) {\n        if (siblingScroller.session.getScrollLeft() !== newScrollLeft) {\n          siblingScroller.session.setScrollLeft(newScrollLeft);\n        }\n      } else if (siblingScroller.scrollLeft !== newScrollLeft) {\n        siblingScroller.scrollLeft = newScrollLeft;\n      }\n    } else {\n      const newScrollTop = this.isAceEditor(scroller)\n        ? scroller.session.getScrollTop()\n        : scroller.scrollTop;\n\n      if (this.isAceEditor(siblingScroller)) {\n        if (siblingScroller.session.getScrollTop() !== newScrollTop) {\n          siblingScroller.session.setScrollTop(newScrollTop);\n        }\n      } else if (siblingScroller.scrollTop !== newScrollTop) {\n        siblingScroller.scrollTop = newScrollTop;\n      }\n    }\n  }\n\n  /**\n   * Add event listeners and functions from a particular scroller\n   * @param scroller\n   */\n  private addScrollEvents(scroller: Ace.Editor | HTMLElement) {\n    if (!this.scrollFnHandles.has(scroller)) {\n      this.scrollFnHandles.set(\n        scroller,\n        this.handleScroll.bind(this, scroller)\n      );\n    }\n\n    const scrollFn = this.scrollFnHandles.get(scroller)!;\n    if (this.isAceEditor(scroller)) {\n      scroller.session.on(this.aceEditorDirection, scrollFn);\n    } else {\n      scroller.addEventListener(\"scroll\", scrollFn);\n    }\n  }\n\n  /**\n   * Remove event listeners and functions from a particular scroller\n   * @param scroller\n   */\n  private removeScrollEvents(scroller: Ace.Editor | HTMLElement) {\n    const scrollFn = this.scrollFnHandles.get(scroller);\n    if (scrollFn) {\n      if (this.isAceEditor(scroller)) {\n        scroller.session.off(this.aceEditorDirection, scrollFn);\n      } else {\n        scroller.removeEventListener(\"scroll\", scrollFn);\n      }\n    } else {\n      console.log(\"failed to remove scrollFn\");\n    }\n  }\n}\n","/**\n * AceAlignmentMode.js\n * This file defines an alignment highlight mode form ace editor documents.\n */\n\nimport { default as ace } from \"ace-builds\";\nimport { Alignment } from \"./Alignment\";\nimport { getLetterClassNames } from \"./MolecularStyles\";\n\ninterface IAceType {\n  [key: string]: any;\n}\n\nexport function defineNewAlignmentMode(mode: string, alignment: Alignment) {\n  const modeSplit = mode.split(\"/\");\n  if (\n    modeSplit.length !== 3 ||\n    modeSplit[0] !== \"ace\" ||\n    modeSplit[1] !== \"mode\"\n  ) {\n    throw Error(\"ace mode name must be of the form '/ace/mode/MODENAME'\");\n  }\n  const modeName = mode.split(\"/\")[2];\n\n  (ace as IAceType).define(\n    \"ace/mode/\" + modeName + \"_highlight_rules\",\n    function (require: Function, exports: any, module: any) {\n      var oop = require(\"../lib/oop\");\n      var TextHighlightRules = require(\"./text_highlight_rules\")\n        .TextHighlightRules;\n\n      /**\n       * Rules parse individual characters in the editor and assign classes\n       * to each character. Note that characters will be grouped together\n       * if they match the same rule and are side by side.\n       */\n      var AlignmentHighlightRules = function (this: any) {\n        //We define an alignment-specific set of rules that will\n        //add classes including whether a character matches the\n        //consensus sequence, matches the query etc.\n        let rules: {\n          [key: string]: {\n            token: (letter: string) => void;\n            regex: RegExp;\n            next: string;\n          }[];\n        } = {};\n\n        //note: this is by far the thing that kills performance the most\n        //      I'm not sure whether it is due to how it parses (state machine)\n        //      slowing things down, or whether it is an issue with attaching\n        //      ~4 classes to every single residue -- either way, removing parsing\n        //      all together makes it much more snappy and also decreases the\n        //      memory footprint drastically.\n        const re = /./;\n        const statePrefix = \"p\";\n        for (let i = 0; i < alignment.getMaxSequenceLength(); i++) {\n          const stateName = i === 0 ? \"start\" : statePrefix + i;\n          const nextStateName =\n            i === alignment.getMaxSequenceLength() - 1\n              ? \"start\"\n              : statePrefix + (i + 1);\n\n          rules[stateName] = [\n            {\n              token: function (letter: string) {\n                const toreturn = getLetterClassNames(\n                  letter,\n                  letter === alignment.getConsensus()[i].letter,\n                  letter === alignment.getTargetSequence().sequence[i],\n                  true\n                );\n                return toreturn;\n              },\n              regex: re,\n              next: nextStateName,\n            },\n          ];\n        }\n        this.$rules = rules;\n      };\n\n      oop.inherits(AlignmentHighlightRules, TextHighlightRules);\n\n      exports.AlignmentHighlightRules = AlignmentHighlightRules;\n    }\n  );\n\n  (ace as IAceType).define(\"ace/mode/\" + modeName, function (\n    require: Function,\n    exports: any,\n    module: any\n  ) {\n    var oop = require(\"../lib/oop\");\n    var TextMode = require(\"../mode/text\").Mode;\n    var Tokenizer = require(\"../tokenizer\").Tokenizer;\n    var AlignmentHighlightRules = require(\"ace/mode/\" +\n      modeName +\n      \"_highlight_rules\").AlignmentHighlightRules;\n\n    const Mode = function (this: any) {\n      this.$tokenizer = new Tokenizer(new AlignmentHighlightRules().getRules());\n    };\n\n    oop.inherits(Mode, TextMode);\n\n    (function () {\n      // Extra logic goes here. (see below)\n    }.call(Mode.prototype));\n\n    exports.Mode = Mode;\n  });\n}\n","/**\n *\n * Sequence logo component.\n * Inspired / derived from https://github.com/weng-lab/logojs-package\n *  (but much simpler)\n */\n\nimport React from \"react\";\nimport { Alignment } from \"../common/Alignment\";\nimport { GlyphFactory } from \"../common/SequenceLogoGlyphs\";\nimport {\n  aceResidueParentClass,\n  getLetterClassNames,\n} from \"../common/MolecularStyles\";\n\nexport enum LOGO_TYPES {\n  LETTERS = \"letter stack\",\n  BARS = \"bar plot\",\n}\n\ninterface IGlyphFrequency {\n  frequency: number;\n  letter: {\n    letter: string;\n    classNames: string;\n  };\n}\ninterface IGlyphStack extends Array<IGlyphFrequency> {}\n\nexport interface ISequenceLogoProps {\n  alignment: Alignment;\n  glyphWidth: number;\n  logoType?: LOGO_TYPES;\n\n  logoLoaded?(node: HTMLDivElement): void;\n\n  readonly id: string;\n}\n\nexport class SequenceLogoComponent extends React.Component<ISequenceLogoProps> {\n  private scrollerDiv?: HTMLDivElement | null;\n  private loaded: boolean = false;\n\n  static defaultProps = {\n    logoType: LOGO_TYPES.LETTERS,\n  };\n\n  divLoaded(e: HTMLDivElement | null) {\n    if (e && !this.scrollerDiv) {\n      //only run if first time element available\n      this.scrollerDiv = e;\n      if (this.props.logoLoaded) {\n        this.props.logoLoaded(this.scrollerDiv);\n      }\n    }\n  }\n\n  shouldComponentUpdate(nextProps: ISequenceLogoProps) {\n    if (\n      this.loaded === false ||\n      this.props.logoType !== nextProps.logoType ||\n      this.props.glyphWidth !== nextProps.glyphWidth ||\n      this.props.alignment !== nextProps.alignment\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  render() {\n    if (!this.props.alignment || !this.props.glyphWidth) {\n      return null;\n    }\n\n    const positionalLetterCounts = this.props.alignment.getPositionalLetterCounts();\n    const lettersSorted = this.props.alignment.getSortedUpperAlphaLetters();\n\n    //calculate the frequencies of all letters in each column\n    const frequencies: number[][] = [];\n    positionalLetterCounts.forEach((letterCounts, position) => {\n      const totalCountAtPosition = Object.keys(letterCounts).reduce(\n        (total, letter) => {\n          total += letterCounts[letter];\n          return total;\n        },\n        0\n      );\n\n      const frequenciesAtPosition: number[] = lettersSorted.map((letter) => {\n        let freq = 0;\n        if (letter in letterCounts) {\n          freq = letterCounts[letter] / totalCountAtPosition;\n        }\n        return freq;\n      });\n\n      frequencies.push(frequenciesAtPosition);\n    });\n\n    //load alphabet information\n    const sortedAlphabet = lettersSorted.map((letter) => {\n      return {\n        letter: letter,\n        classNames: getLetterClassNames(letter, false, false, false),\n      };\n    });\n\n    //munge in alphabet and sort by frequency\n    const logoData = frequencies.map((frequenciesAtPosition, positionIdx) => {\n      return frequenciesAtPosition\n        .map((frequency, letterIdx) => {\n          return {\n            frequency: frequency,\n            letter: sortedAlphabet[letterIdx],\n          };\n        })\n        .filter((freq) => {\n          return freq.frequency !== 0;\n        })\n        .sort((a, b) => (a.frequency > b.frequency ? 1 : -1));\n    });\n\n    const totalWidth = frequencies.length * this.props.glyphWidth;\n    const totalHeight = 100;\n    this.loaded = true;\n\n    /**\n     * Generate the svg elements for a single position, i.e., column\n     *\n     */\n    const generateStack = (positionalFrequencies: IGlyphStack) => {\n      let dy = 100;\n\n      return positionalFrequencies.map((freq, idx) => {\n        dy = dy - freq.frequency * 100;\n\n        if (this.props.logoType === LOGO_TYPES.BARS) {\n          const xscale = 2 / logoData.length; // not exact, but works.\n          return (\n            <rect\n              width=\"100\"\n              height=\"100\"\n              transform={`translate(0, ${dy}) scale(${xscale},${freq.frequency})`}\n              className={freq.letter.classNames}\n              key={`idxrect_${idx}`}\n            ></rect>\n          );\n        }\n\n        const xscale = 0.009; // invariant scaling\n        const selectedGlyph = GlyphFactory.glyphFromChar(freq.letter.letter)({\n          className: freq.letter.classNames,\n          transform: `translate(0, ${dy}) scale(${xscale},${freq.frequency})`,\n          key: `idxglyph_${idx}`,\n        });\n        return selectedGlyph;\n      });\n    };\n\n    return (\n      <div id={this.props.id} ref={(e) => this.divLoaded(e)}>\n        <svg\n          preserveAspectRatio=\"none\"\n          viewBox={`0 0 ${logoData.length} 100`}\n          style={{ width: totalWidth, height: totalHeight }}\n          xmlns=\"http://www.w3.org/2000/svg\"\n        >\n          {logoData.map((singlePositionData, positionIdx) => {\n            return (\n              <g\n                transform={`translate(${positionIdx},0)`}\n                key={\"p_\" + positionIdx}\n                className={aceResidueParentClass} //required for default coloring\n              >\n                {generateStack(singlePositionData)}\n              </g>\n            );\n          })}\n        </svg>\n      </div>\n    );\n  }\n}\n","import React from \"react\";\nimport _ from \"lodash\";\nimport \"./SequenceBarplot.scss\";\nimport { Alignment } from \"../common/Alignment\";\nimport { mapGroupBy } from \"../common/Utils\";\nimport ReactTooltip from \"react-tooltip\";\n\nexport interface ISequenceBarplotDataSeries {\n  id: string; //must be unique for each series\n  name: string;\n  cssClass: string;\n  plotOptions?: {\n    fixYMax?(alignment: Alignment): number; //defaults to data max\n    //fixYMin?: number; //defaults to data min\n  };\n  getPositionalInfo(pos: number, alignment: Alignment): ISingleBarDetails;\n}\n\nexport interface ISequenceBarplotProps {\n  alignment: Alignment;\n  dataSeries: ISequenceBarplotDataSeries[];\n  positionWidth: number;\n\n  height?: number;\n  onPositionSelectionChanged?(\n    positionsSelected: {\n      position: number;\n      element: SVGRectElement;\n      bars: ISingleBarDetailsFull[];\n    }[]\n  ): void;\n  onPositionMouseEnter?(\n    position: number,\n    element: SVGRectElement,\n    bars: ISingleBarDetailsFull[]\n  ): void;\n  onPositionMouseLeave?(\n    position: number,\n    element: SVGRectElement,\n    bars: ISingleBarDetailsFull[]\n  ): void;\n}\n\ninterface ISingleBarDetails {\n  height: number;\n}\ninterface ISingleBarDetailsFull extends ISingleBarDetails {\n  normalizedHeight: number;\n  position: number;\n  dataSeries: ISequenceBarplotDataSeries;\n}\ninterface ISequenceBarplotState {\n  positionHovered?: {\n    position: number;\n    element: SVGRectElement;\n    bars: ISingleBarDetailsFull[];\n  };\n  positionsSelected: {\n    position: number;\n    element: SVGRectElement;\n    bars: ISingleBarDetailsFull[];\n  }[];\n  svgHovered: boolean;\n}\n\nexport class SequenceBarplotComponent extends React.Component<\n  ISequenceBarplotProps,\n  ISequenceBarplotState\n> {\n  private static POSITION_VIEWBOX_HEIGHT = 100;\n  private static POSITION_VIEWBOX_WIDTH = 20;\n\n  private cache: Partial<ISequenceBarplotProps> & {\n    bars?: ISingleBarDetailsFull[];\n    barsGroupedByPosition?: Map<number, ISingleBarDetailsFull[]>;\n    barsGroupedByDataseries?: Map<\n      ISequenceBarplotDataSeries,\n      ISingleBarDetailsFull[]\n    >;\n  } = {};\n\n  static defaultProps = {\n    height: 100,\n  };\n\n  constructor(props: ISequenceBarplotProps) {\n    super(props);\n    this.state = {\n      svgHovered: false,\n      positionsSelected: [],\n    };\n    this.handleSvgHover = this.handleSvgHover.bind(this);\n    this.handlePositionHover = this.handlePositionHover.bind(this);\n    this.handlePositionClicked = this.handlePositionClicked.bind(this);\n  }\n\n  public static ENTROPY_BARPLOT: ISequenceBarplotDataSeries = {\n    id: \"entropy\",\n    name: \"Entropy\",\n    cssClass: \"barplot-entropy\",\n    getPositionalInfo: (pos, al) => {\n      const plc = al\n        .getPositionalLetterCounts(true, al.getSortedUpperAlphaLetters())\n        .get(pos);\n      return {\n        height:\n          !plc || Object.keys(plc).length === 0\n            ? 0\n            : -1 *\n              Object.values(plc).reduce((acc, frac) => {\n                return acc + frac * Math.log2(frac);\n              }, 0),\n      };\n    },\n  };\n\n  public static GAPS_BARPLOT: ISequenceBarplotDataSeries = {\n    id: \"gaps\",\n    name: \"Gaps\",\n    cssClass: \"barplot-gaps\",\n    plotOptions: {\n      fixYMax: (alignment) => alignment.getSequences().length,\n    },\n    getPositionalInfo: (pos, al) => {\n      return {\n        height: al.getGapCountAtColumn(pos),\n      };\n    },\n  };\n\n  /**\n   *\n   *\n   * HELPER FUNCTIONS\n   *\n   *\n   */\n\n  private handleSvgHover(isHovered: boolean) {\n    this.setState({\n      svgHovered: isHovered,\n    });\n  }\n\n  private handlePositionHover(\n    event: React.MouseEvent<SVGElement, MouseEvent>,\n    position: number,\n    isHovered: boolean\n  ) {\n    const { onPositionMouseEnter, onPositionMouseLeave } = this.props;\n    if (isHovered && onPositionMouseEnter) {\n      //notify parent listeners\n      onPositionMouseEnter(\n        position,\n        event.relatedTarget as SVGRectElement,\n        this.getBars().barsGroupedByPosition.get(position)!\n      );\n    } else if (!isHovered && onPositionMouseLeave) {\n      onPositionMouseLeave(\n        position,\n        event.relatedTarget as SVGRectElement,\n        this.getBars().barsGroupedByPosition.get(position)!\n      );\n    }\n    this.setState({\n      positionHovered: isHovered\n        ? {\n            position: position,\n            element: event.relatedTarget as SVGRectElement,\n            bars: this.getBars().barsGroupedByPosition.get(position)!,\n          }\n        : undefined,\n    });\n  }\n\n  private handlePositionClicked(\n    event: React.MouseEvent<SVGElement, MouseEvent>,\n    position: number\n  ) {\n    const { positionsSelected } = this.state;\n    const { onPositionSelectionChanged } = this.props;\n    const newPositionsSelected = positionsSelected.some(\n      (p) => p.position === position\n    )\n      ? positionsSelected.filter((p) => p.position !== position)\n      : [\n          ...positionsSelected,\n          {\n            position: position,\n            element: event.relatedTarget as SVGRectElement,\n            bars: this.getBars().barsGroupedByPosition.get(position)!,\n          },\n        ];\n    if (onPositionSelectionChanged) {\n      onPositionSelectionChanged(newPositionsSelected);\n    }\n    this.setState({\n      positionsSelected: newPositionsSelected,\n    });\n  }\n\n  /**\n   * Normalize bars to fall between 0 and POSITION_MAX_HEIGHT in svg space. Obey the\n   * fixYMax if specified\n   * @param bars the same bars as input, with the \"normalizeHeight\"\n   *             attribute added\n   */\n  private normalizeBarHeights(\n    bars: ISingleBarDetailsFull[]\n  ): ISingleBarDetailsFull[] {\n    const { alignment } = this.props;\n    const allHeights = bars.map((bar) => bar.height);\n    const overallMinHeight = Math.min(...allHeights);\n    const overallMaxHeight = Math.max(...allHeights);\n    return bars.map((bar) => {\n      const minHeight = overallMinHeight;\n      const maxHeight =\n        bar.dataSeries.plotOptions && bar.dataSeries.plotOptions.fixYMax\n          ? bar.dataSeries.plotOptions.fixYMax(alignment)\n          : overallMaxHeight;\n      return {\n        ...bar,\n        normalizedHeight:\n          ((bar.height - minHeight) / (maxHeight - minHeight)) *\n          SequenceBarplotComponent.POSITION_VIEWBOX_HEIGHT,\n      };\n    });\n  }\n\n  /**\n   * Get bars and bar groups.\n   * Calls prop.getPositionalInfo to calculate heights for each\n   * position. Uses cache to avoid too many updates.\n   */\n  private getBars() {\n    const { alignment, dataSeries } = this.props;\n    if (\n      !this.cache.bars ||\n      alignment !== this.cache.alignment ||\n      dataSeries !== this.cache.dataSeries\n    ) {\n      this.cache.alignment = alignment;\n      this.cache.dataSeries = dataSeries;\n\n      const maxSeqLength = alignment.getMaxSequenceLength();\n      let allBars: ISingleBarDetailsFull[] = [];\n      dataSeries.forEach((ds) => {\n        for (let i = 0; i < maxSeqLength; i++) {\n          allBars.push({\n            ...ds.getPositionalInfo(i, alignment),\n            position: i,\n            dataSeries: ds,\n            normalizedHeight: -1, // define below\n          });\n        }\n      });\n\n      //normalize bars group by group\n      this.cache.bars = Object.entries(\n        _.groupBy(allBars, (bar) => bar.dataSeries.id)\n      )\n        .map(([categoryId, categoryBars]) => {\n          return this.normalizeBarHeights(categoryBars);\n        })\n        .flat();\n\n      this.cache.barsGroupedByPosition = mapGroupBy(\n        this.cache.bars,\n        (bar) => bar.position\n      );\n\n      this.cache.barsGroupedByDataseries = mapGroupBy(\n        this.cache.bars,\n        (item) => item.dataSeries\n      );\n    }\n    return {\n      bars: this.cache.bars!,\n      barsGroupedByPosition: this.cache.barsGroupedByPosition!,\n      barsGroupedByDataseries: this.cache.barsGroupedByDataseries!,\n    };\n  }\n\n  /**\n   *\n   *\n   * JSX RENDER FUNCTIONS\n   *\n   *\n   */\n\n  /**\n   * Render the tooltip for a particular position.\n   */\n  private renderTooltip() {\n    const barsObj = this.getBars();\n    return (\n      <ReactTooltip\n        id=\"getBarContent\"\n        effect=\"solid\"\n        type=\"light\"\n        border={true}\n        getContent={(pos: string) => {\n          const posInt = parseInt(pos);\n          const barsAtPostion = barsObj.barsGroupedByPosition.get(posInt)!;\n          const posPlusOne = posInt + 1; // positions should be 1 based, not zero based\n          return !barsAtPostion ? undefined : (\n            <div className=\"bar-position-textblock\">\n              <h1>Position: {posPlusOne}</h1>\n              {barsAtPostion.map((bar) => {\n                return (\n                  <div\n                    className={`dataseries-line ${bar.dataSeries.cssClass}`}\n                    key={bar.dataSeries.id}\n                  >\n                    <span className=\"legend-square\"></span>\n                    <span className=\"legend-text\">\n                      {bar.dataSeries.name}: {+bar.height.toFixed(2)}\n                    </span>\n                  </div>\n                );\n              })}\n            </div>\n          );\n        }}\n      />\n    );\n  }\n\n  /**\n   * Render the bar plot svg, with each bar appearing as a single rectangle.\n   * Final form:\n   *    <svg ...>\n   *      <g position 1>\n   *         <rect transparant rectangle for interaction for position 1>\n   *         <rect for dataseries 1 position 1>\n   *         <rect for dataseries 2 position 1>\n   *      </g>\n   *      <g position 2>\n   *         <rect transparant rectangle for interaction for position 2>\n   *         <rect for dataseries 1 position 2>\n   *         <rect for dataseries 2 position 2>\n   *      </g>\n   *   </svg>\n   */\n  private renderBarPlot() {\n    const { alignment, positionWidth, height } = this.props;\n\n    const maxSeqLength = alignment.getMaxSequenceLength();\n    const totalWidth = positionWidth * maxSeqLength;\n\n    const barsObj = this.getBars();\n\n    return (\n      <svg\n        preserveAspectRatio=\"none\"\n        viewBox={`0 0 ${\n          maxSeqLength * SequenceBarplotComponent.POSITION_VIEWBOX_WIDTH\n        } ${SequenceBarplotComponent.POSITION_VIEWBOX_HEIGHT}`}\n        style={{ width: totalWidth, height: height }}\n        xmlns=\"http://www.w3.org/2000/svg\"\n        onMouseEnter={() => this.handleSvgHover(true)}\n        onMouseLeave={() => this.handleSvgHover(false)}\n      >\n        {Array.from(barsObj.barsGroupedByPosition.entries()).map(\n          ([pos, bars]) => {\n            const maxBarHeight = Math.max(\n              ...bars.map((bar) => bar.normalizedHeight)\n            );\n\n            return (\n              <g\n                transform={`translate(${\n                  pos * SequenceBarplotComponent.POSITION_VIEWBOX_WIDTH\n                },0)`}\n                className={\n                  this.state.positionsSelected.some((p) => p.position === pos)\n                    ? \"position-container selected\"\n                    : \"position-container\"\n                }\n                onClick={(event) => {\n                  this.handlePositionClicked(event, pos);\n                }}\n                onMouseEnter={(event) => {\n                  this.handlePositionHover(event, pos, true);\n                }}\n                onMouseLeave={(event) => {\n                  this.handlePositionHover(event, pos, false);\n                }}\n                data-for=\"getBarContent\"\n                data-tip={pos}\n                data-class={\"barplot-tooltip-container\"}\n                key={`pos_${pos}`}\n              >\n                {bars.map((bar, dataseriesIdx) => {\n                  return (\n                    <rect\n                      className={bar.dataSeries.cssClass}\n                      transform={`translate(${\n                        ((dataseriesIdx * 1) / bars.length) *\n                        SequenceBarplotComponent.POSITION_VIEWBOX_WIDTH\n                      },${\n                        SequenceBarplotComponent.POSITION_VIEWBOX_HEIGHT -\n                        bar.normalizedHeight\n                      })`}\n                      width={\n                        (1 / barsObj.barsGroupedByDataseries.size) *\n                        SequenceBarplotComponent.POSITION_VIEWBOX_WIDTH\n                      }\n                      height={bar.normalizedHeight}\n                      key={`${bar.position}_${bar.dataSeries.id}`}\n                    ></rect>\n                  );\n                })}\n\n                <rect\n                  className=\"interaction-placeholder\"\n                  transform={`translate(0,${\n                    SequenceBarplotComponent.POSITION_VIEWBOX_HEIGHT -\n                    maxBarHeight\n                  })`}\n                  width={SequenceBarplotComponent.POSITION_VIEWBOX_WIDTH}\n                  height={maxBarHeight}\n                ></rect>\n              </g>\n            );\n          }\n        )}\n      </svg>\n    );\n  }\n\n  render() {\n    const className = this.state.svgHovered ? \"barplot hovered\" : \"barplot\";\n\n    return !this.props.alignment ? null : (\n      <div className={className}>\n        {this.renderTooltip()}\n        {this.renderBarPlot()}\n      </div>\n    );\n  }\n}\n","import React from \"react\";\nimport { Alignment, SequenceSortOptions, ISequence } from \"../common/Alignment\";\nimport { Nucleotide, AminoAcid } from \"../common/Residues\";\nimport * as PIXI from \"pixi.js\";\nimport { PixiComponent, Stage, Sprite, AppContext } from \"@inlet/react-pixi\";\nimport { Viewport } from \"pixi-viewport\";\nimport { Graphics } from \"pixi.js\";\n\nimport {\n  IColorScheme,\n  PositionsToStyle,\n  AlignmentTypes,\n} from \"../common/MolecularStyles\";\n\nexport interface IAlignmentCanvasProps {\n  alignment: Alignment;\n  alignmentType: AlignmentTypes;\n  sortBy: SequenceSortOptions;\n  positionsToStyle: PositionsToStyle;\n  colorScheme: IColorScheme;\n  highlightRows?: [number, number]; //[startRowNum, endRowNum]\n  stageResolution?: {\n    width: number;\n    height: number;\n  };\n  viewportProps?: Partial<IViewportProps>;\n\n  mouseDown?(x: number, y: number): void;\n\n  readonly id: string;\n}\n\ninterface ITiledImages {\n  targetTileWidth: number;\n  targetTileHeight: number;\n  lastTileWidth: number;\n  lastTileHeight: number;\n  numXTiles: number;\n  numYTiles: number;\n  tiles: {\n    tileX: number;\n    tileY: number;\n    pixelX: number;\n    pixelY: number;\n    width: number;\n    height: number;\n    image: HTMLCanvasElement;\n  }[];\n}\n\nconst AlignmentHighlighter = PixiComponent(\"AlignmentHighlighter\", {\n  create: (props: any) => new Graphics(),\n  applyProps: (instance, _, props) => {\n    const { x, y, width, height, fillColor, fillAlpha } = props;\n    instance.clear();\n    instance.beginFill(fillColor, fillAlpha);\n    instance.drawRect(x, y, width, height);\n    instance.endFill();\n  },\n});\n\nexport class AlignmentCanvasComponent extends React.Component<\n  IAlignmentCanvasProps\n> {\n  app?: PIXI.Application;\n  scaleX: number = 1;\n  scaleY: number = 1;\n\n  static defaultProps = {\n    mouseDown: () => {},\n    stageResolution: {\n      width: 485,\n      height: 650,\n    },\n    viewportProps: {\n      useDrag: true,\n      usePinch: true,\n      useWheel: true,\n      zoomPercent: 0,\n    },\n  };\n\n  sliderChanged(newValue: number, xy: \"x\" | \"y\") {\n    if (this.app) {\n      this.app.stage.children.forEach((sprite) => {\n        if (xy === \"x\") {\n          sprite.scale.x = newValue;\n        } else {\n          sprite.scale.y = newValue;\n        }\n      });\n    }\n  }\n\n  render() {\n    const {\n      alignment,\n      alignmentType,\n      colorScheme,\n      highlightRows,\n      id,\n      positionsToStyle,\n      sortBy,\n      stageResolution,\n      viewportProps,\n    } = this.props;\n    if (!alignment) {\n      return null;\n    }\n    const numSequences = alignment.getSequences().length;\n    const maxSeqLength = alignment.getMaxSequenceLength();\n\n    PIXI.utils.skipHello();\n    PIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST; //\n    //TODO: still anti-aliases on retina devices. probably requires\n    //      writing 4x the pixels and telling pixi that it is a retina\n    //      image\n    //PIXI.settings.RESOLUTION = 2;\n    //PIXI.settings.ROUND_PIXELS = true; //\n    const height = highlightRows\n      ? highlightRows[1] - highlightRows[0]\n      : undefined;\n\n    return (\n      <div\n        id={id}\n        onWheel={this.onWheel}\n        onMouseEnter={this.onMouseEnter}\n        onMouseLeave={this.onMouseLeave}\n      >\n        <Stage\n          width={stageResolution?.width}\n          height={stageResolution?.height}\n          options={{ transparent: true }}\n        >\n          <AppContext.Consumer>\n            {(app) => {\n              this.app = app;\n              return <></>;\n            }}\n          </AppContext.Consumer>\n          <AppContext.Consumer>\n            {(app) => (\n              <PixiViewport\n                app={app}\n                numColumns={maxSeqLength}\n                numRows={numSequences}\n                mouseDown={this.props.mouseDown}\n                {...viewportProps}\n              >\n                <PixiAlignmentTiled\n                  id=\"tiled-alignment\"\n                  alignment={alignment}\n                  alignmentType={alignmentType}\n                  sortBy={sortBy}\n                  colorScheme={colorScheme}\n                  positionsToStyle={positionsToStyle}\n                />\n                {height ? (\n                  <>\n                    {this.renderAlignmentHighlighter({\n                      x: 0,\n                      y: this.props.highlightRows![0],\n                      width: maxSeqLength,\n                      height,\n                    })}\n                  </>\n                ) : (\n                  <></>\n                )}\n              </PixiViewport>\n            )}\n          </AppContext.Consumer>\n        </Stage>\n      </div>\n    );\n  }\n\n  protected renderAlignmentHighlighter = (props: {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    fillColor?: number;\n    fillAlpha?: number;\n  }) => (\n    <AlignmentHighlighter\n      {...{ fillColor: 0xff0000, fillAlpha: 0.25, ...props }}\n    />\n  );\n\n  protected onMouseEnter = (e: React.MouseEvent<HTMLDivElement>) => {\n    document.body.style.overflow = \"hidden\";\n  };\n\n  protected onMouseLeave = (e: React.MouseEvent<HTMLDivElement>) => {\n    document.body.style.overflow = \"auto\";\n  };\n\n  protected onWheel = (e: React.WheelEvent<HTMLDivElement>) => {\n    //e.preventDefault(); //TODO Drew is this necessary?\n  };\n}\nclass PixiAlignmentTiled extends React.Component<IAlignmentCanvasProps> {\n  shouldComponentUpdate(nextProps: IAlignmentCanvasProps) {\n    const toReturn =\n      nextProps.alignment !== this.props.alignment ||\n      nextProps.colorScheme !== this.props.colorScheme ||\n      nextProps.positionsToStyle !== this.props.positionsToStyle ||\n      nextProps.sortBy !== this.props.sortBy;\n    /*console.log(\n      \"UPDATING Canvas Tiling: \" +\n        (nextProps.colorScheme !== this.currentColorScheme) +\n        \":\" +\n        (nextProps.positionsToStyle !== this.currentPositionsStyled) +\n        \" :: \" +\n        toReturn\n    );*/\n    //console.log(\"CANVAS rerender??\");\n    return toReturn;\n  }\n\n  render() {\n    if (!this.props.alignment) {\n      return null;\n    }\n\n    const {\n      alignment,\n      alignmentType,\n      colorScheme,\n      positionsToStyle,\n      sortBy,\n    } = this.props;\n\n    // Generate multiple tiled images from the alignment\n    const sequences = alignment.getSequences(sortBy);\n    const fullWidth = alignment.getMaxSequenceLength();\n    const fullHeight = sequences.length;\n\n    const sizes = {\n      fullWidth,\n      fullHeight,\n      targetTileWidth: Math.min(400, fullWidth),\n      targetTileHeight: Math.min(400, fullHeight),\n    };\n\n    const tiledImages: ITiledImages = this.initializeTiledImages(sizes);\n\n    for (\n      let tileYNumber = 0;\n      tileYNumber < tiledImages.numYTiles;\n      tileYNumber++\n    ) {\n      for (\n        let tileXNumber = 0;\n        tileXNumber < tiledImages.numXTiles;\n        tileXNumber++\n      ) {\n        const tiledImage = this.generateCanvasForTile(\n          tileXNumber,\n          tileYNumber,\n          sizes.targetTileWidth,\n          sizes.targetTileHeight,\n          tiledImages,\n          sequences\n        );\n        tiledImages.tiles.push(tiledImage);\n      }\n    }\n\n    //console.log(\"CANVAS rerender [\" + sortBy.key + \"]\", sequences);\n    return (\n      <>\n        {tiledImages.tiles.map((tile) => (\n          <Sprite\n            source={tile.image}\n            x={tile.pixelX}\n            y={tile.pixelY}\n            key={`${tile.tileX}_\n                  ${tile.tileY}_\n                  ${colorScheme.commonName}_\n                  ${positionsToStyle.key}_\n                  ${alignmentType.key}_\n                  ${sortBy.key}_\n                  ${alignment.getName()}`}\n          ></Sprite>\n        ))}\n      </>\n    );\n  }\n\n  protected colorCanvasWithSequence(\n    tileImageData: ImageData,\n    tileCanvasContext: CanvasRenderingContext2D,\n    tileCanvas: HTMLCanvasElement,\n    sequences: ISequence[],\n    offsets: { seqY: number; letterX: number }\n  ) {\n    let imageDataIdx = 0;\n\n    for (let seqIdx = 0; seqIdx < tileCanvas.height; seqIdx++) {\n      const seq = sequences[seqIdx + offsets.seqY];\n      for (let letterIdx = 0; letterIdx < tileCanvas.width; letterIdx++) {\n        const letter = seq.sequence[letterIdx + offsets.letterX];\n        const colorScheme = this.getCurrentMoleculeColors(\n          letter,\n          letterIdx,\n          offsets\n        );\n\n        tileImageData.data[imageDataIdx] = colorScheme.rgb.red;\n        tileImageData.data[imageDataIdx + 1] = colorScheme.rgb.green;\n        tileImageData.data[imageDataIdx + 2] = colorScheme.rgb.blue;\n        tileImageData.data[imageDataIdx + 3] = 255; //alpha between 0 (transparent) and 255 (opaque)\n\n        imageDataIdx += 4;\n      }\n    }\n    tileCanvasContext.putImageData(tileImageData, 0, 0);\n  }\n\n  protected generateCanvasForTile(\n    tileXNumber: number,\n    tileYNumber: number,\n    targetTileWidth: number,\n    targetTileHeight: number,\n    tiledImages: ITiledImages,\n    sequences: ISequence[]\n  ) {\n    const tileCanvas = document.createElement(\"canvas\") as HTMLCanvasElement;\n    tileCanvas.height =\n      tileYNumber === tiledImages.numYTiles - 1\n        ? tiledImages.lastTileHeight\n        : targetTileHeight;\n    tileCanvas.width =\n      tileXNumber === tiledImages.numXTiles - 1\n        ? tiledImages.lastTileWidth\n        : targetTileWidth;\n\n    const offsets = {\n      seqY: tileYNumber * targetTileHeight,\n      letterX: tileXNumber * targetTileWidth,\n    };\n\n    const tileCanvasContext = tileCanvas.getContext(\"2d\");\n    tileCanvasContext?.fillRect(0, 0, tileCanvas.width, tileCanvas.height); //unclear why necessary\n    const tileImageData = tileCanvasContext?.getImageData(\n      0,\n      0,\n      tileCanvas.width,\n      tileCanvas.height\n    );\n\n    if (tileImageData && tileCanvasContext) {\n      this.colorCanvasWithSequence(\n        tileImageData,\n        tileCanvasContext,\n        tileCanvas,\n        sequences,\n        offsets\n      );\n    }\n\n    return {\n      tileX: tileXNumber,\n      tileY: tileYNumber,\n      pixelX: offsets.letterX,\n      pixelY: offsets.seqY,\n      width: tileCanvas.width,\n      height: tileCanvas.height,\n      image: tileCanvas,\n    };\n  }\n\n  protected getCurrentMoleculeColors(\n    letter: string,\n    letterIdx: number,\n    offsets: { seqY: number; letterX: number }\n  ) {\n    const { alignment, alignmentType, colorScheme } = this.props;\n    const consensusSequence = alignment.getConsensus();\n    const querySequence = alignment.getTargetSequence().sequence;\n    const moleculeClass =\n      alignmentType === AlignmentTypes.AMINOACID ? AminoAcid : Nucleotide;\n    let molecule = moleculeClass.UNKNOWN;\n\n    if (this.props.positionsToStyle === PositionsToStyle.ALL) {\n      molecule = moleculeClass.fromSingleLetterCode(letter);\n    } else {\n      const isConsensus =\n        consensusSequence[letterIdx + offsets.letterX].letter === letter;\n      const isQuery = querySequence[letterIdx + offsets.letterX] === letter;\n      if (\n        (this.props.positionsToStyle === PositionsToStyle.CONSENSUS &&\n          isConsensus) ||\n        (this.props.positionsToStyle === PositionsToStyle.CONSENSUS_DIFF &&\n          !isConsensus) ||\n        (this.props.positionsToStyle === PositionsToStyle.QUERY && isQuery) ||\n        (this.props.positionsToStyle === PositionsToStyle.QUERY_DIFF &&\n          !isQuery)\n      ) {\n        molecule = moleculeClass.fromSingleLetterCode(letter);\n      }\n    }\n    return molecule.colors[colorScheme.commonName];\n  }\n\n  protected initializeTiledImages({\n    targetTileWidth = 0,\n    targetTileHeight = 0,\n    fullWidth = 0,\n    fullHeight = 0,\n  }): ITiledImages {\n    return {\n      targetTileWidth: targetTileWidth,\n      targetTileHeight: targetTileHeight,\n      lastTileWidth:\n        fullWidth % targetTileWidth !== 0\n          ? fullWidth % targetTileWidth\n          : targetTileWidth,\n      lastTileHeight:\n        fullHeight % targetTileHeight !== 0\n          ? fullHeight % targetTileHeight\n          : targetTileHeight,\n      numXTiles:\n        fullWidth % targetTileWidth !== 0\n          ? Math.floor(fullWidth / targetTileWidth) + 1\n          : Math.floor(fullWidth / targetTileWidth),\n      numYTiles:\n        fullHeight % targetTileHeight !== 0\n          ? Math.floor(fullHeight / targetTileHeight) + 1\n          : Math.floor(fullHeight / targetTileHeight),\n      tiles: [],\n    };\n  }\n}\n\nexport interface IViewportProps {\n  useDrag?: boolean; // Allows the user to drag the viewport around.\n  usePinch?: boolean; // Allows the user to pinch to zoom; e.g. on a trackpad.\n  useWheel?: boolean; // Allows the user to use a mouse wheel to zoom.\n  numColumns: number;\n  numRows: number;\n  app: PIXI.Application;\n  mouseDown?: (x: number, y: number) => void;\n  zoomPercent?: number;\n}\n\nconst PixiViewport = PixiComponent<IViewportProps, any>(\"PixiViewport\", {\n  create(props: IViewportProps) {\n    const {\n      app,\n      numColumns,\n      numRows,\n      useDrag,\n      usePinch,\n      useWheel,\n      zoomPercent,\n    } = props;\n    app.renderer.backgroundColor = 0xffffff;\n\n    let vp = new Viewport({\n      screenWidth: app.renderer.width,\n      screenHeight: app.renderer.height,\n      worldWidth: numColumns,\n      worldHeight: numRows,\n      interaction: app.renderer.plugins.interaction,\n    })\n      .decelerate()\n      .clamp({\n        direction: \"all\",\n      })\n      .bounce({ friction: 0.1, time: 150, underflow: \"center\" })\n      .clampZoom({\n        maxHeight: app.renderer.height,\n        maxWidth: app.renderer.width,\n      });\n    /*\n      .drag()\n      .pinch()\n      .wheel()\n      .decelerate()\n      .clamp({\n        direction: \"all\"\n      })\n      .bounce({ friction: 0.1, time: 500, underflow: \"center\" })\n      .clampZoom({\n        maxHeight: app.renderer.height,\n        maxWidth: app.renderer.width\n      });*/\n\n    // !IMPORTANT\n    // Two-finger drag on trackpad is also enabled by this.\n    // Issue currently open: https://github.com/davidfig/pixi-viewport/issues/143\n    if (useDrag) {\n      vp = vp.drag({\n        direction: \"all\", //this is the line that kills pinch\n      });\n    }\n\n    if (usePinch) {\n      vp = vp.pinch();\n    }\n\n    if (useWheel) {\n      vp = vp.wheel();\n    }\n\n    if (zoomPercent) {\n      vp = vp.zoomPercent(zoomPercent);\n    }\n    vp.on(\"clicked\", (e) => {\n      if (props.mouseDown) {\n        props.mouseDown(e.world.x, e.world.y);\n      }\n    });\n\n    //start the component zoomed such that the entire alignment width\n    //is visible in the frame.\n    //vp = vp.setZoom(app.renderer.width / numColumns, true);\n    //vp = vp.fitWorld(true);\n    return vp;\n  },\n\n  applyProps(\n    vp: Viewport, //PIXI.Graphics,\n    oldProps: IViewportProps,\n    newProps: IViewportProps\n  ) {\n    //if (oldProps.zoomPercent !== newProps.zoomPercent && newProps.zoomPercent) {\n    //  viewport = viewport.setZoom(newProps.zoomPercent, false);\n    // }\n    //vp = vp.fitWorld(true);\n    //vp = vp.setZoom(50, false);\n    if (\n      oldProps.numColumns !== newProps.numColumns ||\n      oldProps.numRows !== newProps.numRows\n    ) {\n      vp.screenWidth = newProps.app.renderer.width;\n      vp.screenHeight = newProps.app.renderer.height;\n      vp.worldWidth = newProps.numColumns;\n      vp.worldHeight = newProps.numRows;\n      vp = vp.fitWorld(true);\n      vp = vp.setZoom(newProps.app.renderer.width / newProps.numColumns, false);\n    }\n    return vp;\n  },\n});\n","import * as React from \"react\";\n\nimport { AlignmentCanvasComponent } from \"./AlignmentCanvasComponent\";\nimport { Alignment, SequenceSortOptions } from \"../common/Alignment\";\nimport {\n  AminoAcidAlignmentStyle,\n  NucleotideAlignmentStyle,\n} from \"../common/MolecularStyles\";\n\nexport interface IMiniMapProps {\n  alignHorizontal: \"left\" | \"right\";\n  //alignVertical: \"top\" | \"bottom\";\n  alignment: Alignment;\n  height: number;\n  highlightRows?: [number, number];\n  onClick?: (x: number, y: number) => void;\n  sortBy: SequenceSortOptions;\n  style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle;\n  width: number;\n}\n\nexport interface IMiniMapState {\n  zoomPercent: number;\n}\n\nexport class MiniMapComponent extends React.Component<\n  IMiniMapProps,\n  IMiniMapState\n> {\n  public static defaultProps = {\n    alignHorizontal: \"right\",\n    //alignVertical: \"top\",\n    height: 600,\n    width: 300,\n  };\n  constructor(props: IMiniMapProps) {\n    super(props);\n    this.state = {\n      zoomPercent: 1,\n    };\n  }\n\n  protected getSizing() {\n    const frameBorderWidth = 1; // in pixels\n    const frameMargin = 2; // in pixels\n    return {\n      borderWidth: frameBorderWidth,\n      margin: frameMargin,\n      frameHeight: this.props.height - 2 * frameMargin - 1 * frameBorderWidth,\n      frameWidth: this.props.width - 2 * frameMargin - 1 * frameBorderWidth,\n    };\n  }\n\n  public render() {\n    const { alignHorizontal } = this.props;\n    const size = this.getSizing();\n    return (\n      <div\n        style={{\n          zIndex: 100000,\n          ...(alignHorizontal === \"left\" ? { left: 0 } : { right: 0 }),\n          //...(alignVertical === \"top\" ? { top: 0 } : { bottom: 0 }),\n          top: 0,\n          bottom: 0,\n          height: size.frameHeight,\n          width: size.frameWidth,\n          position: \"fixed\",\n          backgroundColor: \"white\",\n          borderColor: \"#333333\",\n          borderStyle: \"solid\",\n          borderWidth: `${size.borderWidth}px`,\n          margin: `${size.margin}px`,\n        }}\n      >\n        {this.renderCanvasComponent()}\n        {/*this.renderZoomControls()*/}\n      </div>\n    );\n  }\n\n  protected renderCanvasComponent = () => {\n    const { alignment, highlightRows, sortBy, style } = this.props;\n    const { zoomPercent } = this.state;\n    const size = this.getSizing();\n    return (\n      <div>\n        <AlignmentCanvasComponent\n          id=\"alignment_canvas\"\n          alignment={alignment}\n          alignmentType={style.alignmentType}\n          positionsToStyle={style.positionsToStyle}\n          colorScheme={style.colorScheme}\n          sortBy={sortBy}\n          stageResolution={{\n            width: size.frameWidth,\n            height: size.frameHeight,\n          }}\n          highlightRows={highlightRows}\n          viewportProps={{\n            useDrag: true,\n            usePinch: true,\n            useWheel: true,\n            zoomPercent,\n          }}\n          mouseDown={this.onMouseDown}\n        />\n      </div>\n    );\n  };\n  protected onMouseDown = (x: number, y: number) => {\n    const { onClick } = this.props;\n    if (onClick) {\n      onClick(x, y);\n    }\n  };\n\n  /*\n\n  protected renderZoomControls = () => (\n    <div style={{ textAlign: \"center\", opacity: 1 }}>\n      <button onClick={this.onZoomOut}>-</button>\n      <button onClick={this.onZoomReset}>Reset</button>\n      <button onClick={this.onZoomIn}>+</button>\n    </div>\n  );\n\n  protected onZoomIn = () => {\n    const { zoomPercent } = this.state;\n    this.setState({\n      zoomPercent: Math.min(8, zoomPercent + 0.25),\n    });\n  };\n\n  protected onZoomOut = () => {\n    const { zoomPercent } = this.state;\n    this.setState({\n      // A zoomPercent of 0 will not actually zoom out!\n      zoomPercent: Math.max(0.25, zoomPercent - 0.25),\n    });\n  };\n\n  protected onZoomReset = () => {\n    this.setState({\n      zoomPercent: 1,\n    });\n  };*/\n}\n","/**\n * Base class for Ace Editor Components\n */\nimport React from \"react\";\nimport ace from \"ace-builds\";\nimport { Ace } from \"ace-builds\";\n\nexport interface IAceEditorProps {\n  readonly id: string;\n\n  text?: string;\n  fontSize?: number;\n  editorMode?: string;\n  classNames?: string;\n\n  editorLoaded?(editor: Ace.Editor, parentElem: HTMLDivElement): void;\n  characterSizeChanged?(newCharacterWidth: number): void;\n\n  mouseDown?(e: {\n    mouseRow: number;\n    mouseColumn: number;\n    mousePageX: number;\n    mousePageY: number;\n    //mouseContainerX: number;\n    //mouseContainerY: number;\n  }): void;\n\n  mouseMove?(e: {\n    mouseRow: number;\n    mouseColumn: number;\n    mousePageX: number;\n    mousePageY: number;\n    //mouseContainerX: number;\n    //mouseContainerY: number;\n  }): void;\n\n  mouseEnter?(): void;\n  mouseLeave?(): void;\n}\n\nexport class AceEditorComponent<\n  P extends IAceEditorProps,\n  S = {}\n> extends React.Component<P, S> {\n  private editor?: Ace.Editor;\n  private lastText?: string;\n  private lastMode?: string;\n  private element?: HTMLElement;\n  private lastElementWidth?: number;\n  private lastElementHeight?: number;\n  static defaultProps = {\n    fontSize: 14,\n  };\n\n  /**************************\n   *\n   *\n   * METHODS REQUIRED FROM SUBCLASSES\n   *\n   *\n   **************************/\n  getText(): string {\n    if (this.props.text) {\n      return this.props.text!;\n    }\n    throw Error(\n      \"Internal error: 'text' attribute must be provided or subclasses must implement getText()\"\n    );\n  }\n  getEditorMode(): string | undefined {\n    return this.props.editorMode;\n  }\n\n  /**************************\n   *\n   *\n   * PROTECTED METHODS\n   *\n   *\n   **************************/\n  /**\n   * Load and setup the ace editor\n   * @param el the element that will hold the ace editor.\n   */\n  protected setupEditorAndEventListeners(el: HTMLElement) {\n    this.editor = ace.edit(el);\n    this.editor.setShowPrintMargin(false);\n    this.editor.setReadOnly(true);\n    this.editor.setHighlightActiveLine(false);\n    this.editor.setHighlightGutterLine(false);\n    this.editor.setFontSize(this.props.fontSize + \"px\");\n    this.editor.renderer.setShowGutter(false);\n    this.editor.renderer.setPadding(0);\n    this.editor.renderer.$cursorLayer.element.style.display = \"none\";\n  }\n\n  /**\n   * listen to mouse events and report them to instantiator\n   */\n  protected addMouseEventListeners() {\n    if (!this.editor) {\n      throw Error(\"Editor must be defined before adding mouse listeners.\");\n    }\n\n    function getMousePosition(editor: Ace.Editor, event: Ace.AceEvent) {\n      var pos = event.getDocumentPosition();\n      var screenCoordinates = editor.renderer.textToScreenCoordinates(\n        pos.row,\n        pos.column\n      );\n      return {\n        mouseRow: pos.row,\n        mouseColumn: pos.column,\n        mousePageX: screenCoordinates.pageX,\n        mousePageY: screenCoordinates.pageY,\n        //mouseContainerX:\n        //  characterWidth * pos.column - this.editor.session.getScrollLeft(),\n        //mouseContainerY: characterWidth * pos.row ???\n      };\n    }\n\n    this.editor!.on(\"mousemove\", (e) => {\n      if (!this.props.mouseMove) {\n        return;\n      }\n      this.props.mouseMove(getMousePosition(this.editor!, e));\n    });\n\n    this.editor!.on(\"mousedown\", (e) => {\n      if (!this.props.mouseDown) {\n        return;\n      }\n      this.props.mouseDown(getMousePosition(this.editor!, e));\n    });\n\n    return this.editor;\n  }\n\n  /**\n   * update the text in the editor and set the editor to use that\n   * mode (if provided).\n   * @param newText\n   * @param modeName the mode name for highlighting this ace editor. For alignments, this can\n   *                 be defined as follows:\n   *    const modeName = \"ace/mode/\" + this.props.alignment.getName();\n   *    defineNewAlignmentMode(modeName, this.props.alignment);\n   *    setText()\n   * @throws an error if the editor is not yet defined.\n   */\n  protected setText() {\n    if (!this.editor) {\n      throw Error(\"Editor must be defined to call setText()\");\n    }\n    //only update if needed\n    if (this.props.fontSize + \"px\" !== this.editor.getFontSize()) {\n      this.editor.setFontSize(this.props.fontSize + \"px\");\n      if (\n        this.props.characterSizeChanged &&\n        this.editor.renderer.characterWidth\n      ) {\n        this.props.characterSizeChanged(this.editor.renderer.characterWidth);\n      }\n    }\n    if (this.lastMode !== this.getEditorMode()) {\n      const newMode = this.getEditorMode();\n      this.editor.session.setMode(newMode!);\n      this.lastMode = newMode;\n    }\n    if (!this.lastText || this.lastText !== this.getText()) {\n      this.editor.selectAll();\n      this.editor.removeLines();\n      const newText = this.getText();\n      this.editor.insert(newText);\n      this.lastText = newText;\n    }\n  }\n\n  /**\n   * The initial editor load function. Will only run a single time.\n   * @param e the HTMLelment that will hold the ace editor\n   */\n  protected initialLoad(e: HTMLDivElement | null) {\n    if (e && !this.editor) {\n      //only run if editor not loaded\n      this.element = e;\n      this.lastElementWidth = e.clientWidth;\n      this.lastElementHeight = e.clientHeight;\n      this.setupEditorAndEventListeners(e);\n      this.addMouseEventListeners();\n      this.setText();\n      if (this.props.editorLoaded) {\n        this.props.editorLoaded(this.editor!, e); //inform parent of loading.\n      }\n    }\n  }\n\n  /**************************\n   *\n   *\n   * REACT METHODS\n   *\n   *\n   **************************/\n  componentDidUpdate() {\n    if (!this.editor || !this.element) {\n      throw Error(\n        \"internal error - componentDidUpdate called before editor initialized\"\n      );\n    }\n    this.setText(); //smart and will update only if needed.\n    if (\n      this.element.clientWidth !== this.lastElementWidth ||\n      this.element.clientHeight !== this.lastElementHeight\n    ) {\n      this.lastElementWidth = this.element.clientWidth;\n      this.lastElementHeight = this.element.clientHeight;\n      this.editor.resize();\n    }\n    return false;\n  }\n\n  render() {\n    return (\n      <div\n        className={this.props.classNames}\n        onMouseEnter={() => {\n          if (this.props.mouseEnter) {\n            this.props.mouseEnter();\n          }\n        }}\n        onMouseLeave={() => {\n          if (this.props.mouseLeave) {\n            this.props.mouseLeave();\n          }\n        }}\n      >\n        <div id={this.props.id} ref={(e) => this.initialLoad(e)}></div>\n      </div>\n    );\n  }\n}\n","import { Alignment, SequenceSortOptions } from \"../common/Alignment\";\nimport { AceEditorComponent, IAceEditorProps } from \"./AceEditorComponent\";\n\nexport interface IAceMultipleSequenceAlignmentProps extends IAceEditorProps {\n  alignment: Alignment;\n  sortBy?: SequenceSortOptions;\n}\n\nexport class AceMultipleSequenceAlignmentComponent extends AceEditorComponent<\n  IAceMultipleSequenceAlignmentProps,\n  {}\n> {\n  static defaultProps = {\n    sortBy: SequenceSortOptions.INPUT,\n    fontSize: 14,\n  };\n\n  getText(): string {\n    return this.props.alignment\n      .getSequences(this.props.sortBy)\n      .map((x) => x.sequence)\n      .join(\"\\n\");\n  }\n  getEditorMode() {\n    return this.props.alignment.getAceEditorMode();\n  }\n}\n","import { AceMultipleSequenceAlignmentComponent } from \"./AceMultipleSequenceAlignmentComponent\";\n\nexport class AceConsensusSequenceComponent extends AceMultipleSequenceAlignmentComponent {\n  getText() {\n    return this.props.alignment\n      .getConsensus()\n      .map((letter) => {\n        return letter.letter;\n      })\n      .join(\"\");\n  }\n}\n","import { AceMultipleSequenceAlignmentComponent } from \"./AceMultipleSequenceAlignmentComponent\";\n\nexport class AceTargetSequenceComponent extends AceMultipleSequenceAlignmentComponent {\n  getText() {\n    return this.props.alignment.getTargetSequence().sequence;\n  }\n}\n","import { Alignment } from \"../common/Alignment\";\nimport { AceEditorComponent, IAceEditorProps } from \"./AceEditorComponent\";\n\nexport interface IAceTextualRulerComponentProps extends IAceEditorProps {\n  alignment: Alignment;\n}\n\nexport default class AceTextualRulerComponent extends AceEditorComponent<\n  IAceTextualRulerComponentProps,\n  {}\n> {\n  /**\n   * Generate a string axis (positional information) with one character per position\n   * through the maxLength. Taken from alignmentviewer 1.0:\n   *     https://github.com/sanderlab/alignmentviewer\n   * May want to implement this better in the future (SVG + sliding tooltip for cursor?)\n   * @param maxLength\n   */\n  static generateTextualRuler(maxLength: number): string {\n    let s = \"\"; // should be a better way to do this to be honest\n    for (let i = 1; i <= maxLength + 1; i++) {\n      const Q = i % 10 === 0;\n      const Q5 = !Q && i % 5 === 0;\n      s += Q ? \"|\" : Q5 ? \":\" : \".\";\n      if (!Q) {\n        continue;\n      }\n      const sn = \"\" + i;\n      const np = s.length - sn.length - 1; // where num starts\n      if (np < 0) {\n        continue;\n      }\n      s = s.substr(0, np) + sn + \"|\";\n    }\n    return s; // this.hruler = s.replace(/ /g, '.');\n  }\n\n  getText(): string {\n    return AceTextualRulerComponent.generateTextualRuler(\n      this.props.alignment.getMaxSequenceLength()\n    );\n  }\n  getEditorMode() {\n    return undefined;\n  }\n}\n","import React from \"react\";\nimport \"./AlignmentViewer.scss\";\nimport { Ace } from \"ace-builds\";\nimport { Alignment, SequenceSortOptions } from \"../common/Alignment\";\nimport { ScrollSync, ScrollType } from \"../common/ScrollSync\";\nimport { SequenceLogoComponent, LOGO_TYPES } from \"./SequenceLogoComponent\";\nimport {\n  ISequenceBarplotDataSeries,\n  SequenceBarplotComponent,\n} from \"./SequenceBarplotComponent\";\nimport {\n  AminoAcidAlignmentStyle,\n  NucleotideAlignmentStyle,\n  PositionsToStyle,\n} from \"../common/MolecularStyles\";\nimport { MiniMapComponent } from \"./MiniMapComponent\";\nimport { AceMultipleSequenceAlignmentComponent } from \"./AceMultipleSequenceAlignmentComponent\";\nimport { AceConsensusSequenceComponent } from \"./AceConsensusSequenceComponent\";\nimport { AceTargetSequenceComponent } from \"./AceTargetSequenceComponent\";\nimport AceTextualRulerComponent from \"./AceTextualRulerComponent\";\nimport { AceEditorComponent } from \"./AceEditorComponent\";\n\nexport type IAlignmentViewerProps = {\n  alignment: Alignment;\n  style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle;\n} & Partial<DefaultPropsTypes>;\n\ntype DefaultPropsTypes = Readonly<typeof defaultProps>;\n\nconst defaultProps = {\n  logoPlotStyle: LOGO_TYPES.LETTERS as LOGO_TYPES,\n  zoomLevel: 13 as number,\n  sortBy: SequenceSortOptions.INPUT as SequenceSortOptions,\n  showMiniMap: false as boolean,\n  showAnnotations: true as boolean,\n};\n\ninterface IAlignmentViewerState {\n  aceCharacterWidth: number;\n  aceEditors: Ace.Editor[];\n  alignmentEditorVisibleFirstRow?: number;\n  alignmentEditorVisibleLastRow?: number;\n\n  defaultBarplotData: ISequenceBarplotDataSeries[];\n\n  windowWidth: number;\n  windowHeight: number;\n}\n\nexport class AlignmentViewer extends React.Component<\n  IAlignmentViewerProps,\n  IAlignmentViewerState\n> {\n  private verticalScrollSync: ScrollSync;\n  private horizontalScrollSync: ScrollSync;\n\n  static defaultProps = defaultProps;\n\n  constructor(props: IAlignmentViewerProps) {\n    super(props);\n\n    this.state = {\n      aceEditors: [],\n      aceCharacterWidth: 0,\n      windowWidth: window.innerWidth,\n      windowHeight: window.innerHeight,\n      defaultBarplotData: [\n        SequenceBarplotComponent.ENTROPY_BARPLOT,\n        SequenceBarplotComponent.GAPS_BARPLOT,\n      ],\n    };\n\n    this.verticalScrollSync = new ScrollSync(ScrollType.vertical);\n    this.horizontalScrollSync = new ScrollSync(ScrollType.horizontal);\n\n    //setup scroll groups\n    //ScrollSync.getInstance().setScrollerGroup(\n    //  \"horizontal\",\n    //  ScrollType.horizontal\n    //);\n    //ScrollSync.getInstance().setScrollerGroup(\"vertical\", ScrollType.vertical);\n  }\n\n  private handleCharacterSizeChanged = (newCharSize: number) => {\n    if (this.state.aceCharacterWidth !== newCharSize) {\n      this.setState({\n        aceCharacterWidth: newCharSize,\n      });\n    }\n  };\n\n  private aceEditorLoaded = (\n    id: string,\n    editor: Ace.Editor,\n    parentElem: HTMLDivElement,\n    scrollSyncDirection: ScrollType\n  ) => {\n    //console.log(\"_aceEditorLoaded id =\" + id);\n    if (\n      scrollSyncDirection === ScrollType.horizontal ||\n      scrollSyncDirection === ScrollType.both\n    ) {\n      this.horizontalScrollSync.registerAceScroller(editor, parentElem);\n    }\n    if (\n      scrollSyncDirection === ScrollType.vertical ||\n      scrollSyncDirection === ScrollType.both\n    ) {\n      this.verticalScrollSync.registerAceScroller(editor, parentElem);\n    }\n\n    this.setState({\n      aceCharacterWidth: editor.renderer.characterWidth, //todo: check if the same always.\n      aceEditors: [editor].concat(this.state.aceEditors),\n    });\n\n    //track visible rows to show in canvas MSA\n    if (id === \"ace-alignment\") {\n      editor.renderer.on(\"afterRender\", () => {\n        // BREAKS LOGO, rerenders everything below and kills performance. React lifecycle stuff.\n        setTimeout(() => {\n          this.setState({\n            alignmentEditorVisibleFirstRow: editor.renderer.getFirstFullyVisibleRow(),\n            alignmentEditorVisibleLastRow: editor.renderer.getLastFullyVisibleRow(),\n          });\n        });\n      });\n    }\n  };\n\n  private generateWidget(\n    className: string,\n    annotation: string | JSX.Element,\n    content: JSX.Element,\n    addAsElementToScrollSync?: boolean\n  ) {\n    return (\n      <div className={`av-widget ${className}`}>\n        <div className=\"av-annotation\">{annotation}</div>\n        <div\n          className=\"av-content\"\n          ref={(e) => {\n            if (e && addAsElementToScrollSync) {\n              //TODO: move into separate component .. Ref can be null here and\n              //      also good to keep track of removal / addition for scroll sync\n              //console.log(\"the ref is:\", e);\n              this.horizontalScrollSync.registerElementScroller(e);\n            }\n          }}\n        >\n          {content}\n        </div>\n      </div>\n    );\n  }\n\n  protected windowDimensionsUpdated = () => {\n    this.setState({\n      windowWidth: window.innerWidth,\n      windowHeight: window.innerHeight,\n    });\n  };\n\n  componentDidMount() {\n    window.addEventListener(\"resize\", this.windowDimensionsUpdated);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"resize\", this.windowDimensionsUpdated);\n  }\n\n  render() {\n    if (!this.props.alignment) {\n      return null;\n    }\n\n    const annotationClass = this.props.showAnnotations\n      ? \"\"\n      : \" annotation-closed\";\n\n    return (\n      <div className={`alignment_viewer${annotationClass}`}>\n        {this.renderMiniMap()}\n        {/*<div id=\"column_mouseover\"></div>*/}\n\n        {this.generateWidget(\n          \"av-conservation-gaps\",\n          \"Conservation / gaps:\",\n          this.renderConservationBox(),\n          true\n        )}\n\n        {this.generateWidget(\n          \"av-sequence-logo\",\n          \"Logo:\",\n          this.renderSequenceLogo(),\n          true\n        )}\n\n        {this.generateWidget(\n          \"av-consensus-seq\",\n          \"Consensus sequence:\",\n          this.renderConsensusQueryBox()\n        )}\n\n        {this.generateWidget(\n          \"av-target-seq\",\n          \"Query sequence:\",\n          this.renderQuerySeqBox()\n        )}\n\n        {this.generateWidget(\n          \"av-position-indicator\",\n          \"Position:\",\n          this.renderPositionBox()\n        )}\n\n        {this.generateWidget(\n          \"av-ace-msa\",\n          this.renderAlignmentAnnotationBox(),\n          this.renderAlignmentBox()\n        )}\n      </div>\n    );\n  }\n\n  protected renderSequenceLogo = () => (\n    <div\n      className={\n        `logo_box ${this.props.style.alignmentType.className} ` +\n        `${this.props.style.colorScheme.className} ` +\n        `${PositionsToStyle.ALL.className}`\n      }\n    >\n      {\n        <SequenceLogoComponent\n          id=\"sequence_logo\"\n          alignment={this.props.alignment}\n          glyphWidth={this.state.aceCharacterWidth}\n          logoType={this.props.logoPlotStyle}\n        />\n      }\n    </div>\n  );\n\n  protected renderConservationBox = () => {\n    const { defaultBarplotData } = this.state;\n    return (\n      <SequenceBarplotComponent\n        alignment={this.props.alignment}\n        dataSeries={defaultBarplotData}\n        positionWidth={this.state.aceCharacterWidth}\n      ></SequenceBarplotComponent>\n    );\n  };\n\n  protected renderConsensusQueryBox = () => (\n    <div className=\"consensusseq_box\">\n      <AceConsensusSequenceComponent\n        id=\"ace-consensusseq\"\n        alignment={this.props.alignment}\n        fontSize={this.props.zoomLevel}\n        classNames={[\n          this.props.style.residueDetail.className,\n          this.props.style.alignmentType.className,\n          this.props.style.positionsToStyle.className,\n          this.props.style.colorScheme.className,\n        ].join(\" \")}\n        editorLoaded={(editor, parentElem) => {\n          this.aceEditorLoaded(\n            \"ace-consensusseq\",\n            editor,\n            parentElem,\n            ScrollType.horizontal\n          );\n        }}\n      ></AceConsensusSequenceComponent>\n    </div>\n  );\n\n  protected renderQuerySeqBox = () => (\n    <div className=\"queryseq_box\">\n      <AceTargetSequenceComponent\n        id=\"ace-queryseq\"\n        alignment={this.props.alignment}\n        fontSize={this.props.zoomLevel}\n        sortBy={this.props.sortBy}\n        classNames={[\n          this.props.style.residueDetail.className,\n          this.props.style.alignmentType.className,\n          this.props.style.positionsToStyle.className,\n          this.props.style.colorScheme.className,\n        ].join(\" \")}\n        editorLoaded={(editor, parentElem) => {\n          this.aceEditorLoaded(\n            \"ace-queryseq\",\n            editor,\n            parentElem,\n            ScrollType.horizontal\n          );\n        }}\n      ></AceTargetSequenceComponent>\n    </div>\n  );\n\n  protected renderPositionBox = () => (\n    <div className=\"position_box\">\n      {\n        <AceTextualRulerComponent\n          id=\"ace-positions\"\n          alignment={this.props.alignment}\n          fontSize={this.props.zoomLevel}\n          editorLoaded={(editor, parentElem) => {\n            this.aceEditorLoaded(\n              \"ace-positions\",\n              editor,\n              parentElem,\n              ScrollType.horizontal\n            );\n          }}\n          mouseEnter={() => {\n            //console.log(\"mouse entered position box\");\n          }}\n          mouseLeave={() => {\n            //console.log(\"mouse left position box\");\n          }}\n          mouseMove={(e) => {\n            //console.log(\"mouse moved in position box\", e);\n          }}\n          mouseDown={(e) => {\n            //console.log(\"mouse down in position box\", e);\n          }}\n        />\n      }\n    </div>\n  );\n\n  protected renderAlignmentBox = () => (\n    <div className=\"alignment_box\">\n      <AceMultipleSequenceAlignmentComponent\n        id=\"ace-alignment\"\n        alignment={this.props.alignment}\n        fontSize={this.props.zoomLevel}\n        sortBy={this.props.sortBy}\n        classNames={[\n          this.props.style.residueDetail.className,\n          this.props.style.alignmentType.className,\n          this.props.style.positionsToStyle.className,\n          this.props.style.colorScheme.className,\n        ].join(\" \")}\n        characterSizeChanged={this.handleCharacterSizeChanged}\n        editorLoaded={(editor, parentElem) => {\n          this.aceEditorLoaded(\n            \"ace-alignment\",\n            editor,\n            parentElem,\n            ScrollType.both\n          );\n        }}\n      ></AceMultipleSequenceAlignmentComponent>\n    </div>\n  );\n\n  protected renderAlignmentAnnotationBox = () => (\n    <div className=\"alignment_metadata_box\">\n      <AceEditorComponent\n        id=\"ace-alignment-metadata\"\n        text={this.props.alignment\n          .getSequences(this.props.sortBy)\n          .map((x) => x.id)\n          .join(\"\\n\")}\n        fontSize={this.props.zoomLevel}\n        editorLoaded={(editor, parentElem) => {\n          this.aceEditorLoaded(\n            \"ace-alignment-metadata\",\n            editor,\n            parentElem,\n            ScrollType.vertical\n          );\n        }}\n      ></AceEditorComponent>\n    </div>\n  );\n\n  protected renderMiniMap() {\n    const {\n      alignment,\n      sortBy,\n      showMiniMap,\n      style,\n      //minimapOptions,\n    } = this.props;\n    const { windowHeight } = this.state;\n\n    //let width, height;\n    //if (minimapOptions) {\n    //width = minimapOptions.width ?\n    //}\n    const width = Math.max(\n      300,\n      Math.min(450, alignment.getMaxSequenceLength())\n    );\n\n    const mmClassName = showMiniMap ? \"mini-map\" : \"mini-map hidden\";\n    return (\n      alignment &&\n      style && (\n        <div className={mmClassName}>\n          <MiniMapComponent\n            width={width}\n            height={windowHeight}\n            alignHorizontal={\"right\"}\n            alignment={alignment}\n            style={style}\n            sortBy={sortBy!}\n            highlightRows={\n              this.state.alignmentEditorVisibleFirstRow !== undefined &&\n              this.state.alignmentEditorVisibleLastRow !== undefined\n                ? [\n                    this.state.alignmentEditorVisibleFirstRow,\n                    this.state.alignmentEditorVisibleLastRow,\n                  ]\n                : undefined\n            }\n            onClick={this.onMinimapClick}\n          />\n        </div>\n      )\n    );\n  }\n\n  protected onMinimapClick = (x: number, y: number) => {\n    const {\n      aceEditors,\n      alignmentEditorVisibleFirstRow: alignmentEditorFirstRow,\n      alignmentEditorVisibleLastRow: alignmentEditorLastRow,\n    } = this.state;\n    let rowCount = 40;\n    if (\n      alignmentEditorFirstRow !== undefined &&\n      alignmentEditorLastRow !== undefined\n    ) {\n      rowCount = alignmentEditorLastRow - alignmentEditorFirstRow;\n    }\n\n    if (aceEditors.length >= 1) {\n      aceEditors[0].scrollToRow(Math.floor(y - rowCount / 2));\n    }\n  };\n}\n","import * as React from \"react\";\n\nexport interface IFileInputProps {\n  labelText: string;\n  onFileLoadCb?: (file: File, event: React.FormEvent) => void;\n}\n\n// Shamelessly based on from https://reactjs.org/docs/uncontrolled-components.html\nexport class FileInputComponent extends React.Component<IFileInputProps> {\n  public static defaultProps = {\n    labelText: \"Upload:\",\n  };\n\n  protected fileInput: React.RefObject<HTMLInputElement>;\n  constructor(props: IFileInputProps) {\n    super(props);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.fileInput = React.createRef();\n  }\n\n  handleSubmit(event: React.FormEvent<HTMLInputElement>) {\n    const { onFileLoadCb } = this.props;\n    event.preventDefault();\n    if (\n      onFileLoadCb &&\n      this.fileInput.current &&\n      this.fileInput.current.files\n    ) {\n      onFileLoadCb(this.fileInput.current.files[0], event);\n    }\n    (event.target as HTMLInputElement).value = \"\"; //reset form\n  }\n\n  render() {\n    const { labelText } = this.props;\n    return (\n      <label>\n        <strong>{labelText}</strong>\n        <input\n          type=\"file\"\n          id=\"files\"\n          ref={this.fileInput}\n          onInput={this.handleSubmit}\n        />\n      </label>\n    );\n  }\n}\n","import * as React from \"react\";\n\nexport interface IExampleFileProps {\n  labelText: string;\n  fileURL: string;\n  fileName: string;\n  onFileLoaded: (file: File) => void;\n  onStartLoading?: () => void;\n}\n\nexport class ExampleFileComponent extends React.Component<IExampleFileProps> {\n  render() {\n    const {\n      fileURL,\n      fileName,\n      labelText,\n      onStartLoading,\n      onFileLoaded,\n    } = this.props;\n    return (\n      <button\n        type=\"button\"\n        className=\"button-link\"\n        onClick={async (e) => {\n          if (onStartLoading) {\n            onStartLoading();\n          }\n          const f = new File(\n            [await (await fetch(`${fileURL}`)).blob()],\n            fileName\n          );\n          onFileLoaded(f);\n        }}\n      >\n        {labelText}\n      </button>\n    );\n  }\n}\n","import React from \"react\";\nimport \"./App.scss\";\nimport { Alignment, SequenceSortOptions } from \"./common/Alignment\";\nimport { AlignmentViewer } from \"./components/AlignmentViewerComponent\";\nimport {\n  AminoAcidAlignmentStyle,\n  NucleotideAlignmentStyle,\n  AlignmentStyle,\n  AlignmentTypes,\n  PositionsToStyle,\n  IColorScheme,\n  ResidueDetailTypes,\n} from \"./common/MolecularStyles\";\nimport { LOGO_TYPES } from \"./components/SequenceLogoComponent\";\nimport { FileInputComponent } from \"./components/FileInputComponent\";\nimport { ExampleFileComponent } from \"./components/ExampleFileComponent\";\n\ninterface AppProps {}\ninterface AppState {\n  alignment?: Alignment;\n  style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle;\n  sortBy: SequenceSortOptions;\n  logoPlotStyle: LOGO_TYPES;\n  zoomLevel: number;\n  showMiniMap: boolean;\n  showAnnotations: boolean;\n  showSettings: boolean;\n  loading?: boolean;\n}\n\nexport default class App extends React.Component<AppProps, AppState> {\n  constructor(props: AppProps) {\n    super(props);\n    this.state = {\n      style: new AminoAcidAlignmentStyle(),\n      logoPlotStyle: LOGO_TYPES.LETTERS, //TODO - decide NT or AA based on alignment\n      zoomLevel: 14,\n      sortBy: SequenceSortOptions.INPUT,\n      showMiniMap: false,\n      showAnnotations: true,\n      showSettings: true,\n    };\n  }\n\n  render() {\n    const {\n      alignment,\n      logoPlotStyle,\n      showAnnotations,\n      showMiniMap,\n      sortBy,\n      style,\n      zoomLevel,\n    } = this.state;\n\n    const alignmentElement = !alignment ? (\n      <></>\n    ) : (\n      <div className=\"av_holder\">\n        <AlignmentViewer\n          alignment={alignment}\n          style={style}\n          logoPlotStyle={logoPlotStyle}\n          zoomLevel={zoomLevel}\n          sortBy={sortBy}\n          showMiniMap={showMiniMap}\n          showAnnotations={showAnnotations}\n        ></AlignmentViewer>\n      </div>\n    );\n\n    return (\n      <div>\n        {this.renderSettingsBox(style)}\n        {alignmentElement}\n      </div>\n    );\n  }\n\n  /*\n  protected getAlignmentForFile = async (filename: string) => {\n    const result = await fetch(`${process.env.PUBLIC_URL}/${filename}`);\n\n    return Alignment.fromFileContents(filename, await result.text());\n  };*/\n\n  protected renderSettingsBox = (\n    style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle\n  ) => {\n    const { alignment } = this.state;\n    const alignmentDescription = alignment ? (\n      <div>\n        <h3>{alignment.getName()}</h3>\n        <h4>{`${\n          alignment.getSequences().length\n        } sequences (rows) and ${alignment.getMaxSequenceLength()} positions (columns) `}</h4>\n      </div>\n    ) : (\n      <></>\n    );\n\n    return (\n      <div className=\"settings_box\">\n        <form>\n          <div className=\"settings-header\">\n            <button\n              style={{\n                display: this.state.showSettings ? \"none\" : \"block\",\n              }}\n              type=\"button\"\n              className=\"button-link\"\n              onClick={(e) => {\n                this.setState({\n                  showSettings: true,\n                });\n              }}\n            >\n              Expand\n            </button>\n            <button\n              style={{\n                display: this.state.showSettings ? \"block\" : \"none\",\n              }}\n              type=\"button\"\n              className=\"button-link\"\n              onClick={(e) => {\n                this.setState({\n                  showSettings: false,\n                });\n              }}\n            >\n              Hide\n            </button>\n            <div>\n              <h2>{`AlignmentViewer 2.0 Settings Demo`}</h2>\n              {alignmentDescription}\n            </div>\n          </div>\n          <div\n            style={{\n              display: this.state.showSettings ? \"block\" : \"none\",\n              position: \"relative\",\n            }}\n          >\n            {this.renderAlignmentTypeLabel(style)}\n            {this.renderSortControl()}\n            {this.renderColorScheme(style)}\n            {this.renderResidueDetail(style)}\n            {this.renderPositionStyling(style)}\n            {this.renderSequenceLogo()}\n            {this.renderZoomButtons()}\n            {this.renderMiniMapToggle()}\n            {this.renderAnnotationToggle()}\n            <br></br>\n            {this.renderFileUpload()}\n            {this.renderExampleLinks()}\n            <div\n              className=\"loader\"\n              style={{\n                display: this.state.loading ? \"block\" : \"none\",\n              }}\n            ></div>\n          </div>\n        </form>\n      </div>\n    );\n  };\n\n  protected renderSortControl = () => {\n    const { sortBy } = this.state;\n    return (\n      <div>\n        <label>\n          <strong>Sort order:</strong>\n          <select\n            value={sortBy.key}\n            onChange={(e) =>\n              this.setState({\n                sortBy: SequenceSortOptions.fromKey(e.target.value)!,\n              })\n            }\n          >\n            {SequenceSortOptions.list.map((sso) => {\n              return (\n                <option value={sso.key} key={sso.key}>\n                  {sso.description}\n                </option>\n              );\n            })}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderAlignmentTypeLabel = (\n    style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle\n  ) => {\n    return (\n      <div>\n        <label>\n          <strong>Alignment Type:</strong>\n          <select\n            value={style.alignmentType.key}\n            onChange={(e) =>\n              this.setState({\n                style: AlignmentStyle.fromAlignmentType(\n                  AlignmentTypes.fromKey(e.target.value)!\n                ),\n              })\n            }\n          >\n            {AlignmentTypes.list.map((alignmentType) => {\n              return (\n                <option value={alignmentType.key} key={alignmentType.key}>\n                  {alignmentType.description}\n                </option>\n              );\n            })}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderColorScheme = (\n    style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle\n  ) => {\n    return (\n      <div>\n        <label>\n          <strong>Style:</strong>\n          <select\n            value={style.alignmentType.allColorSchemes.indexOf(\n              style.colorScheme\n            )}\n            onChange={(e) => {\n              this.setState({\n                style: {\n                  ...style!,\n                  colorScheme:\n                    style.alignmentType.allColorSchemes[\n                      parseInt(e.target.value)\n                    ],\n                },\n              });\n            }}\n          >\n            {style.alignmentType.allColorSchemes.map(\n              (colorScheme: IColorScheme, index: number) => {\n                return (\n                  <option key={index} value={index}>\n                    {colorScheme.description}\n                  </option>\n                );\n              }\n            )}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderResidueDetail = (\n    style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle\n  ) => {\n    return (\n      <div>\n        <label>\n          <strong>Residue Detail:</strong>\n          <select\n            value={style.residueDetail.key}\n            onChange={(e) => {\n              this.setState({\n                style: {\n                  ...style,\n                  residueDetail: ResidueDetailTypes.fromKey(e.target.value)!,\n                },\n              });\n            }}\n          >\n            {ResidueDetailTypes.list.map((rd) => {\n              return (\n                <option key={rd.key} value={rd.key}>\n                  {rd.description}\n                </option>\n              );\n            })}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderPositionStyling = (\n    style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle\n  ) => {\n    return (\n      <div>\n        <label>\n          <strong>Positions to Style:</strong>\n          <select\n            value={PositionsToStyle.list.indexOf(style.positionsToStyle)}\n            onChange={(e) => {\n              this.setState({\n                style: {\n                  ...style,\n                  positionsToStyle:\n                    PositionsToStyle.list[parseInt(e.target.value)],\n                },\n              });\n            }}\n          >\n            {PositionsToStyle.list.map(\n              (pts: PositionsToStyle, index: number) => {\n                return (\n                  <option key={index} value={index}>\n                    {pts.description}\n                  </option>\n                );\n              }\n            )}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderSequenceLogo = () => {\n    const { logoPlotStyle } = this.state;\n    return (\n      <div>\n        <label>\n          <strong>Sequence Logo Style:</strong>\n          <select\n            value={logoPlotStyle}\n            onChange={(e) => {\n              this.setState({\n                logoPlotStyle: e.target.value as LOGO_TYPES,\n              });\n            }}\n          >\n            {Object.values(LOGO_TYPES).map((logoType) => {\n              return (\n                <option key={logoType} value={logoType}>\n                  {logoType}\n                </option>\n              );\n            })}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderZoomButtons = () => {\n    const { zoomLevel } = this.state;\n    return (\n      <div>\n        <label>\n          <strong>Character size:</strong>\n          <div className=\"zoom-level\">\n            <button\n              type=\"button\"\n              disabled={zoomLevel < 3}\n              onClick={(e) => {\n                this.setState({\n                  zoomLevel: zoomLevel - 1,\n                });\n              }}\n            >\n              -\n            </button>\n            {zoomLevel}\n            <button\n              type=\"button\"\n              disabled={zoomLevel > 15}\n              onClick={(e) => {\n                this.setState({\n                  zoomLevel: zoomLevel + 1,\n                });\n              }}\n            >\n              +\n            </button>\n          </div>\n        </label>\n      </div>\n    );\n  };\n\n  protected renderFileUpload = () => {\n    return (\n      <div>\n        <FileInputComponent\n          labelText={\"Upload Alignment File:\"}\n          onFileLoadCb={this.onFileUpload}\n        />\n      </div>\n    );\n  };\n\n  protected renderExampleLinks = () => {\n    return (\n      <div className=\"examples\">\n        <label>\n          <strong>Example Alignments:</strong>\n          <ExampleFileComponent\n            labelText=\"β-lactamase\"\n            fileURL={`${process.env.PUBLIC_URL}/7fa1c5691376beab198788a726917d48_b0.4.a2m`}\n            fileName=\"7fa1c5691376beab198788a726917d48_b0.4.a2m\"\n            onFileLoaded={this.onFileUpload}\n            onStartLoading={() => this.setState({ loading: true })}\n          />\n        </label>\n      </div>\n    );\n  };\n\n  protected renderMiniMapToggle = () => {\n    return (\n      <div className=\"minimap-toggle\">\n        <label>\n          <strong>Show MiniMap:</strong>\n\n          <input\n            name=\"showMiniMap\"\n            type=\"checkbox\"\n            checked={this.state.showMiniMap}\n            onChange={(e) => {\n              const target = e.target;\n              this.setState({\n                showMiniMap: target.checked,\n              });\n            }}\n          />\n        </label>\n      </div>\n    );\n  };\n\n  protected renderAnnotationToggle = () => {\n    return (\n      <div className=\"annotation-toggle\">\n        <label>\n          <strong>Show Annotations:</strong>\n\n          <input\n            name=\"showAnnotations\"\n            type=\"checkbox\"\n            checked={this.state.showAnnotations}\n            onChange={(e) => {\n              const target = e.target;\n              this.setState({\n                showAnnotations: target.checked,\n              });\n            }}\n          />\n        </label>\n      </div>\n    );\n  };\n\n  protected onFileUpload = async (file: File) => {\n    //const fileText = await file.text(); //doesn't work in modern safari or even slightly older firefox\n    if (file) {\n      this.setState({\n        loading: true,\n      });\n      var reader = new FileReader();\n      reader.onload = (e) => {\n        const fileText = reader.result as string;\n        const alignment = Alignment.fromFileContents(file.name, fileText);\n        this.setState({\n          alignment: alignment,\n          style: alignment.getDefaultStyle(),\n          loading: false,\n        });\n      };\n      reader.readAsText(file);\n    }\n  };\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"acePrefix\":\"ace_\",\"preAceQueryClass\":\"q\",\"preAceConsensusClass\":\"c\",\"aceQueryClass\":\"q\",\"aceConsensusClass\":\"c\",\"aceResidueParentClass\":\"ace_line\",\"transparentLetterClass\":\"transparent-letters\",\"transparentBackgroundClass\":\"transparent-background\",\"aaAlignTypeClass\":\"alignment-aa\",\"ntAlignTypeClass\":\"alignment-nt\",\"styPosAllClass\":\"alignment-positions-tostyle-all\",\"styPosQueryClass\":\"alignment-positions-tostyle-query\",\"styPosQueryDiffClass\":\"alignment-positions-tostyle-query-diff\",\"styPosConsensusClass\":\"alignment-positions-tostyle-consensus\",\"styPosConsensusDiffClass\":\"alignment-positions-tostyle-consensus-diff\",\"aaStyClass_Default\":\"aa-alignment-style-default\",\"aaStyDesc_Default\":\"Default\",\"aaStyBGAlpha_Default\":\".25\",\"aaStyColorOrder_Default\":\"A,R,N,D,C,Q,E,G,H,I,L,K,M,F,P,S,T,W,Y,V\",\"aaStyColors_Default\":\"#3c0,#c00,#60c,#03f,#ff0,#60c,#03f,#3c0,#090,#3c0,#3c0,#c00,#3c0,#090,#3c0,#09f,#09f,#090,#090,#3c0\",\"aaStyClass_Hydrophobicity\":\"aa-alignment-style-hydrophobicity\",\"aaStyDesc_Hydrophobicity\":\"Hydrophobicity\",\"aaStyBGAlpha_Hydrophobicity\":\".25\",\"aaStyColorOrder_Hydrophobicity\":\"F,I,W,L,V,M,Y,C,A,T,H,G,S,Q,R,K,N,E,P,D\",\"aaStyColors_Hydrophobicity\":\"red,red,#ff0606,#ff0606,#ff4c4c,#ff5252,#f77,#ffa5a5,#ffc0c0,#e1e1ff,#d0d0ff,#b6b6ff,#a5a5ff,#9595ff,#8787ff,#6969ff,#5959ff,#4f4fff,#1d1dff,blue\",\"ntStyClass_Default\":\"nt-alignment-style-default\",\"ntStyDesc_Default\":\"Default\",\"ntStyBGAlpha_Default\":\".25\",\"ntStyColorOrder_Default\":\"A,C,G,T,U,R,Y\",\"ntStyColors_Default\":\"#5050ff,#e00000,#00c000,#e6e600,#c90,#2e8b57,#ff8c00\"};"],"sourceRoot":""}