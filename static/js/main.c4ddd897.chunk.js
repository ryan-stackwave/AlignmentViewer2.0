(this["webpackJsonpalignment-viewer-2"]=this["webpackJsonpalignment-viewer-2"]||[]).push([[0],{32:function(e,t,n){e.exports=n(54)},37:function(e,t,n){},39:function(e,t,n){},40:function(e,t,n){},41:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(27),o=n.n(a),s=(n(37),n(16)),l=n.n(s),c=n(9),u=n(1),h=n(2),d=n(5),p=n(4),m=n(6),f=(n(39),n(11)),g=n(14);function y(e){var t=document.createElement("canvas").getContext("2d");t.fillStyle=e;var n=t.fillStyle;n=n.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,n,i){return"#"+t+t+n+n+i+i}));var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return{hex:n,rgb:{red:parseInt(i[1],16),green:parseInt(i[2],16),blue:parseInt(i[3],16)}}}function v(e,t){return e.reduce((function(e,n){var i=t(n),r=e.get(i)?e.get(i):[];return e.set(i,[].concat(Object(g.a)(r),[n])),e}),new Map)}var L=n(18),S=n.n(L),b=n(8),E=n.n(b),C=w("aa"),O=w("nt");function w(e){return Object.keys(E.a).reduce((function(t,n){if(-1!==n.indexOf(e+"StyClass_")){var i=n.split(e+"StyClass_")[1],r=E.a[e+"StyColorOrder_"+i].replace(/ /g,"").split(","),a=E.a[e+"StyColors_"+i].replace(/ /g,"").split(","),o=E.a[e+"StyDesc_"+i];t.push({commonName:i,description:o,className:E.a[n],backgroundAlpha:parseFloat(E.a[e+"StyBGAlpha_"+i]),colors:Object.fromEntries(r.map((function(e,t){return[r[t],a[t]]})))})}return t}),[])}var T=function(){function e(t,n,i,r){Object(u.a)(this,e),this.key=t,this.description=n,this.className=i,this.allColorSchemes=r}return Object(h.a)(e,null,[{key:"fromKey",value:function(t){return e.list.find((function(e){return e.key===t}))}}]),e}();T.AMINOACID=new T("aminoacid-alignment","Amino Acid Sequences",E.a.aaAlignTypeClass,C),T.NUCLEOTIDE=new T("nucleotide-alignment","Nucleotide Sequences",E.a.ntAlignTypeClass,O),T.list=[T.AMINOACID,T.NUCLEOTIDE];var k=function(){function e(t,n,i){Object(u.a)(this,e),this.key=t,this.description=n,this.className=i}return Object(h.a)(e,null,[{key:"fromKey",value:function(t){return e.list.find((function(e){return e.key===t}))}}]),e}();k.ALL=new k("all","All",E.a.styPosAllClass),k.QUERY=new k("query","Same as Query",E.a.styPosQueryClass),k.QUERY_DIFF=new k("query-diff","Different from Query",E.a.styPosQueryDiffClass),k.CONSENSUS=new k("consensus","Same as Consensus",E.a.styPosConsensusClass),k.CONSENSUS_DIFF=new k("consensus-diff","Different from Consensus",E.a.styPosConsensusDiffClass),k.list=[k.ALL,k.QUERY,k.QUERY_DIFF,k.CONSENSUS,k.CONSENSUS_DIFF];var A=function(){function e(t,n,i){Object(u.a)(this,e),this.key=t,this.description=n,this.className=i}return Object(h.a)(e,null,[{key:"fromKey",value:function(t){return e.list.find((function(e){return e.key===t}))}}]),e}();A.BOTH=new A("both","Style Background and Letters",""),A.LETTER_ONLY=new A("letter-only","Only Style Letters",E.a.transparentBackgroundClass),A.BACKGROUND_ONLY=new A("background-only","Only Style Background",E.a.transparentLetterClass),A.list=[A.BOTH,A.LETTER_ONLY,A.BACKGROUND_ONLY];var N=function(){function e(){Object(u.a)(this,e),this.alignmentType=void 0,this.colorScheme=void 0,this.positionsToStyle=void 0,this.residueDetail=void 0}return Object(h.a)(e,null,[{key:"fromAlignmentType",value:function(e){return e===T.AMINOACID?new M:new j}}]),e}(),M=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.ALL,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.BOTH;Object(u.a)(this,e),this.colorScheme=t,this.positionsToStyle=n,this.residueDetail=i,this.allColorSchemes=C,this.alignmentType=T.AMINOACID},j=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.ALL,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.BOTH;Object(u.a)(this,e),this.colorScheme=t,this.positionsToStyle=n,this.residueDetail=i,this.allColorSchemes=O,this.alignmentType=T.NUCLEOTIDE},x=(E.a.transparentLetterClass,E.a.transparentBackgroundClass,E.a.aceResidueParentClass);function P(e){for(var t="",n=32;n<=126;n++)t+=String.fromCharCode(n);return t.split("").reduce((function(t,n){var i="."===n?"dot":n,r=e?i:E.a.acePrefix+i;return t.set(n,new Map([[!0,new Map([[!0,r+" "+E.a.preAceConsensusClass+" "+E.a.preAceQueryClass],[!1,r+" "+E.a.preAceConsensusClass]])],[!1,new Map([[!0,r+" "+E.a.preAceQueryClass],[!1,r]])]])),t}),new Map)}var D=P(!1),I=P(!0);function _(e,t,n,i){return i?I.get(e).get(t).get(n):D.get(e).get(t).get(n)}var H=function(){function e(){Object(u.a)(this,e),this.letterToGlyphHM={A:e.A,B:e.B,C:e.C,D:e.D,E:e.E,F:e.F,G:e.G,H:e.H,I:e.I,J:e.J,K:e.K,L:e.L,M:e.M,N:e.N,O:e.O,P:e.P,Q:e.Q,R:e.R,S:e.S,T:e.T,U:e.U,V:e.V,W:e.W,X:e.X,Y:e.Y,Z:e.Z}}return Object(h.a)(e,null,[{key:"glyphFromChar",value:function(t){return e.singleton||(e.singleton=new e),e.singleton.letterToGlyphHM[t]}}]),e}();H.singleton=void 0,H.A=function(e){return r.a.createElement("g",{key:e.key+"_g"},r.a.createElement("path",Object.assign({},e,{d:"M 0 100 L 33 0 L 66 0 L 100 100 L 75 100 L 66 75 L 33 75 L 25 100 L 0 100"})),r.a.createElement("path",{key:e.key+"_p2",transform:e.transform,fill:"#ffffff",d:"M 41 55 L 50 25 L 58 55 L 41 55"}))},H.B=function(e){return r.a.createElement("g",{key:e.key+"_g"},r.a.createElement("path",Object.assign({},e,{d:"M 0 0 L 80 0 C 105 0 105 50 80 50 C 105 50 105 100 80 100 L 00 100 L 0 0"})),r.a.createElement("path",{key:e.key+"_p2",transform:e.transform,d:"M 20 15 L 70 15 C 80 15 80 35 70 35 L 20 35 L 20 15",fill:"#ffffff"}),r.a.createElement("path",{key:e.key+"_p3",transform:e.transform,d:"M 20 65 L 70 65 C 80 65 80 85 70 85 L 20 85 L 20 65",fill:"#ffffff"}))},H.C=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 100 28 C 100 -13 0 -13 0 50 C 0 113 100 113 100 72 L 75 72 C 75 90 30 90 30 50 C 30 10 75 10 75 28 L 100 28"}))},H.D=function(e){return r.a.createElement("g",{key:e.key+"_g"},r.a.createElement("path",Object.assign({},e,{d:"M 0 0 L 60 0 C 110 0 110 100 60 100 L 0 100 L 0 0"})),r.a.createElement("path",{key:e.key+"_p2",transform:e.transform,fill:"#ffffff",d:"M 20 15 L 40 15 C 85 15 85 85 40 85 L 20 85 L 20 15"}))},H.E=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 0 0 L 100 0 L 100 20 L 20 20 L 20 40 L 90 40 L 90 60 L 20 60 L 20 80 L 100 80 L 100 100 L 0 100 L 0 0"}))},H.F=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 0 0 L 100 0 L 100 20 L 20 20 L 20 40 L 80 40 L 80 60 L 20 60 L 20 100 L 0 100 L 0 0"}))},H.G=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 100 28 C 100 -13 0 -13 0 50 C 0 113 100 113 100 72 L 100 48 L 55 48 L 55 72 L 75 72 C 75 90 30 90 30 50 C 30 10 75 5 75 28 L 100 28"}))},H.H=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 0 0 L 20 0 L 20 40 L 80 40 L 80 0 L 100 0 L 100 100 L 80 100 L 80 60 L 20 60 L 20 100 L 0 100 L 0 0"}))},H.I=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 40 0 L 60 0 L 60 100 L 40 100 L 40 0"}))},H.J=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 0 60 C 0 111 100 111 100 60 L 100 0 L 75 0 L 75 60 C 80 90 20 90 25 60"}))},H.K=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 0 0 L 20 0 L 20 40 L 75 0 L 100 0 L 50 50 L 100 100 L 75 100 L 30 65 L 20 75 L 20 100 L 0 100 L 0 0"}))},H.L=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 0 0 L 0 100 L 100 100 L 100 80 L 20 80 L 20 0 L 0 0"}))},H.M=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 0 0 L 20 0 L 50 35 L 80 0 L 100 0 L 100 100 L 80 100 L 80 30 L 50 65 L 20 30 L 20 100 L 0 100 L 0 0"}))},H.N=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 0 100 L 0 0 L 20 0 L 80 75 L 80 0 L 100 0 L 100 100 L 80 100 L 20 25 L 20 100 L 0 100"}))},H.O=function(e){return r.a.createElement("g",{key:e.key+"_g"},r.a.createElement("circle",Object.assign({cx:"50",cy:"50",r:"50"},e)),r.a.createElement("circle",{key:e.key+"_c2",transform:e.transform,cx:"50",cy:"50",r:"32",fill:"#ffffff"}))},H.P=function(e){return r.a.createElement("g",{key:e.key+"_g"},r.a.createElement("path",Object.assign({},e,{d:"M 0 0 L 80 0 C 105 0 105 50 80 50 L 20 50 L 20 100 L 0 100 L 0 0"})),r.a.createElement("path",{key:e.key+"_p2",transform:e.transform,fill:"#ffffff",d:"M 20 15 L 70 15 C 80 15 80 35 70 35 L 20 35 L 20 15"}))},H.Q=function(e){return r.a.createElement("g",{key:e.key+"_g"},r.a.createElement("circle",Object.assign({cx:"50",cy:"50",r:"50"},Object(c.a)({},e,{key:e.key+"_c1"}))),r.a.createElement("circle",{key:e.key+"_c2",transform:e.transform,cx:"50",cy:"50",r:"32",fill:"#ffffff"}),r.a.createElement("path",Object.assign({d:"M 85 100 L 55 70 L 70 55 L 100 85 L 85 100"},e)))},H.R=function(e){return r.a.createElement("g",{key:e.key+"_g"},r.a.createElement("path",Object.assign({},e,{d:"M 0 0 L 80 0 C 105 0 105 50 80 50 C 100 50 100 70 100 70 L 100 100 L 80 100 L 80 80 C 80 80 80 60 50 60 L 20 60 L 20 100 L 0 100 L 0 0"})),r.a.createElement("path",{key:e.key+"_p2",transform:e.transform,fill:"#ffffff",d:"M 20 15 L 70 15 C 80 15 80 35 70 35 L 20 35 L 20 15"}))},H.S=function(e){return e.stroke||(e.stroke=e.fill),e.strokeOpacity||(e.strokeOpacity=e.fillOpacity),r.a.createElement("path",Object.assign({fill:"#ffffff"},e,{strokeWidth:"18",d:"M92 26 A43 20 0 1 0 43 46 A42 23 0 1 1 9 68"}))},H.T=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 0 0 L 0 20 L 35 20 L 35 100 L 65 100 L 65 20 L 100 20 L 100 0 L 0 0"}))},H.U=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 0 0 L 0 60 C 0 111 100 111 100 60 L 100 0 L 75 0 L 75 60 C 80 90 20 90 25 60 L 25 0 L 0 0"}))},H.V=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 0 0 L 20 0 L 50 80 L 80 0 L 100 0 L 60 100 L 40 100 L 0 0"}))},H.W=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 0 0 L 20 0 L 30 70 L 50 30 L 70 70 L 80 0 L 100 0 L 90 100 L 70 100 L 50 65 L 30 100 L 10 100 L 0 0"}))},H.X=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 0 0 L 20 0 L 50 40 L 80 0 L 100 0 L 70 50 L 100 100 L 80 100 L 50 60 L 20 100 L 0 100 L 30 50 L 0 0"}))},H.Y=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 0 0 L 20 0 L 50 45 L 80 0 L 100 0 L 60 60 L 60 100 L 40 100 L 40 60 L 0 0"}))},H.Z=function(e){return r.a.createElement("path",Object.assign({},e,{d:"M 0 0 L 100 0 L 100 20 L 35 80 L 100 80 L 100 100 L 0 100 L 0 80 L 65 20 L 0 20 L 0 0"}))};var B=function(){function e(t,n,i){Object(u.a)(this,e),this.singleLetterCode=t,this.threeLetterCode=n,this.fullName=i,this.glyph=void 0,this.colors=void 0,this.singleLetterCode=t,this.threeLetterCode=n,this.fullName=i,this.glyph=H.glyphFromChar(t),this.colors=C.reduce((function(e,n){var i=Object.entries(n.colors).find((function(e){var n=Object(f.a)(e,2),i=n[0];n[1];return i===t})),r="#ffffff";i&&(r=i[1]);var a=y(r);return e[n.commonName]={hexString:a.hex,rgb:a.rgb,backgroundAlpha:n.backgroundAlpha},e}),{})}return Object(h.a)(e,null,[{key:"fromSingleLetterCode",value:function(t){return t in this.bySingleLetterCode?e.bySingleLetterCode[t]:e.UNKNOWN}},{key:"fromThreeLetterCode",value:function(t){return t in this.byThreeLetterCode?e.byThreeLetterCode[t]:e.UNKNOWN}}]),e}();B.canonicalAminoAcids=[new B("A","ALA","Alanine"),new B("R","ARG","Arginine"),new B("N","ASN","Asparagine"),new B("D","ASP","Aspartic Acid"),new B("C","CYS","Cysteine"),new B("Q","GLU","Glutamine"),new B("E","GLN","Glutamic Acid"),new B("G","GLY","Glycine"),new B("H","HIS","Histidine"),new B("I","ILE","Isoleucine"),new B("L","LEU","Leucine"),new B("K","LYS","Lysine"),new B("M","MET","Methionine"),new B("F","PHE","Phenylalanine"),new B("P","PRO","Proline"),new B("S","SER","Serine"),new B("T","THR","Threonine"),new B("W","TRP","Tryptophan"),new B("Y","TYR","Tyrosine"),new B("V","VAL","Valine"),new B("X","UKN","Unknown Amino Acid")],B.bySingleLetterCode=B.canonicalAminoAcids.reduce((function(e,t){return e[t.singleLetterCode]=t,e}),{}),B.byThreeLetterCode=B.canonicalAminoAcids.reduce((function(e,t){return e[t.threeLetterCode]=t,e}),{}),B.UNKNOWN=B.bySingleLetterCode.X;var q,W=function(){function e(t,n){Object(u.a)(this,e),this.singleLetterCode=t,this.fullName=n,this.glyph=void 0,this.colors=void 0,this.singleLetterCode=t,this.fullName=n,this.glyph=H.glyphFromChar(t),this.colors=O.reduce((function(e,n){var i=Object.entries(n.colors).find((function(e){var n=Object(f.a)(e,2),i=n[0];n[1];return i===t})),r="#ffffff";i&&(r=i[1]);var a=y(r);return e[n.commonName]={hexString:a.hex,rgb:a.rgb,backgroundAlpha:n.backgroundAlpha},e}),{})}return Object(h.a)(e,null,[{key:"fromSingleLetterCode",value:function(t){return t=t.toUpperCase(),this.bySingleLetterCode[t]?e.bySingleLetterCode[t]:e.UNKNOWN}}]),e}();W.allNucleotides=[new W("A","Adenine"),new W("C","Cytosine"),new W("G","Guanine"),new W("T","Thymidine"),new W("U","Uracil"),new W("R","Purine"),new W("Y","Pyrimidine"),new W("X","Unknown Nucleotide")],W.bySingleLetterCode=W.allNucleotides.reduce((function(e,t){return e[t.singleLetterCode]=t,e}),{}),W.UNKNOWN=W.bySingleLetterCode.X,function(e){e[e.hamming=0]="hamming"}(q||(q={}));var R=function(){function e(t,n,i,r){Object(u.a)(this,e),this.key=t,this.description=n,this.isTargetSequenceDependent=i,this.distanceFn=r}return Object(h.a)(e,null,[{key:"fromKey",value:function(t){return e.list.find((function(e){return e.key===t}))}}]),e}();R.INPUT=new R("as-input","As input",!1),R.HAMMING_DIST_TARGET=new R("hamming-dist-to-target","Hamming distance to target sequence",!0,q.hamming),R.list=[R.INPUT,R.HAMMING_DIST_TARGET];var z,U=function(){function e(t,n){Object(u.a)(this,e),this.uuid=void 0,this.aceEditorMode=void 0,this.name=void 0,this.predictedNT=void 0,this.sequences=void 0,this.targetSequence=void 0,this.positionalLetterCounts=new Map,this.globalAlphaLetterCounts={},this.allUpperAlphaLettersSorted=void 0,this.consensus=[],this.uuid=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(parseInt(e)^window.crypto.getRandomValues(new Uint8Array(1))[0]&15>>parseInt(e)/4).toString(16)})),this.name=t,this.sequences=new Map,this.sequences.set(R.INPUT,n),this.targetSequence=n[0],this.predictedNT=!0;for(var i=new Date,r={},a=0;a<n.length;a++)for(var o=n[a].sequence,s=0;s<o.length;s++){var l=o[s],c=!!l.match(/[a-z]/i);c&&this.predictedNT&&W.fromSingleLetterCode(l)===W.UNKNOWN&&(this.predictedNT=!1);var h=s;r[l]=1;var d=this.positionalLetterCounts.get(h);d||(d={},this.positionalLetterCounts.set(h,d)),l in d===!1&&(d[l]=0),d[l]+=1,c&&(l in this.globalAlphaLetterCounts===!1&&(this.globalAlphaLetterCounts[l]=0),this.globalAlphaLetterCounts[l]+=1)}this.allUpperAlphaLettersSorted=Object.keys(r).sort().reduce((function(e,t){return t.match(/[A-Z]/)&&e.push(t),e}),[]),this.consensus=Array.from(this.positionalLetterCounts).map((function(e){var t=Object(f.a)(e,2),n=t[0],i=t[1],r=Object.keys(i).reduce((function(e,t){var n=e.match(/[a-z]/i),r=t.match(/[a-z]/i);return n&&!r?e:r&&!n?t:i[e]>i[t]?e:t}));return{position:n,letter:r,occurrences:i[r]}})),console.log("done parsing alignment. took "+((new Date).getTime()-i.getTime())+"ms")}return Object(h.a)(e,null,[{key:"fromFileContents",value:function(t,n){for(var i=n.split(">"),r=[],a=0;a<i.length;a++){var o=i[a].split(/\r?\n/);if(o.length>1){var s={id:o[0],sequence:o.slice(1).join("")};r.push(s)}}return new e(t,r)}},{key:"getSequenceDistance",value:function(e,t,n){var i=e.sequence.length<t.sequence.length?e.sequence.length:t.sequence.length,r=0;if(n===q.hamming){for(var a=0;a<i;a++)e.sequence[a]!==t.sequence[a]&&(r+=1);return r}throw Error("Unable to determine sequence distance with distance function "+n)}},{key:"normalizeLetterCounts",value:function(e,t){var n=Object.keys(e).reduce((function(n,i){return t&&!t.includes(i)||(n+=e[i]),n}),0);return Object.keys(e).reduce((function(i,r){return t&&!t.includes(r)||(i[r]=e[r]/n),i}),{})}}]),Object(h.a)(e,[{key:"getPredictedType",value:function(){return this.predictedNT?T.NUCLEOTIDE:T.AMINOACID}},{key:"getDefaultStyle",value:function(){return this.predictedNT?new j:new M}},{key:"getUUID",value:function(){return this.uuid}},{key:"getName",value:function(){return this.name}},{key:"getAceEditorMode",value:function(){return this.aceEditorMode||(this.aceEditorMode="ace/mode/"+this.uuid,function(e,t){var n=e.split("/");if(3!==n.length||"ace"!==n[0]||"mode"!==n[1])throw Error("ace mode name must be of the form '/ace/mode/MODENAME'");var i=e.split("/")[2];S.a.define("ace/mode/"+i+"_highlight_rules",(function(e,n,i){var r=e("../lib/oop"),a=e("./text_highlight_rules").TextHighlightRules,o=function(){for(var e={},n=/./,i=function(i){var r=0===i?"start":"p"+i,a=i===t.getMaxSequenceLength()-1?"start":"p"+(i+1);e[r]=[{token:function(e){return _(e,e===t.getConsensus()[i].letter,e===t.getTargetSequence().sequence[i],!0)},regex:n,next:a}]},r=0;r<t.getMaxSequenceLength();r++)i(r);this.$rules=e};r.inherits(o,a),n.AlignmentHighlightRules=o})),S.a.define("ace/mode/"+i,(function(e,t,n){var r=e("../lib/oop"),a=e("../mode/text").Mode,o=e("../tokenizer").Tokenizer,s=e("ace/mode/"+i+"_highlight_rules").AlignmentHighlightRules,l=function(){this.$tokenizer=new o((new s).getRules())};r.inherits(l,a),function(){}.call(l.prototype),t.Mode=l}))}(this.aceEditorMode,this)),this.aceEditorMode}},{key:"getConsensus",value:function(){return this.consensus}},{key:"getGapsPerColumn",value:function(){return Array.from(this.positionalLetterCounts).map((function(e){var t=Object(f.a)(e,2),n=(t[0],t[1]);return isNaN(n["-"])?0:n["-"]}))}},{key:"getGapCountAtColumn",value:function(e){var t=this.positionalLetterCounts.get(e);return t&&t["-"]?t["-"]:0}},{key:"getGlobalAlphaLetterCounts",value:function(t,n){return t?e.normalizeLetterCounts(this.globalAlphaLetterCounts,n):this.globalAlphaLetterCounts}},{key:"getMaxSequenceLength",value:function(){return this.getSequences().reduce((function(e,t){return t.sequence.length>e&&(e=t.sequence.length),e}),-1)}},{key:"getPositionalLetterCounts",value:function(t,n){return t||n?Array.from(this.positionalLetterCounts).reduce((function(i,r){var a=Object(f.a)(r,2),o=a[0],s=a[1];return i.set(o,t?e.normalizeLetterCounts(s,n):Object.keys(s).reduce((function(e,t){return n.includes(t)&&(e[t]=s[t]),e}),{})),i}),new Map):this.positionalLetterCounts}},{key:"getSequences",value:function(e,t){if(e=e||R.INPUT,t=t||!1,!this.sequences.has(e)||t)switch(e){case R.INPUT:break;case R.HAMMING_DIST_TARGET:this.sequences.set(e,this.sortByDistanceToTargetSequence(R.HAMMING_DIST_TARGET.distanceFn));break;default:throw Error('The sortBy option provided "'.concat(e,'" is not implemented'))}return this.sequences.get(e)}},{key:"getSortedUpperAlphaLetters",value:function(){return this.allUpperAlphaLettersSorted}},{key:"getTargetSequence",value:function(){return this.targetSequence}},{key:"setTargetSequence",value:function(e){var t=this;if(void 0===this.getSequences().find((function(t){return t===e})))throw Error("target sequence does not exist in alignment");this.targetSequence=e,this.sequences.forEach((function(e,n){t.getSequences(n,!0)}))}},{key:"sortByDistanceToTargetSequence",value:function(t){var n=this,i=this.getSequences();switch(t){case q.hamming:return i.map((function(e){return e})).sort((function(t,i){return e.getSequenceDistance(n.targetSequence,t,q.hamming)-e.getSequenceDistance(n.targetSequence,i,q.hamming)}));default:throw Error('The distFn option provided "'.concat(t,'" is not implemented'))}}}]),e}();n(40);!function(e){e[e.vertical=0]="vertical",e[e.horizontal=1]="horizontal",e[e.both=2]="both"}(z||(z={}));var F,G=function(){function e(t){var n=this;Object(u.a)(this,e),this.scrollDirection=void 0,this.aceEditorDirection=void 0,this.scrollers=void 0,this.scrollFnHandles=void 0,this.handleScroll=function(e,t){n.scrollers.filter((function(t){return t!==e})).forEach((function(t){n.syncScrollPosition(e,t)}))},this.scrollDirection=t,this.aceEditorDirection=t===z.horizontal?"changeScrollLeft":"changeScrollTop",this.scrollers=[],this.scrollFnHandles=new Map}return Object(h.a)(e,[{key:"registerElementScroller",value:function(e){var t=this;this.scrollers.includes(e)||(this.scrollers.push(e),e.addEventListener("mouseenter",(function(){t.addScrollEvents(e)})),e.addEventListener("mouseleave",(function(){t.removeScrollEvents(e)})))}},{key:"registerAceScroller",value:function(e,t){var n=this;this.scrollers.includes(e)||(this.scrollers.push(e),t.addEventListener("mouseenter",(function(){n.addScrollEvents(e)})),t.addEventListener("mouseleave",(function(){n.removeScrollEvents(e)})))}},{key:"isAceEditor",value:function(e){return"renderer"in e}},{key:"syncScrollPosition",value:function(e,t){if(this.scrollDirection===z.horizontal){var n=this.isAceEditor(e)?e.session.getScrollLeft():e.scrollLeft;this.isAceEditor(t)?t.session.getScrollLeft()!==n&&t.session.setScrollLeft(n):t.scrollLeft!==n&&(t.scrollLeft=n)}else{var i=this.isAceEditor(e)?e.session.getScrollTop():e.scrollTop;this.isAceEditor(t)?t.session.getScrollTop()!==i&&t.session.setScrollTop(i):t.scrollTop!==i&&(t.scrollTop=i)}}},{key:"addScrollEvents",value:function(e){this.scrollFnHandles.has(e)||this.scrollFnHandles.set(e,this.handleScroll.bind(this,e));var t=this.scrollFnHandles.get(e);this.isAceEditor(e)?e.session.on(this.aceEditorDirection,t):e.addEventListener("scroll",t)}},{key:"removeScrollEvents",value:function(e){var t=this.scrollFnHandles.get(e);t?this.isAceEditor(e)?e.session.off(this.aceEditorDirection,t):e.removeEventListener("scroll",t):console.log("failed to remove scrollFn")}}]),e}();!function(e){e.LETTERS="letter stack",e.BARS="bar plot"}(F||(F={}));var Y=function(e){function t(){var e,n;Object(u.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).scrollerDiv=void 0,n.loaded=!1,n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"divLoaded",value:function(e){e&&!this.scrollerDiv&&(this.scrollerDiv=e,this.props.logoLoaded&&this.props.logoLoaded(this.scrollerDiv))}},{key:"shouldComponentUpdate",value:function(e){return!1===this.loaded||this.props.logoType!==e.logoType||this.props.glyphWidth!==e.glyphWidth||this.props.alignment!==e.alignment}},{key:"render",value:function(){var e=this;if(!this.props.alignment||!this.props.glyphWidth)return null;var t=this.props.alignment.getPositionalLetterCounts(),n=this.props.alignment.getSortedUpperAlphaLetters(),i=[];t.forEach((function(e,t){var r=Object.keys(e).reduce((function(t,n){return t+=e[n]}),0),a=n.map((function(t){var n=0;return t in e&&(n=e[t]/r),n}));i.push(a)}));var a=n.map((function(e){return{letter:e,classNames:_(e,!1,!1,!1)}})),o=i.map((function(e,t){return e.map((function(e,t){return{frequency:e,letter:a[t]}})).filter((function(e){return 0!==e.frequency})).sort((function(e,t){return e.frequency>t.frequency?1:-1}))})),s=i.length*this.props.glyphWidth;this.loaded=!0;return r.a.createElement("div",{id:this.props.id,ref:function(t){return e.divLoaded(t)}},r.a.createElement("svg",{preserveAspectRatio:"none",viewBox:"0 0 ".concat(o.length," 100"),style:{width:s,height:100},xmlns:"http://www.w3.org/2000/svg"},o.map((function(t,n){return r.a.createElement("g",{transform:"translate(".concat(n,",0)"),key:"p_"+n,className:x},function(t){var n=100;return t.map((function(t,i){if(n-=100*t.frequency,e.props.logoType===F.BARS){var a=2/o.length;return r.a.createElement("rect",{width:"100",height:"100",transform:"translate(0, ".concat(n,") scale(").concat(a,",").concat(t.frequency,")"),className:t.letter.classNames,key:"idxrect_".concat(i)})}return H.glyphFromChar(t.letter.letter)({className:t.letter.classNames,transform:"translate(0, ".concat(n,") scale(").concat(.009,",").concat(t.frequency,")"),key:"idxglyph_".concat(i)})}))}(t))}))))}}]),t}(r.a.Component);Y.defaultProps={logoType:F.LETTERS};var V=n(10),X=n(28),Q=n.n(X),K=(n(41),n(31)),Z=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).cache={},n.state={svgHovered:!1,positionsSelected:[]},n.handleSvgHover=n.handleSvgHover.bind(Object(V.a)(n)),n.handlePositionHover=n.handlePositionHover.bind(Object(V.a)(n)),n.handlePositionClicked=n.handlePositionClicked.bind(Object(V.a)(n)),n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"handleSvgHover",value:function(e){this.setState({svgHovered:e})}},{key:"handlePositionHover",value:function(e,t,n){var i=this.props,r=i.onPositionMouseEnter,a=i.onPositionMouseLeave;n&&r?r(t,e.relatedTarget,this.getBars().barsGroupedByPosition.get(t)):!n&&a&&a(t,e.relatedTarget,this.getBars().barsGroupedByPosition.get(t)),this.setState({positionHovered:n?{position:t,element:e.relatedTarget,bars:this.getBars().barsGroupedByPosition.get(t)}:void 0})}},{key:"handlePositionClicked",value:function(e,t){var n=this.state.positionsSelected,i=this.props.onPositionSelectionChanged,r=n.some((function(e){return e.position===t}))?n.filter((function(e){return e.position!==t})):[].concat(Object(g.a)(n),[{position:t,element:e.relatedTarget,bars:this.getBars().barsGroupedByPosition.get(t)}]);i&&i(r),this.setState({positionsSelected:r})}},{key:"normalizeBarHeights",value:function(e){var n=this.props.alignment,i=e.map((function(e){return e.height})),r=Math.min.apply(Math,Object(g.a)(i)),a=Math.max.apply(Math,Object(g.a)(i));return e.map((function(e){var i=r,o=e.dataSeries.plotOptions&&e.dataSeries.plotOptions.fixYMax?e.dataSeries.plotOptions.fixYMax(n):a;return Object(c.a)({},e,{normalizedHeight:(e.height-i)/(o-i)*t.POSITION_VIEWBOX_HEIGHT})}))}},{key:"getBars",value:function(){var e=this,t=this.props,n=t.alignment,i=t.dataSeries;if(!this.cache.bars||n!==this.cache.alignment||i!==this.cache.dataSeries){this.cache.alignment=n,this.cache.dataSeries=i;var r=n.getMaxSequenceLength(),a=[];i.forEach((function(e){for(var t=0;t<r;t++)a.push(Object(c.a)({},e.getPositionalInfo(t,n),{position:t,dataSeries:e,normalizedHeight:-1}))})),this.cache.bars=Object.entries(Q.a.groupBy(a,(function(e){return e.dataSeries.id}))).map((function(t){var n=Object(f.a)(t,2),i=(n[0],n[1]);return e.normalizeBarHeights(i)})).flat(),this.cache.barsGroupedByPosition=v(this.cache.bars,(function(e){return e.position})),this.cache.barsGroupedByDataseries=v(this.cache.bars,(function(e){return e.dataSeries}))}return{bars:this.cache.bars,barsGroupedByPosition:this.cache.barsGroupedByPosition,barsGroupedByDataseries:this.cache.barsGroupedByDataseries}}},{key:"renderTooltip",value:function(){var e=this.getBars();return r.a.createElement(K.a,{id:"getBarContent",effect:"solid",type:"light",border:!0,getContent:function(t){var n=parseInt(t),i=e.barsGroupedByPosition.get(n),a=n+1;return i?r.a.createElement("div",{className:"bar-position-textblock"},r.a.createElement("h1",null,"Position: ",a),i.map((function(e){return r.a.createElement("div",{className:"dataseries-line ".concat(e.dataSeries.cssClass),key:e.dataSeries.id},r.a.createElement("span",{className:"legend-square"}),r.a.createElement("span",{className:"legend-text"},e.dataSeries.name,": ",+e.height.toFixed(2)))}))):void 0}})}},{key:"renderBarPlot",value:function(){var e=this,n=this.props,i=n.alignment,a=n.positionWidth,o=n.height,s=i.getMaxSequenceLength(),l=a*s,c=this.getBars();return r.a.createElement("svg",{preserveAspectRatio:"none",viewBox:"0 0 ".concat(s*t.POSITION_VIEWBOX_WIDTH," ").concat(t.POSITION_VIEWBOX_HEIGHT),style:{width:l,height:o},xmlns:"http://www.w3.org/2000/svg",onMouseEnter:function(){return e.handleSvgHover(!0)},onMouseLeave:function(){return e.handleSvgHover(!1)}},Array.from(c.barsGroupedByPosition.entries()).map((function(n){var i=Object(f.a)(n,2),a=i[0],o=i[1],s=Math.max.apply(Math,Object(g.a)(o.map((function(e){return e.normalizedHeight}))));return r.a.createElement("g",{transform:"translate(".concat(a*t.POSITION_VIEWBOX_WIDTH,",0)"),className:e.state.positionsSelected.some((function(e){return e.position===a}))?"position-container selected":"position-container",onClick:function(t){e.handlePositionClicked(t,a)},onMouseEnter:function(t){e.handlePositionHover(t,a,!0)},onMouseLeave:function(t){e.handlePositionHover(t,a,!1)},"data-for":"getBarContent","data-tip":a,"data-class":"barplot-tooltip-container",key:"pos_".concat(a)},o.map((function(e,n){return r.a.createElement("rect",{className:e.dataSeries.cssClass,transform:"translate(".concat(1*n/o.length*t.POSITION_VIEWBOX_WIDTH,",").concat(t.POSITION_VIEWBOX_HEIGHT-e.normalizedHeight,")"),width:1/c.barsGroupedByDataseries.size*t.POSITION_VIEWBOX_WIDTH,height:e.normalizedHeight,key:"".concat(e.position,"_").concat(e.dataSeries.id)})})),r.a.createElement("rect",{className:"interaction-placeholder",transform:"translate(0,".concat(t.POSITION_VIEWBOX_HEIGHT-s,")"),width:t.POSITION_VIEWBOX_WIDTH,height:s}))})))}},{key:"render",value:function(){var e=this.state.svgHovered?"barplot hovered":"barplot";return this.props.alignment?r.a.createElement("div",{className:e},this.renderTooltip(),this.renderBarPlot()):null}}]),t}(r.a.Component);Z.POSITION_VIEWBOX_HEIGHT=100,Z.POSITION_VIEWBOX_WIDTH=20,Z.defaultProps={height:100},Z.ENTROPY_BARPLOT={id:"entropy",name:"Entropy",cssClass:"barplot-entropy",getPositionalInfo:function(e,t){var n=t.getPositionalLetterCounts(!0,t.getSortedUpperAlphaLetters()).get(e);return{height:n&&0!==Object.keys(n).length?-1*Object.values(n).reduce((function(e,t){return e+t*Math.log2(t)}),0):0}}},Z.GAPS_BARPLOT={id:"gaps",name:"Gaps",cssClass:"barplot-gaps",plotOptions:{fixYMax:function(e){return e.getSequences().length}},getPositionalInfo:function(e,t){return{height:t.getGapCountAtColumn(e)}}};var $=n(3),J=n(15),ee=n(30),te=Object(J.PixiComponent)("AlignmentHighlighter",{create:function(e){return new $.Graphics},applyProps:function(e,t,n){var i=n.x,r=n.y,a=n.width,o=n.height,s=n.fillColor,l=n.fillAlpha;e.clear(),e.beginFill(s,l),e.drawRect(i,r,a,o),e.endFill()}}),ne=function(e){function t(){var e,n;Object(u.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(a)))).app=void 0,n.scaleX=1,n.scaleY=1,n.renderAlignmentHighlighter=function(e){return r.a.createElement(te,Object(c.a)({fillColor:16711680,fillAlpha:.25},e))},n.onMouseEnter=function(e){document.body.style.overflow="hidden"},n.onMouseLeave=function(e){document.body.style.overflow="auto"},n.onWheel=function(e){},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"sliderChanged",value:function(e,t){this.app&&this.app.stage.children.forEach((function(n){"x"===t?n.scale.x=e:n.scale.y=e}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.alignment,i=t.alignmentType,a=t.colorScheme,o=t.highlightRows,s=t.id,l=t.positionsToStyle,c=t.sortBy,u=t.stageResolution,h=t.viewportProps;if(!n)return null;var d=n.getSequences().length,p=n.getMaxSequenceLength();$.utils.skipHello(),$.settings.SCALE_MODE=$.SCALE_MODES.NEAREST;var m=o?o[1]-o[0]:void 0;return r.a.createElement("div",{id:s,onWheel:this.onWheel,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},r.a.createElement(J.Stage,{width:null===u||void 0===u?void 0:u.width,height:null===u||void 0===u?void 0:u.height,options:{transparent:!0}},r.a.createElement(J.AppContext.Consumer,null,(function(t){return e.app=t,r.a.createElement(r.a.Fragment,null)})),r.a.createElement(J.AppContext.Consumer,null,(function(t){return r.a.createElement(re,Object.assign({app:t,numColumns:p,numRows:d,mouseDown:e.props.mouseDown},h),r.a.createElement(ie,{id:"tiled-alignment",alignment:n,alignmentType:i,sortBy:c,colorScheme:a,positionsToStyle:l}),m?r.a.createElement(r.a.Fragment,null,e.renderAlignmentHighlighter({x:0,y:e.props.highlightRows[0],width:p,height:m})):r.a.createElement(r.a.Fragment,null))}))))}}]),t}(r.a.Component);ne.defaultProps={mouseDown:function(){},stageResolution:{width:485,height:650},viewportProps:{useDrag:!0,usePinch:!0,useWheel:!0,zoomPercent:0}};var ie=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(h.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.alignment!==this.props.alignment||e.colorScheme!==this.props.colorScheme||e.positionsToStyle!==this.props.positionsToStyle||e.sortBy!==this.props.sortBy}},{key:"render",value:function(){if(!this.props.alignment)return null;for(var e=this.props,t=e.alignment,n=e.alignmentType,i=e.colorScheme,a=e.positionsToStyle,o=e.sortBy,s=t.getSequences(o),l=t.getMaxSequenceLength(),c=s.length,u={fullWidth:l,fullHeight:c,targetTileWidth:Math.min(400,l),targetTileHeight:Math.min(400,c)},h=this.initializeTiledImages(u),d=0;d<h.numYTiles;d++)for(var p=0;p<h.numXTiles;p++){var m=this.generateCanvasForTile(p,d,u.targetTileWidth,u.targetTileHeight,h,s);h.tiles.push(m)}return r.a.createElement(r.a.Fragment,null,h.tiles.map((function(e){return r.a.createElement(J.Sprite,{source:e.image,x:e.pixelX,y:e.pixelY,key:"".concat(e.tileX,"_\n                  ").concat(e.tileY,"_\n                  ").concat(i.commonName,"_\n                  ").concat(a.key,"_\n                  ").concat(n.key,"_\n                  ").concat(o.key,"_\n                  ").concat(t.getName())})})))}},{key:"colorCanvasWithSequence",value:function(e,t,n,i,r){for(var a=0,o=0;o<n.height;o++)for(var s=i[o+r.seqY],l=0;l<n.width;l++){var c=s.sequence[l+r.letterX],u=this.getCurrentMoleculeColors(c,l,r);e.data[a]=u.rgb.red,e.data[a+1]=u.rgb.green,e.data[a+2]=u.rgb.blue,e.data[a+3]=255,a+=4}t.putImageData(e,0,0)}},{key:"generateCanvasForTile",value:function(e,t,n,i,r,a){var o=document.createElement("canvas");o.height=t===r.numYTiles-1?r.lastTileHeight:i,o.width=e===r.numXTiles-1?r.lastTileWidth:n;var s={seqY:t*i,letterX:e*n},l=o.getContext("2d");null===l||void 0===l||l.fillRect(0,0,o.width,o.height);var c=null===l||void 0===l?void 0:l.getImageData(0,0,o.width,o.height);return c&&l&&this.colorCanvasWithSequence(c,l,o,a,s),{tileX:e,tileY:t,pixelX:s.letterX,pixelY:s.seqY,width:o.width,height:o.height,image:o}}},{key:"getCurrentMoleculeColors",value:function(e,t,n){var i=this.props,r=i.alignment,a=i.alignmentType,o=i.colorScheme,s=r.getConsensus(),l=r.getTargetSequence().sequence,c=a===T.AMINOACID?B:W,u=c.UNKNOWN;if(this.props.positionsToStyle===k.ALL)u=c.fromSingleLetterCode(e);else{var h=s[t+n.letterX].letter===e,d=l[t+n.letterX]===e;(this.props.positionsToStyle===k.CONSENSUS&&h||this.props.positionsToStyle===k.CONSENSUS_DIFF&&!h||this.props.positionsToStyle===k.QUERY&&d||this.props.positionsToStyle===k.QUERY_DIFF&&!d)&&(u=c.fromSingleLetterCode(e))}return u.colors[o.commonName]}},{key:"initializeTiledImages",value:function(e){var t=e.targetTileWidth,n=void 0===t?0:t,i=e.targetTileHeight,r=void 0===i?0:i,a=e.fullWidth,o=void 0===a?0:a,s=e.fullHeight,l=void 0===s?0:s;return{targetTileWidth:n,targetTileHeight:r,lastTileWidth:o%n!==0?o%n:n,lastTileHeight:l%r!==0?l%r:r,numXTiles:o%n!==0?Math.floor(o/n)+1:Math.floor(o/n),numYTiles:l%r!==0?Math.floor(l/r)+1:Math.floor(l/r),tiles:[]}}}]),t}(r.a.Component),re=Object(J.PixiComponent)("PixiViewport",{create:function(e){var t=e.app,n=e.numColumns,i=e.numRows,r=e.useDrag,a=e.usePinch,o=e.useWheel,s=e.zoomPercent;t.renderer.backgroundColor=16777215;var l=new ee.a({screenWidth:t.renderer.width,screenHeight:t.renderer.height,worldWidth:n,worldHeight:i,interaction:t.renderer.plugins.interaction}).decelerate().clamp({direction:"all"}).bounce({friction:.1,time:150,underflow:"center"}).clampZoom({maxHeight:t.renderer.height,maxWidth:t.renderer.width});return r&&(l=l.drag({direction:"all"})),a&&(l=l.pinch()),o&&(l=l.wheel()),s&&(l=l.zoomPercent(s)),l.on("clicked",(function(t){e.mouseDown&&e.mouseDown(t.world.x,t.world.y)})),l},applyProps:function(e,t,n){return t.numColumns===n.numColumns&&t.numRows===n.numRows||(e.screenWidth=n.app.renderer.width,e.screenHeight=n.app.renderer.height,e.worldWidth=n.numColumns,e.worldHeight=n.numRows,e=(e=e.fitWorld(!0)).setZoom(n.app.renderer.width/n.numColumns,!1)),e}}),ae=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).renderCanvasComponent=function(){var e=n.props,t=e.alignment,r=e.highlightRows,a=e.sortBy,o=e.style,s=n.state.zoomPercent,l=n.getSizing();return i.createElement("div",null,i.createElement(ne,{id:"alignment_canvas",alignment:t,alignmentType:o.alignmentType,positionsToStyle:o.positionsToStyle,colorScheme:o.colorScheme,sortBy:a,stageResolution:{width:l.frameWidth,height:l.frameHeight},highlightRows:r,viewportProps:{useDrag:!0,usePinch:!0,useWheel:!0,zoomPercent:s},mouseDown:n.onMouseDown}))},n.onMouseDown=function(e,t){var i=n.props.onClick;i&&i(e,t)},n.state={zoomPercent:1},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"getSizing",value:function(){return{borderWidth:1,margin:2,frameHeight:this.props.height-4-1,frameWidth:this.props.width-4-1}}},{key:"render",value:function(){var e=this.props.alignHorizontal,t=this.getSizing();return i.createElement("div",{style:Object(c.a)({zIndex:1e5},"left"===e?{left:0}:{right:0},{top:0,bottom:0,height:t.frameHeight,width:t.frameWidth,position:"fixed",backgroundColor:"white",borderColor:"#333333",borderStyle:"solid",borderWidth:"".concat(t.borderWidth,"px"),margin:"".concat(t.margin,"px")})},this.renderCanvasComponent())}}]),t}(i.Component);ae.defaultProps={alignHorizontal:"right",height:600,width:300};var oe=function(e){function t(){var e,n;Object(u.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).editor=void 0,n.lastText=void 0,n.lastMode=void 0,n.element=void 0,n.lastElementWidth=void 0,n.lastElementHeight=void 0,n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"getText",value:function(){if(this.props.text)return this.props.text;throw Error("Internal error: 'text' attribute must be provided or subclasses must implement getText()")}},{key:"getEditorMode",value:function(){return this.props.editorMode}},{key:"setupEditorAndEventListeners",value:function(e){this.editor=S.a.edit(e),this.editor.setShowPrintMargin(!1),this.editor.setReadOnly(!0),this.editor.setHighlightActiveLine(!1),this.editor.setHighlightGutterLine(!1),this.editor.setFontSize(this.props.fontSize+"px"),this.editor.renderer.setShowGutter(!1),this.editor.renderer.setPadding(0),this.editor.renderer.$cursorLayer.element.style.display="none"}},{key:"addMouseEventListeners",value:function(){var e=this;if(!this.editor)throw Error("Editor must be defined before adding mouse listeners.");function t(e,t){var n=t.getDocumentPosition(),i=e.renderer.textToScreenCoordinates(n.row,n.column);return{mouseRow:n.row,mouseColumn:n.column,mousePageX:i.pageX,mousePageY:i.pageY}}return this.editor.on("mousemove",(function(n){e.props.mouseMove&&e.props.mouseMove(t(e.editor,n))})),this.editor.on("mousedown",(function(n){e.props.mouseDown&&e.props.mouseDown(t(e.editor,n))})),this.editor}},{key:"setText",value:function(){if(!this.editor)throw Error("Editor must be defined to call setText()");if(this.props.fontSize+"px"!==this.editor.getFontSize()&&(this.editor.setFontSize(this.props.fontSize+"px"),this.props.characterSizeChanged&&this.editor.renderer.characterWidth&&this.props.characterSizeChanged(this.editor.renderer.characterWidth)),this.lastMode!==this.getEditorMode()){var e=this.getEditorMode();this.editor.session.setMode(e),this.lastMode=e}if(!this.lastText||this.lastText!==this.getText()){this.editor.selectAll(),this.editor.removeLines();var t=this.getText();this.editor.insert(t),this.lastText=t}}},{key:"initialLoad",value:function(e){e&&!this.editor&&(this.element=e,this.lastElementWidth=e.clientWidth,this.lastElementHeight=e.clientHeight,this.setupEditorAndEventListeners(e),this.addMouseEventListeners(),this.setText(),this.props.editorLoaded&&this.props.editorLoaded(this.editor,e))}},{key:"componentDidUpdate",value:function(){if(!this.editor||!this.element)throw Error("internal error - componentDidUpdate called before editor initialized");return this.setText(),this.element.clientWidth===this.lastElementWidth&&this.element.clientHeight===this.lastElementHeight||(this.lastElementWidth=this.element.clientWidth,this.lastElementHeight=this.element.clientHeight,this.editor.resize()),!1}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:this.props.classNames,onMouseEnter:function(){e.props.mouseEnter&&e.props.mouseEnter()},onMouseLeave:function(){e.props.mouseLeave&&e.props.mouseLeave()}},r.a.createElement("div",{id:this.props.id,ref:function(t){return e.initialLoad(t)}}))}}]),t}(r.a.Component);oe.defaultProps={fontSize:14};var se=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(h.a)(t,[{key:"getText",value:function(){return this.props.alignment.getSequences(this.props.sortBy).map((function(e){return e.sequence})).join("\n")}},{key:"getEditorMode",value:function(){return this.props.alignment.getAceEditorMode()}}]),t}(oe);se.defaultProps={sortBy:R.INPUT,fontSize:14};var le=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(h.a)(t,[{key:"getText",value:function(){return this.props.alignment.getConsensus().map((function(e){return e.letter})).join("")}}]),t}(se),ce=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(h.a)(t,[{key:"getText",value:function(){return this.props.alignment.getTargetSequence().sequence}}]),t}(se),ue=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(h.a)(t,[{key:"getText",value:function(){return t.generateTextualRuler(this.props.alignment.getMaxSequenceLength())}},{key:"getEditorMode",value:function(){}}],[{key:"generateTextualRuler",value:function(e){for(var t="",n=1;n<=e+1;n++){var i=n%10===0;if(t+=i?"|":!i&&n%5===0?":":".",i){var r=""+n,a=t.length-r.length-1;a<0||(t=t.substr(0,a)+r+"|")}}return t}}]),t}(oe),he={logoPlotStyle:F.LETTERS,zoomLevel:13,sortBy:R.INPUT,showMiniMap:!1,showAnnotations:!0},de=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).verticalScrollSync=void 0,n.horizontalScrollSync=void 0,n.handleCharacterSizeChanged=function(e){n.state.aceCharacterWidth!==e&&n.setState({aceCharacterWidth:e})},n.aceEditorLoaded=function(e,t,i,r){r!==z.horizontal&&r!==z.both||n.horizontalScrollSync.registerAceScroller(t,i),r!==z.vertical&&r!==z.both||n.verticalScrollSync.registerAceScroller(t,i),n.setState({aceCharacterWidth:t.renderer.characterWidth,aceEditors:[t].concat(n.state.aceEditors)}),"ace-alignment"===e&&t.renderer.on("afterRender",(function(){setTimeout((function(){n.setState({alignmentEditorVisibleFirstRow:t.renderer.getFirstFullyVisibleRow(),alignmentEditorVisibleLastRow:t.renderer.getLastFullyVisibleRow()})}))}))},n.windowDimensionsUpdated=function(){n.setState({windowWidth:window.innerWidth,windowHeight:window.innerHeight})},n.renderSequenceLogo=function(){return r.a.createElement("div",{className:"logo_box ".concat(n.props.style.alignmentType.className," ")+"".concat(n.props.style.colorScheme.className," ")+"".concat(k.ALL.className)},r.a.createElement(Y,{id:"sequence_logo",alignment:n.props.alignment,glyphWidth:n.state.aceCharacterWidth,logoType:n.props.logoPlotStyle}))},n.renderConservationBox=function(){var e=n.state.defaultBarplotData;return r.a.createElement(Z,{alignment:n.props.alignment,dataSeries:e,positionWidth:n.state.aceCharacterWidth})},n.renderConsensusQueryBox=function(){return r.a.createElement("div",{className:"consensusseq_box"},r.a.createElement(le,{id:"ace-consensusseq",alignment:n.props.alignment,fontSize:n.props.zoomLevel,classNames:[n.props.style.residueDetail.className,n.props.style.alignmentType.className,n.props.style.positionsToStyle.className,n.props.style.colorScheme.className].join(" "),editorLoaded:function(e,t){n.aceEditorLoaded("ace-consensusseq",e,t,z.horizontal)}}))},n.renderQuerySeqBox=function(){return r.a.createElement("div",{className:"queryseq_box"},r.a.createElement(ce,{id:"ace-queryseq",alignment:n.props.alignment,fontSize:n.props.zoomLevel,sortBy:n.props.sortBy,classNames:[n.props.style.residueDetail.className,n.props.style.alignmentType.className,n.props.style.positionsToStyle.className,n.props.style.colorScheme.className].join(" "),editorLoaded:function(e,t){n.aceEditorLoaded("ace-queryseq",e,t,z.horizontal)}}))},n.renderPositionBox=function(){return r.a.createElement("div",{className:"position_box"},r.a.createElement(ue,{id:"ace-positions",alignment:n.props.alignment,fontSize:n.props.zoomLevel,editorLoaded:function(e,t){n.aceEditorLoaded("ace-positions",e,t,z.horizontal)},mouseEnter:function(){},mouseLeave:function(){},mouseMove:function(e){},mouseDown:function(e){}}))},n.renderAlignmentBox=function(){return r.a.createElement("div",{className:"alignment_box"},r.a.createElement(se,{id:"ace-alignment",alignment:n.props.alignment,fontSize:n.props.zoomLevel,sortBy:n.props.sortBy,classNames:[n.props.style.residueDetail.className,n.props.style.alignmentType.className,n.props.style.positionsToStyle.className,n.props.style.colorScheme.className].join(" "),characterSizeChanged:n.handleCharacterSizeChanged,editorLoaded:function(e,t){n.aceEditorLoaded("ace-alignment",e,t,z.both)}}))},n.renderAlignmentAnnotationBox=function(){return r.a.createElement("div",{className:"alignment_metadata_box"},r.a.createElement(oe,{id:"ace-alignment-metadata",text:n.props.alignment.getSequences(n.props.sortBy).map((function(e){return e.id})).join("\n"),fontSize:n.props.zoomLevel,editorLoaded:function(e,t){n.aceEditorLoaded("ace-alignment-metadata",e,t,z.vertical)}}))},n.onMinimapClick=function(e,t){var i=n.state,r=i.aceEditors,a=i.alignmentEditorVisibleFirstRow,o=i.alignmentEditorVisibleLastRow,s=40;void 0!==a&&void 0!==o&&(s=o-a),r.length>=1&&r[0].scrollToRow(Math.floor(t-s/2))},n.state={aceEditors:[],aceCharacterWidth:0,windowWidth:window.innerWidth,windowHeight:window.innerHeight,defaultBarplotData:[Z.ENTROPY_BARPLOT,Z.GAPS_BARPLOT]},n.verticalScrollSync=new G(z.vertical),n.horizontalScrollSync=new G(z.horizontal),n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"generateWidget",value:function(e,t,n,i){var a=this;return r.a.createElement("div",{className:"av-widget ".concat(e)},r.a.createElement("div",{className:"av-annotation"},t),r.a.createElement("div",{className:"av-content",ref:function(e){e&&i&&a.horizontalScrollSync.registerElementScroller(e)}},n))}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.windowDimensionsUpdated)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.windowDimensionsUpdated)}},{key:"render",value:function(){if(!this.props.alignment)return null;var e=this.props.showAnnotations?"":" annotation-closed";return r.a.createElement("div",{className:"alignment_viewer".concat(e)},this.renderMiniMap(),this.generateWidget("av-conservation-gaps","Conservation / gaps:",this.renderConservationBox(),!0),this.generateWidget("av-sequence-logo","Logo:",this.renderSequenceLogo(),!0),this.generateWidget("av-consensus-seq","Consensus sequence:",this.renderConsensusQueryBox()),this.generateWidget("av-target-seq","Query sequence:",this.renderQuerySeqBox()),this.generateWidget("av-position-indicator","Position:",this.renderPositionBox()),this.generateWidget("av-ace-msa",this.renderAlignmentAnnotationBox(),this.renderAlignmentBox()))}},{key:"renderMiniMap",value:function(){var e=this.props,t=e.alignment,n=e.sortBy,i=e.showMiniMap,a=e.style,o=this.state.windowHeight,s=Math.max(300,Math.min(450,t.getMaxSequenceLength())),l=i?"mini-map":"mini-map hidden";return t&&a&&r.a.createElement("div",{className:l},r.a.createElement(ae,{width:s,height:o,alignHorizontal:"right",alignment:t,style:a,sortBy:n,highlightRows:void 0!==this.state.alignmentEditorVisibleFirstRow&&void 0!==this.state.alignmentEditorVisibleLastRow?[this.state.alignmentEditorVisibleFirstRow,this.state.alignmentEditorVisibleLastRow]:void 0,onClick:this.onMinimapClick}))}}]),t}(r.a.Component);de.defaultProps=he;var pe=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).fileInput=void 0,n.handleSubmit=n.handleSubmit.bind(Object(V.a)(n)),n.fileInput=i.createRef(),n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"handleSubmit",value:function(e){var t=this.props.onFileLoadCb;e.preventDefault(),t&&this.fileInput.current&&this.fileInput.current.files&&t(this.fileInput.current.files[0],e),e.target.value=""}},{key:"render",value:function(){var e=this.props.labelText;return i.createElement("label",null,i.createElement("strong",null,e),i.createElement("input",{type:"file",id:"files",ref:this.fileInput,onInput:this.handleSubmit}))}}]),t}(i.Component);pe.defaultProps={labelText:"Upload:"};var me=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props,t=e.fileURL,n=e.fileName,r=e.labelText,a=e.onStartLoading,o=e.onFileLoaded;return i.createElement("button",{type:"button",className:"button-link",onClick:function(e){var i;return l.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return a&&a(),e.t0=File,e.t1=l.a,e.next=5,l.a.awrap(fetch("".concat(t)));case 5:return e.t2=e.sent.blob(),e.next=8,e.t1.awrap.call(e.t1,e.t2);case 8:e.t3=e.sent,e.t4=[e.t3],e.t5=n,i=new e.t0(e.t4,e.t5),o(i);case 13:case"end":return e.stop()}}))}},r)}}]),t}(i.Component),fe=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).renderSettingsBox=function(e){var t=n.state.alignment,i=t?r.a.createElement("div",null,r.a.createElement("h3",null,t.getName()),r.a.createElement("h4",null,"".concat(t.getSequences().length," sequences (rows) and ").concat(t.getMaxSequenceLength()," positions (columns) "))):r.a.createElement(r.a.Fragment,null);return r.a.createElement("div",{className:"settings_box"},r.a.createElement("form",null,r.a.createElement("div",{className:"settings-header"},r.a.createElement("button",{style:{display:n.state.showSettings?"none":"block"},type:"button",className:"button-link",onClick:function(e){n.setState({showSettings:!0})}},"Expand"),r.a.createElement("button",{style:{display:n.state.showSettings?"block":"none"},type:"button",className:"button-link",onClick:function(e){n.setState({showSettings:!1})}},"Hide"),r.a.createElement("div",null,r.a.createElement("h2",null,"AlignmentViewer 2.0 Settings Demo"),i)),r.a.createElement("div",{style:{display:n.state.showSettings?"block":"none",position:"relative"}},n.renderAlignmentTypeLabel(e),n.renderSortControl(),n.renderColorScheme(e),n.renderResidueDetail(e),n.renderPositionStyling(e),n.renderSequenceLogo(),n.renderZoomButtons(),n.renderMiniMapToggle(),n.renderAnnotationToggle(),r.a.createElement("br",null),n.renderFileUpload(),n.renderExampleLinks(),r.a.createElement("div",{className:"loader",style:{display:n.state.loading?"block":"none"}}))))},n.renderSortControl=function(){var e=n.state.sortBy;return r.a.createElement("div",null,r.a.createElement("label",null,r.a.createElement("strong",null,"Sort order:"),r.a.createElement("select",{value:e.key,onChange:function(e){return n.setState({sortBy:R.fromKey(e.target.value)})}},R.list.map((function(e){return r.a.createElement("option",{value:e.key,key:e.key},e.description)})))))},n.renderAlignmentTypeLabel=function(e){return r.a.createElement("div",null,r.a.createElement("label",null,r.a.createElement("strong",null,"Alignment Type:"),r.a.createElement("select",{value:e.alignmentType.key,onChange:function(e){return n.setState({style:N.fromAlignmentType(T.fromKey(e.target.value))})}},T.list.map((function(e){return r.a.createElement("option",{value:e.key,key:e.key},e.description)})))))},n.renderColorScheme=function(e){return r.a.createElement("div",null,r.a.createElement("label",null,r.a.createElement("strong",null,"Style:"),r.a.createElement("select",{value:e.alignmentType.allColorSchemes.indexOf(e.colorScheme),onChange:function(t){n.setState({style:Object(c.a)({},e,{colorScheme:e.alignmentType.allColorSchemes[parseInt(t.target.value)]})})}},e.alignmentType.allColorSchemes.map((function(e,t){return r.a.createElement("option",{key:t,value:t},e.description)})))))},n.renderResidueDetail=function(e){return r.a.createElement("div",null,r.a.createElement("label",null,r.a.createElement("strong",null,"Residue Detail:"),r.a.createElement("select",{value:e.residueDetail.key,onChange:function(t){n.setState({style:Object(c.a)({},e,{residueDetail:A.fromKey(t.target.value)})})}},A.list.map((function(e){return r.a.createElement("option",{key:e.key,value:e.key},e.description)})))))},n.renderPositionStyling=function(e){return r.a.createElement("div",null,r.a.createElement("label",null,r.a.createElement("strong",null,"Positions to Style:"),r.a.createElement("select",{value:k.list.indexOf(e.positionsToStyle),onChange:function(t){n.setState({style:Object(c.a)({},e,{positionsToStyle:k.list[parseInt(t.target.value)]})})}},k.list.map((function(e,t){return r.a.createElement("option",{key:t,value:t},e.description)})))))},n.renderSequenceLogo=function(){var e=n.state.logoPlotStyle;return r.a.createElement("div",null,r.a.createElement("label",null,r.a.createElement("strong",null,"Sequence Logo Style:"),r.a.createElement("select",{value:e,onChange:function(e){n.setState({logoPlotStyle:e.target.value})}},Object.values(F).map((function(e){return r.a.createElement("option",{key:e,value:e},e)})))))},n.renderZoomButtons=function(){var e=n.state.zoomLevel;return r.a.createElement("div",null,r.a.createElement("label",null,r.a.createElement("strong",null,"Character size:"),r.a.createElement("div",{className:"zoom-level"},r.a.createElement("button",{type:"button",disabled:e<3,onClick:function(t){n.setState({zoomLevel:e-1})}},"-"),e,r.a.createElement("button",{type:"button",disabled:e>15,onClick:function(t){n.setState({zoomLevel:e+1})}},"+"))))},n.renderFileUpload=function(){return r.a.createElement("div",null,r.a.createElement(pe,{labelText:"Upload Alignment File:",onFileLoadCb:n.onFileUpload}))},n.renderExampleLinks=function(){return r.a.createElement("div",{className:"examples"},r.a.createElement("label",null,r.a.createElement("strong",null,"Example Alignments:"),r.a.createElement(me,{labelText:"\u03b2-lactamase",fileURL:"".concat("/AlignmentViewer2.0","/7fa1c5691376beab198788a726917d48_b0.4.a2m"),fileName:"7fa1c5691376beab198788a726917d48_b0.4.a2m",onFileLoaded:n.onFileUpload,onStartLoading:function(){return n.setState({loading:!0})}})))},n.renderMiniMapToggle=function(){return r.a.createElement("div",{className:"minimap-toggle"},r.a.createElement("label",null,r.a.createElement("strong",null,"Show MiniMap:"),r.a.createElement("input",{name:"showMiniMap",type:"checkbox",checked:n.state.showMiniMap,onChange:function(e){var t=e.target;n.setState({showMiniMap:t.checked})}})))},n.renderAnnotationToggle=function(){return r.a.createElement("div",{className:"annotation-toggle"},r.a.createElement("label",null,r.a.createElement("strong",null,"Show Annotations:"),r.a.createElement("input",{name:"showAnnotations",type:"checkbox",checked:n.state.showAnnotations,onChange:function(e){var t=e.target;n.setState({showAnnotations:t.checked})}})))},n.onFileUpload=function(e){var t;return l.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:e&&(n.setState({loading:!0}),(t=new FileReader).onload=function(i){var r=t.result,a=U.fromFileContents(e.name,r);n.setState({alignment:a,style:a.getDefaultStyle(),loading:!1})},t.readAsText(e));case 1:case"end":return i.stop()}}))},n.state={style:new M,logoPlotStyle:F.LETTERS,zoomLevel:14,sortBy:R.INPUT,showMiniMap:!1,showAnnotations:!0,showSettings:!0},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.state,t=e.alignment,n=e.logoPlotStyle,i=e.showAnnotations,a=e.showMiniMap,o=e.sortBy,s=e.style,l=e.zoomLevel,c=t?r.a.createElement("div",{className:"av_holder"},r.a.createElement(de,{alignment:t,style:s,logoPlotStyle:n,zoomLevel:l,sortBy:o,showMiniMap:a,showAnnotations:i})):r.a.createElement(r.a.Fragment,null);return r.a.createElement("div",null,this.renderSettingsBox(s),c)}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(fe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},8:function(e,t,n){e.exports={acePrefix:"ace_",preAceQueryClass:"q",preAceConsensusClass:"c",aceQueryClass:"q",aceConsensusClass:"c",aceResidueParentClass:"ace_line",transparentLetterClass:"transparent-letters",transparentBackgroundClass:"transparent-background",aaAlignTypeClass:"alignment-aa",ntAlignTypeClass:"alignment-nt",styPosAllClass:"alignment-positions-tostyle-all",styPosQueryClass:"alignment-positions-tostyle-query",styPosQueryDiffClass:"alignment-positions-tostyle-query-diff",styPosConsensusClass:"alignment-positions-tostyle-consensus",styPosConsensusDiffClass:"alignment-positions-tostyle-consensus-diff",aaStyClass_Default:"aa-alignment-style-default",aaStyDesc_Default:"Default",aaStyBGAlpha_Default:".25",aaStyColorOrder_Default:"A,R,N,D,C,Q,E,G,H,I,L,K,M,F,P,S,T,W,Y,V",aaStyColors_Default:"#3c0,#c00,#60c,#03f,#ff0,#60c,#03f,#3c0,#090,#3c0,#3c0,#c00,#3c0,#090,#3c0,#09f,#09f,#090,#090,#3c0",aaStyClass_Hydrophobicity:"aa-alignment-style-hydrophobicity",aaStyDesc_Hydrophobicity:"Hydrophobicity",aaStyBGAlpha_Hydrophobicity:".25",aaStyColorOrder_Hydrophobicity:"F,I,W,L,V,M,Y,C,A,T,H,G,S,Q,R,K,N,E,P,D",aaStyColors_Hydrophobicity:"red,red,#ff0606,#ff0606,#ff4c4c,#ff5252,#f77,#ffa5a5,#ffc0c0,#e1e1ff,#d0d0ff,#b6b6ff,#a5a5ff,#9595ff,#8787ff,#6969ff,#5959ff,#4f4fff,#1d1dff,blue",ntStyClass_Default:"nt-alignment-style-default",ntStyDesc_Default:"Default",ntStyBGAlpha_Default:".25",ntStyColorOrder_Default:"A,C,G,T,U,R,Y",ntStyColors_Default:"#5050ff,#e00000,#00c000,#e6e600,#c90,#2e8b57,#ff8c00"}}},[[32,1,2]]]);
//# sourceMappingURL=main.c4ddd897.chunk.js.map