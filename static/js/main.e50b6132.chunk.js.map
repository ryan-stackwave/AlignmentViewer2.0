{"version":3,"sources":["common/Utils.ts","common/MolecularStyles.ts","common/AceAlignmentMode.ts","common/SequenceLogoGlyphs.tsx","common/Residues.ts","common/Alignment.ts","common/ScrollSync.ts","components/SequenceLogoComponent.tsx","components/SequenceConservationComponent.tsx","components/AlignmentCanvasComponent.tsx","components/MiniMapComponent.tsx","components/AceEditorComponent.tsx","components/AceMultipleSequenceAlignmentComponent.tsx","components/AceConsensusSequenceComponent.tsx","components/AceTargetSequenceComponent.tsx","components/AceTextualRulerComponent.tsx","components/AlignmentViewerComponent.tsx","components/FileInputComponent.tsx","components/ExampleFileComponent.tsx","App.tsx","serviceWorker.js","index.js","common/MolecularStyles.module.scss"],"names":["stringToColor","str","ctx","document","createElement","getContext","fillStyle","hex","replace","m","r","g","b","rgbaResult","exec","rgb","red","parseInt","green","blue","ALL_AMINOACID_COLORSCHEMES","assembleColorSchemes","ALL_NUCLEOTIDE_COLORSCHEMES","moleculeType","Object","keys","styles","reduce","acc","styleName","indexOf","colorSchemeName","split","colorOrder","hexValues","description","push","commonName","className","backgroundAlpha","parseFloat","colors","fromEntries","map","_","i","AlignmentTypes","key","allColorSchemes","list","find","at","AMINOACID","aaAlignTypeClass","NUCLEOTIDE","ntAlignTypeClass","PositionsToStyle","ALL","styPosAllClass","QUERY","styPosQueryClass","QUERY_DIFF","styPosQueryDiffClass","CONSENSUS","styPosConsensusClass","CONSENSUS_DIFF","styPosConsensusDiffClass","ResidueDetailTypes","BOTH","LETTER_ONLY","transparentBackgroundClass","BACKGROUND_ONLY","transparentLetterClass","AlignmentStyle","alignmentType","colorScheme","positionsToStyle","residueDetail","AminoAcidAlignmentStyle","NucleotideAlignmentStyle","acePrefix","getFinalLetterClassNames","letter","isConsensus","isQuery","all","aceLetterObjClass","consensus","aceConsensusClass","query","aceQueryClass","defineNewAlignmentMode","mode","alignment","modeSplit","length","Error","modeName","ace","define","require","exports","module","oop","TextHighlightRules","AlignmentHighlightRules","rules","stateName","nextStateName","getMaxSequenceLength","token","preAceLetterObjClass","preAceConsensusClass","preAceQueryClass","getLetterClassNamesForAce","getConsensus","getTargetSequence","sequence","regex","next","this","$rules","inherits","TextMode","Mode","Tokenizer","$tokenizer","getRules","call","prototype","GlyphFactory","letterToGlyphHM","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","singleton","props","d","transform","fill","cx","cy","stroke","strokeOpacity","fillOpacity","strokeWidth","AminoAcid","singleLetterCode","threeLetterCode","fullName","glyph","glyphFromChar","cs","colorPair","entries","aa","colorString","colorInfo","hexString","bySingleLetterCode","UNKNOWN","byThreeLetterCode","canonicalAminoAcids","DistanceFunctions","Nucleotide","allNucleotides","SequenceSortOptions","isTargetSequenceDependent","distanceFn","INPUT","HAMMING_DIST_TARGET","hamming","ScrollType","Alignment","name","sequencesAsInput","uuid","aceEditorMode","predictedNT","sequences","targetSequence","positionalLetterCounts","Map","globalAlphaLetterCounts","allAlphaLettersSorted","c","window","crypto","getRandomValues","Uint8Array","toString","set","start","Date","allLetters","sequenceIdx","seq","positionIdx","toUpperCase","letterIsAlpha","match","fromSingleLetterCode","position","letterCounts","get","sort","arr","value","Array","from","topLetter","currentLetter","occurrences","console","log","getTime","fileName","fileContents","fastaSplitCaret","seqArr","seqObj","id","slice","join","seq1","seq2","distFn","minLength","distance","validLetters","totalCounts","includes","isNaN","normalize","normalizeLetterCounts","getSequences","sortBy","forceReSort","has","sortByDistanceToTargetSequence","newTarget","undefined","forEach","inputSequences","s","getSequenceDistance","LOGO_TYPES","ScrollSync","_groupScrollpropsHM","_lastScrollerOffsets","_blockNextHorizontalScrollEvent","_blockNextVerticalScrollEvent","scroller","renderer","$getLongestLine","$padding","$size","scrollerWidth","scrolledScroller","groupName","newScrollValue","scrollDirection","_setScrollerLastOffsets","scrollers","siblingScroller","horizontal","session","getScrollLeft","setScrollLeft","vertical","getScrollTop","setScrollTop","scrollLeft","scrollTop","scrollType","scrolltype","dontErrorOnDuplicate","group","both","on","newScrollLeft","_handleScrollEvent","Math","round","e","onscroll","direction","target","lastLeft","SequenceLogoComponent","scrollerDiv","loaded","logoLoaded","nextProps","logoType","glyphWidth","getPositionalLetterCounts","lettersSorted","getSortedAlphaLetters","frequencies","totalCountAtPosition","total","frequenciesAtPosition","freq","sortedAlphabet","classNames","logoData","frequency","letterIdx","filter","a","totalWidth","ref","divLoaded","preserveAspectRatio","viewBox","style","width","height","xmlns","singlePositionData","positionalFrequencies","dy","idx","BARS","xscale","generateStack","React","Component","defaultProps","LETTERS","SequenceConservationComponent","state","isHovered","handleSvgHover","bind","setState","pk","qk","doLog","toReturn","backgroundLetterCounts","getGlobalAlphaLetterCounts","entropies","computeEntropy","maxEmpiricalEntropy","max","entropy","normalizedEntropy","maxSeqLength","numSequences","gapCounts","getGapsPerColumn","gapPercentage","conservationPlotLoaded","characterWidth","hoveredClass","backgroundColor","border","padding","top","right","color","visibility","zIndex","paddingLeft","onMouseEnter","onMouseLeave","createGapCountGs","createConservationCountGs","AlignmentHighlighter","PixiComponent","create","Graphics","applyProps","instance","x","y","fillColor","fillAlpha","clear","beginFill","drawRect","endFill","AlignmentCanvasComponent","app","scaleX","scaleY","renderAlignmentHighlighter","body","overflow","onWheel","newValue","xy","stage","children","sprite","scale","highlightRows","stageResolution","viewportProps","PIXI","skipHello","SCALE_MODE","NEAREST","options","transparent","Consumer","PixiViewport","numColumns","numRows","mouseDown","useDrag","usePinch","useWheel","zoomPercent","PixiAlignmentTiled","fullWidth","fullHeight","sizes","targetTileWidth","min","targetTileHeight","tiledImages","initializeTiledImages","tileYNumber","numYTiles","tileXNumber","numXTiles","tiledImage","generateCanvasForTile","tiles","tile","source","image","pixelX","pixelY","tileX","tileY","getName","tileImageData","tileCanvasContext","tileCanvas","offsets","imageDataIdx","seqIdx","seqY","letterX","getCurrentMoleculeColors","data","putImageData","lastTileHeight","lastTileWidth","fillRect","getImageData","colorCanvasWithSequence","consensusSequence","querySequence","moleculeClass","molecule","floor","vp","Viewport","screenWidth","screenHeight","worldWidth","worldHeight","interaction","plugins","decelerate","clamp","bounce","friction","time","underflow","clampZoom","maxHeight","maxWidth","drag","pinch","wheel","world","oldProps","newProps","fitWorld","setZoom","MiniMapComponent","renderCanvasComponent","size","getSizing","frameWidth","frameHeight","onMouseDown","onClick","borderWidth","margin","alignHorizontal","left","bottom","borderColor","borderStyle","AceEditorComponent","editor","lastText","lastMode","element","lastElementWidth","lastElementHeight","text","editorMode","el","edit","setShowPrintMargin","setReadOnly","setHighlightActiveLine","setHighlightGutterLine","setFontSize","fontSize","setShowGutter","setPadding","$cursorLayer","display","getMousePosition","event","pos","getDocumentPosition","screenCoordinates","textToScreenCoordinates","row","column","mouseRow","mouseColumn","mousePageX","pageX","mousePageY","pageY","mouseMove","getFontSize","characterSizeChanged","getEditorMode","newMode","setMode","getText","selectAll","removeLines","newText","insert","clientWidth","clientHeight","setupEditorAndEventListeners","addMouseEventListeners","setText","editorLoaded","resize","mouseEnter","mouseLeave","initialLoad","AceMultipleSequenceAlignmentComponent","getAceEditorMode","AceConsensusSequenceComponent","AceTargetSequenceComponent","AceTextualRulerComponent","generateTextualRuler","maxLength","sn","np","substr","logoPlotStyle","zoomLevel","showMiniMap","showAnnotations","AlignmentViewer","handleCharacterSizeChanged","newCharSize","aceCharacterWidth","aceEditorLoaded","scrollSyncDirection","scrollSync","getInstance","registerScroller","aceEditors","concat","setTimeout","alignmentEditorVisibleFirstRow","getFirstFullyVisibleRow","alignmentEditorVisibleLastRow","getLastFullyVisibleRow","windowDimensionsUpdated","windowWidth","innerWidth","windowHeight","innerHeight","renderSequenceLogo","renderConservationBox","renderConsensusQueryBox","renderQuerySeqBox","renderPositionBox","renderAlignmentBox","renderAlignmentAnnotationBox","onMinimapClick","alignmentEditorFirstRow","alignmentEditorLastRow","rowCount","scrollToRow","setScrollerGroup","annotation","content","addAsElementToScrollSync","addEventListener","removeEventListener","annotationClass","renderMiniMap","generateWidget","mmClassName","FileInputComponent","fileInput","handleSubmit","onFileLoadCb","preventDefault","current","files","labelText","type","onInput","ExampleFileComponent","fileURL","onStartLoading","onFileLoaded","async","File","fetch","blob","f","App","renderSettingsBox","alignmentDescription","showSettings","renderAlignmentTypeLabel","renderSortControl","renderColorScheme","renderResidueDetail","renderPositionStyling","renderZoomButtons","renderMiniMapToggle","renderAnnotationToggle","renderFileUpload","renderExampleLinks","loading","onChange","fromKey","sso","fromAlignmentType","index","rd","pts","values","disabled","onFileUpload","process","checked","file","reader","FileReader","onload","fileText","result","fromFileContents","getPredictedType","readAsText","alignmentElement","Boolean","location","hostname","ReactDOM","render","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.e50b6132.chunk.js","sourcesContent":["/**\n * Convert any valid color string into a hex code and RGB\n * value using the built in browser converter.\n * taken from\n * https://stackoverflow.com/questions/1573053/\n * and\n * https://stackoverflow.com/questions/5623838/\n * @param str The string to convert\n * @returns An object that contains the hex and rgb values for that string\n *          Default to black (#000000) if the string is not recognized.\n */\nexport function stringToColor(\n  str: string\n): {\n  hex: string;\n  rgb: { red: number; green: number; blue: number };\n} {\n  const ctx = document.createElement(\"canvas\").getContext(\"2d\");\n  ctx!.fillStyle = str;\n  let hex = ctx!.fillStyle!;\n\n  // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\n  // https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\n  // (I think only necessary in testing, but might catch odd browser behavior)\n  var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n  hex = hex.replace(shorthandRegex, function (m, r, g, b) {\n    return \"#\" + r + r + g + g + b + b;\n  });\n\n  var rgbaResult = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex)!;\n  return {\n    hex: hex,\n    rgb: {\n      red: parseInt(rgbaResult[1], 16),\n      green: parseInt(rgbaResult[2], 16),\n      blue: parseInt(rgbaResult[3], 16),\n    },\n  };\n}\n\n/**\n * Generate a UUID. Modified from:\n * https://stackoverflow.com/questions/105034\n */\nexport function generateUUIDv4() {\n  const x = (([1e7] as any) + -1e3 + -4e3 + -8e3 + -1e11) as string;\n  return x.replace(/[018]/g, function (c: string) {\n    return (\n      parseInt(c) ^\n      (window.crypto.getRandomValues(new Uint8Array(1))[0] &\n        (15 >> (parseInt(c) / 4)))\n    ).toString(16);\n  });\n}\n","/**\n * This file centralizes the location of javascript style definitions\n * for nucleotide and amino acid styles.\n */\nimport styles from \"./MolecularStyles.module.scss\";\n//console.log(\"STYLES AS INPUT ::::: \", styles);\n\n/**\n * Defines a single color scheme interface which consists of\n * a name, className, background alpha, and set of colors for\n * all residues (hex string format).\n *\n * @export\n * @interface IColorScheme\n */\nexport interface IColorScheme {\n  commonName: string;\n  description: string;\n  backgroundAlpha: number;\n  className: string;\n  colors: {\n    [residueCode: string]: string;\n  };\n}\n\nexport const ALL_AMINOACID_COLORSCHEMES = assembleColorSchemes(\"aa\");\nexport const ALL_NUCLEOTIDE_COLORSCHEMES = assembleColorSchemes(\"nt\");\n\n/**\n * Read in class names and colors for amino acid or nucleotide\n * color schemes from the scss file.\n *\n * @param {(\"aa\" | \"nt\")} moleculeType\n * @returns\n */\nfunction assembleColorSchemes(moleculeType: \"aa\" | \"nt\") {\n  return Object.keys(styles).reduce((acc, styleName) => {\n    if (styleName.indexOf(moleculeType + \"StyClass_\") !== -1) {\n      const colorSchemeName = styleName.split(moleculeType + \"StyClass_\")[1];\n      const colorOrder = styles[\n        moleculeType + \"StyColorOrder_\" + colorSchemeName\n      ]\n        .replace(/ /g, \"\")\n        .split(\",\"); // \"build\" removes spaces, but local \"run\" does not\n      const hexValues = styles[moleculeType + \"StyColors_\" + colorSchemeName]\n        .replace(/ /g, \"\")\n        .split(\",\"); // \"build\" removes spaces, but local \"run\" does not\n      const description = styles[moleculeType + \"StyDesc_\" + colorSchemeName];\n      acc.push({\n        commonName: colorSchemeName,\n        description: description,\n        className: styles[styleName],\n        backgroundAlpha: parseFloat(\n          styles[moleculeType + \"StyBGAlpha_\" + colorSchemeName]\n        ),\n        colors: Object.fromEntries(\n          colorOrder.map((_, i) => [colorOrder[i], hexValues[i]])\n        ),\n      });\n    }\n    return acc;\n  }, [] as IColorScheme[]);\n}\n\n/**\n * Top level alignment type descriptions. There are two supported\n * alignment types: AMINOACID and NUCLEOTIDE.\n *\n * @export\n * @class AlignmentTypes\n */\nexport class AlignmentTypes {\n  static readonly AMINOACID = new AlignmentTypes(\n    \"aminoacid-alignment\",\n    \"Amino Acid Sequences\",\n    styles.aaAlignTypeClass,\n    ALL_AMINOACID_COLORSCHEMES\n  );\n  static readonly NUCLEOTIDE = new AlignmentTypes(\n    \"nucleotide-alignment\",\n    \"Nucleotide Sequences\",\n    styles.ntAlignTypeClass,\n    ALL_NUCLEOTIDE_COLORSCHEMES\n  );\n\n  static list = [AlignmentTypes.AMINOACID, AlignmentTypes.NUCLEOTIDE];\n\n  static fromKey(key: string) {\n    return AlignmentTypes.list.find((at) => {\n      return at.key === key;\n    });\n  }\n\n  private constructor(\n    public readonly key: string,\n    public readonly description: string,\n    public readonly className: string,\n    public readonly allColorSchemes: IColorScheme[]\n  ) {}\n}\n\n/**\n * This class represents different position styling modes.\n *\n * @export\n * @class PositionsToStyle\n */\nexport class PositionsToStyle {\n  static readonly ALL = new PositionsToStyle(\n    \"all\",\n    \"All\",\n    styles.styPosAllClass\n  );\n  static readonly QUERY = new PositionsToStyle(\n    \"query\",\n    \"Same as Query\",\n    styles.styPosQueryClass\n  );\n  static readonly QUERY_DIFF = new PositionsToStyle(\n    \"query-diff\",\n    \"Different from Query\",\n    styles.styPosQueryDiffClass\n  );\n  static readonly CONSENSUS = new PositionsToStyle(\n    \"consensus\",\n    \"Same as Consensus\",\n    styles.styPosConsensusClass\n  );\n  static readonly CONSENSUS_DIFF = new PositionsToStyle(\n    \"consensus-diff\",\n    \"Different from Consensus\",\n    styles.styPosConsensusDiffClass\n  );\n\n  static list = [\n    PositionsToStyle.ALL,\n    PositionsToStyle.QUERY,\n    PositionsToStyle.QUERY_DIFF,\n    PositionsToStyle.CONSENSUS,\n    PositionsToStyle.CONSENSUS_DIFF,\n  ];\n\n  static fromKey(key: string) {\n    return PositionsToStyle.list.find((at) => {\n      return at.key === key;\n    });\n  }\n\n  // private to disallow creating other instances of this type\n  private constructor(\n    public readonly key: string,\n    public readonly description: string,\n    public readonly className: string\n  ) {}\n}\n\nexport class ResidueDetailTypes {\n  static readonly BOTH = new ResidueDetailTypes(\n    \"both\",\n    \"Style Background and Letters\",\n    \"\"\n  );\n  static readonly LETTER_ONLY = new ResidueDetailTypes(\n    \"letter-only\",\n    \"Only Style Letters\",\n    styles.transparentBackgroundClass\n  );\n  static readonly BACKGROUND_ONLY = new ResidueDetailTypes(\n    \"background-only\",\n    \"Only Style Background\",\n    styles.transparentLetterClass\n  );\n\n  static list = [\n    ResidueDetailTypes.BOTH,\n    ResidueDetailTypes.LETTER_ONLY,\n    ResidueDetailTypes.BACKGROUND_ONLY,\n  ];\n\n  static fromKey(key: string) {\n    return ResidueDetailTypes.list.find((at) => {\n      return at.key === key;\n    });\n  }\n\n  private constructor(\n    public readonly key: string,\n    public readonly description: string,\n    public readonly className: string\n  ) {}\n}\n\n/**\n * Object to describe the style of a set of sequences (MSA, logo, etc).\n * Contains 2 key parameters:\n *     \"alignmentType\": should be set by implementing classes\n *     \"colorScheme\": describes the color scheme to apply to the alignment.\n *                    defaults to the first available from the scss file\n *     \"positionsToStyle\": description of which positions should be styled.\n *                         defaults to all positions.\n *\n * @interface AlignmentStyle\n */\nexport abstract class AlignmentStyle {\n  abstract readonly alignmentType: AlignmentTypes;\n  abstract colorScheme: IColorScheme;\n  abstract positionsToStyle: PositionsToStyle;\n  abstract residueDetail: ResidueDetailTypes;\n\n  static fromAlignmentType(alignmentType: AlignmentTypes) {\n    if (alignmentType === AlignmentTypes.AMINOACID)\n      return new AminoAcidAlignmentStyle();\n    return new NucleotideAlignmentStyle();\n  }\n}\n\n/**\n * Object to describe an amino acid alignment style\n * @class AminoAcidAlignmentStyle\n * @implements {AlignmentStyle}\n */\nexport class AminoAcidAlignmentStyle implements AlignmentStyle {\n  readonly allColorSchemes = ALL_AMINOACID_COLORSCHEMES;\n  readonly alignmentType = AlignmentTypes.AMINOACID;\n\n  constructor(\n    public colorScheme: IColorScheme = ALL_AMINOACID_COLORSCHEMES[0],\n    public positionsToStyle: PositionsToStyle = PositionsToStyle.ALL,\n    public residueDetail: ResidueDetailTypes = ResidueDetailTypes.BOTH\n  ) {}\n}\n\n/**\n * Object to describe an nucleotide alignment style\n *\n * @export\n * @class NucleotideAlignmentStyle\n * @implements {AlignmentStyle}\n */\nexport class NucleotideAlignmentStyle implements AlignmentStyle {\n  readonly allColorSchemes = ALL_NUCLEOTIDE_COLORSCHEMES;\n  readonly alignmentType = AlignmentTypes.NUCLEOTIDE;\n\n  constructor(\n    public colorScheme: IColorScheme = ALL_NUCLEOTIDE_COLORSCHEMES[0],\n    public positionsToStyle: PositionsToStyle = PositionsToStyle.ALL,\n    public residueDetail: ResidueDetailTypes = ResidueDetailTypes.BOTH\n  ) {}\n}\n\n/**\n * Export globals\n */\nconst transparentLetterClass = styles.transparentLetterClass;\nconst transparentBackgroundClass = styles.transparentBackgroundClass;\nexport { transparentBackgroundClass, transparentLetterClass };\n\n/**\n * Export ace helper parameters and functions.\n */\n/**\n * Export a class name array that is used by the ace editor\n * mode to fill class names for each letter. The structure\n * of this string is just the list of class names, separated\n * by a period. Ace subsequently prepends ace_ to each value\n * when adding the classes to the editor.\n * @param letter\n * @param isConsensus\n * @param isQuery\n */\nexport function getLetterClassNamesForAce(\n  letter: string,\n  isConsensus: boolean,\n  isQuery: boolean\n) {\n  const all = \".\" + styles.preAceLetterObjClass;\n  const consensus = isConsensus ? \".\" + styles.preAceConsensusClass : \"\";\n  const query = isQuery ? \".\" + styles.preAceQueryClass : \"\";\n\n  return letter + all + consensus + query;\n}\n\nconst acePrefix = styles.acePrefix;\n/**\n * Get letter class names that have the final ace_ prepended\n * classnames.\n * @param letter\n * @param isConsensus\n * @param isQuery\n */\nexport function getFinalLetterClassNames(\n  letter: string,\n  isConsensus: boolean,\n  isQuery: boolean\n) {\n  const all = \" \" + styles.aceLetterObjClass;\n  const consensus = isConsensus ? \" \" + styles.aceConsensusClass : \"\";\n  const query = isQuery ? \" \" + styles.aceQueryClass : \"\";\n\n  return styles.acePrefix + letter + all + consensus + query;\n}\n","/**\n * AceAlignmentMode.js\n * This file defines an alignment highlight mode form ace editor documents.\n */\n\nimport { default as ace } from \"ace-builds\";\nimport { Alignment } from \"./Alignment\";\nimport { getLetterClassNamesForAce } from \"./MolecularStyles\";\n\ninterface IAceType {\n  [key: string]: any;\n}\n\nexport function defineNewAlignmentMode(mode: string, alignment: Alignment) {\n  const modeSplit = mode.split(\"/\");\n  if (\n    modeSplit.length !== 3 ||\n    modeSplit[0] !== \"ace\" ||\n    modeSplit[1] !== \"mode\"\n  ) {\n    throw Error(\"ace mode name must be of the form '/ace/mode/MODENAME'\");\n  }\n  const modeName = mode.split(\"/\")[2];\n\n  (ace as IAceType).define(\n    \"ace/mode/\" + modeName + \"_highlight_rules\",\n    function (require: Function, exports: any, module: any) {\n      var oop = require(\"../lib/oop\");\n      var TextHighlightRules = require(\"./text_highlight_rules\")\n        .TextHighlightRules;\n\n      /**\n       * Rules parse individual characters in the editor and assign classes\n       * to each character. Note that characters may be grouped together\n       * if they match the same rule and are side by side.\n       */\n      var AlignmentHighlightRules = function (this: any) {\n        //We define an alignment-specific set of rules that will\n        //add other tags such as whether a character matches the\n        //consensus sequence.\n        let rules: {\n          [key: string]: {\n            token: (letter: string) => void;\n            regex: string;\n            next: string;\n          }[];\n        } = {};\n\n        for (let i = 0; i < alignment.getMaxSequenceLength(); i++) {\n          const stateName = i === 0 ? \"start\" : \"pos\" + i;\n          const nextStateName =\n            i === alignment.getMaxSequenceLength() - 1\n              ? \"start\"\n              : \"pos\" + (i + 1);\n\n          rules[stateName] = [\n            {\n              token: function (letter: string) {\n                return getLetterClassNamesForAce(\n                  letter,\n                  letter === alignment.getConsensus()[i].letter,\n                  letter === alignment.getTargetSequence().sequence[i]\n                );\n              },\n              regex: \".\",\n              next: nextStateName,\n            },\n          ];\n        }\n        this.$rules = rules;\n      };\n\n      oop.inherits(AlignmentHighlightRules, TextHighlightRules);\n\n      exports.AlignmentHighlightRules = AlignmentHighlightRules;\n    }\n  );\n\n  (ace as IAceType).define(\"ace/mode/\" + modeName, function (\n    require: Function,\n    exports: any,\n    module: any\n  ) {\n    var oop = require(\"../lib/oop\");\n    var TextMode = require(\"../mode/text\").Mode;\n    var Tokenizer = require(\"../tokenizer\").Tokenizer;\n    var AlignmentHighlightRules = require(\"ace/mode/\" +\n      modeName +\n      \"_highlight_rules\").AlignmentHighlightRules;\n\n    const Mode = function (this: any) {\n      this.$tokenizer = new Tokenizer(new AlignmentHighlightRules().getRules());\n    };\n\n    oop.inherits(Mode, TextMode);\n\n    (function () {\n      // Extra logic goes here. (see below)\n    }.call(Mode.prototype));\n\n    exports.Mode = Mode;\n  });\n}\n","/**\n *\n * Glyph definitions for the logo component.\n * Inspired / derived from https://github.com/weng-lab/logojs-package\n *\n */\nimport React from \"react\";\n\nexport class GlyphFactory {\n  private static singleton: undefined | GlyphFactory;\n\n  private letterToGlyphHM: {\n    [key: string]: (props: { [key: string]: string }) => JSX.Element;\n  } = {\n    A: GlyphFactory.A,\n    B: GlyphFactory.B,\n    C: GlyphFactory.C,\n    D: GlyphFactory.D,\n    E: GlyphFactory.E,\n    F: GlyphFactory.F,\n    G: GlyphFactory.G,\n    H: GlyphFactory.H,\n    I: GlyphFactory.I,\n    J: GlyphFactory.J,\n    K: GlyphFactory.K,\n    L: GlyphFactory.L,\n    M: GlyphFactory.M,\n    N: GlyphFactory.N,\n    O: GlyphFactory.O,\n    P: GlyphFactory.P,\n    Q: GlyphFactory.Q,\n    R: GlyphFactory.R,\n    S: GlyphFactory.S,\n    T: GlyphFactory.T,\n    U: GlyphFactory.U,\n    V: GlyphFactory.V,\n    W: GlyphFactory.W,\n    X: GlyphFactory.X,\n    Y: GlyphFactory.Y,\n    Z: GlyphFactory.Z\n  };\n\n  static glyphFromChar(letter: string) {\n    if (!GlyphFactory.singleton) {\n      GlyphFactory.singleton = new GlyphFactory();\n    }\n    return GlyphFactory.singleton.letterToGlyphHM[letter];\n  }\n\n  private static A = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <path\n        {...props}\n        d=\"M 0 100 L 33 0 L 66 0 L 100 100 L 75 100 L 66 75 L 33 75 L 25 100 L 0 100\"\n      />\n      <path\n        key={props.key + \"_p2\"}\n        transform={props.transform}\n        fill=\"#ffffff\"\n        d=\"M 41 55 L 50 25 L 58 55 L 41 55\"\n      />\n    </g>\n  );\n\n  private static B = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <path\n        {...props}\n        d=\"M 0 0 L 80 0 C 105 0 105 50 80 50 C 105 50 105 100 80 100 L 00 100 L 0 0\"\n      />\n      <path\n        key={props.key + \"_p2\"}\n        transform={props.transform}\n        d=\"M 20 15 L 70 15 C 80 15 80 35 70 35 L 20 35 L 20 15\"\n        fill=\"#ffffff\"\n      />\n      <path\n        key={props.key + \"_p3\"}\n        transform={props.transform}\n        d=\"M 20 65 L 70 65 C 80 65 80 85 70 85 L 20 85 L 20 65\"\n        fill=\"#ffffff\"\n      />\n    </g>\n  );\n\n  private static C = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 100 28 C 100 -13 0 -13 0 50\n      C 0 113 100 113 100 72 L 75 72\n      C 75 90 30 90 30 50 C 30 10 75 10 75 28\n      L 100 28\"\n    />\n  );\n\n  private static D = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <path {...props} d=\"M 0 0 L 60 0 C 110 0 110 100 60 100 L 0 100 L 0 0\" />\n      <path\n        key={props.key + \"_p2\"}\n        transform={props.transform}\n        fill=\"#ffffff\"\n        d=\"M 20 15 L 40 15 C 85 15 85 85 40 85 L 20 85 L 20 15\"\n      />\n    </g>\n  );\n\n  private static E = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 100 0 L 100 20 L 20 20 L 20 40 L 90 40 L 90 60 L 20 60 L 20 80 L 100 80 L 100 100 L 0 100 L 0 0\"\n    />\n  );\n\n  private static F = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 100 0 L 100 20 L 20 20 L 20 40 L 80 40 L 80 60 L 20 60 L 20 100 L 0 100 L 0 0\"\n    />\n  );\n\n  private static G = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 100 28 C 100 -13 0 -13 0 50 C 0 113 100 113 100 72 L 100 48 L 55 48 L 55 72 L 75 72 C 75 90 30 90 30 50 C 30 10 75 5 75 28 L 100 28\"\n    />\n  );\n\n  private static H = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 20 40 L 80 40 L 80 0 L 100 0 L 100 100 L 80 100 L 80 60 L 20 60 L 20 100 L 0 100 L 0 0\"\n    />\n  );\n\n  private static I = (props: { [key: string]: string }) => (\n    <path {...props} d=\"M 40 0 L 60 0 L 60 100 L 40 100 L 40 0\" />\n  );\n\n  private static J = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 60 C 0 111 100 111 100 60 L 100 0 L 75 0 L 75 60 C 80 90 20 90 25 60\"\n    />\n  );\n\n  private static K = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 20 40 L 75 0 L 100 0 L 50 50 L 100 100 L 75 100 L 30 65 L 20 75 L 20 100 L 0 100 L 0 0\"\n    />\n  );\n\n  private static L = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 0 100 L 100 100 L 100 80 L 20 80 L 20 0 L 0 0\"\n    />\n  );\n\n  private static M = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 50 35 L 80 0 L 100 0 L 100 100 L 80 100 L 80 30 L 50 65 L 20 30 L 20 100 L 0 100 L 0 0\"\n    />\n  );\n\n  private static N = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 100 L 0 0 L 20 0 L 80 75 L 80 0 L 100 0 L 100 100 L 80 100 L 20 25 L 20 100 L 0 100\"\n    />\n  );\n\n  private static O = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <circle cx=\"50\" cy=\"50\" r=\"50\" {...props} />\n      <circle\n        key={props.key + \"_c2\"}\n        transform={props.transform}\n        cx=\"50\"\n        cy=\"50\"\n        r=\"32\"\n        fill=\"#ffffff\"\n      />\n    </g>\n  );\n\n  private static P = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <path\n        {...props}\n        d=\"M 0 0 L 80 0 C 105 0 105 50 80 50 L 20 50 L 20 100 L 0 100 L 0 0\"\n      />\n      <path\n        key={props.key + \"_p2\"}\n        transform={props.transform}\n        fill=\"#ffffff\"\n        d=\"M 20 15 L 70 15 C 80 15 80 35 70 35 L 20 35 L 20 15\"\n      />\n    </g>\n  );\n\n  private static Q = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <circle\n        cx=\"50\"\n        cy=\"50\"\n        r=\"50\"\n        {...{ ...props, key: props.key + \"_c1\" }}\n      />\n      <circle\n        key={props.key + \"_c2\"}\n        transform={props.transform}\n        cx=\"50\"\n        cy=\"50\"\n        r=\"32\"\n        fill=\"#ffffff\"\n      />\n      <path d=\"M 85 100 L 55 70 L 70 55 L 100 85 L 85 100\" {...props} />\n    </g>\n  );\n\n  private static R = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <path\n        {...props}\n        d=\"M 0 0 L 80 0 C 105 0 105 50 80 50 C 100 50 100 70 100 70 L 100 100 L 80 100 L 80 80 C 80 80 80 60 50 60 L 20 60 L 20 100 L 0 100 L 0 0\"\n      />\n      <path\n        key={props.key + \"_p2\"}\n        transform={props.transform}\n        fill=\"#ffffff\"\n        d=\"M 20 15 L 70 15 C 80 15 80 35 70 35 L 20 35 L 20 15\"\n      />\n    </g>\n  );\n\n  /**\n   *NOTE: Requires \"stroke\" and \"strokeOpacity\" instead of just the fill prop.\n   */\n  private static S = (props: { [key: string]: string }) => {\n    if (!props.stroke) {\n      props.stroke = props.fill;\n    }\n    if (!props.strokeOpacity) {\n      props.strokeOpacity = props.fillOpacity;\n    }\n\n    return (\n      <path\n        fill=\"#ffffff\"\n        {...props}\n        strokeWidth=\"18\"\n        d=\"M92 26 A43 20 0 1 0 43 46 A42 23 0 1 1 9 68\"\n      />\n    );\n  };\n\n  private static T = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 0 20 L 35 20 L 35 100 L 65 100 L 65 20 L 100 20 L 100 0 L 0 0\"\n    />\n  );\n\n  private static U = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 0 60 C 0 111 100 111 100 60 L 100 0 L 75 0 L 75 60 C 80 90 20 90 25 60 L 25 0 L 0 0\"\n    />\n  );\n\n  private static V = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 50 80 L 80 0 L 100 0 L 60 100 L 40 100 L 0 0\"\n    />\n  );\n\n  private static W = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 30 70 L 50 30 L 70 70 L 80 0 L 100 0 L 90 100 L 70 100 L 50 65 L 30 100 L 10 100 L 0 0\"\n    />\n  );\n\n  private static X = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 50 40 L 80 0 L 100 0 L 70 50 L 100 100 L 80 100 L 50 60 L 20 100 L 0 100 L 30 50 L 0 0\"\n    />\n  );\n\n  private static Y = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 50 45 L 80 0 L 100 0 L 60 60 L 60 100 L 40 100 L 40 60 L 0 0\"\n    />\n  );\n\n  private static Z = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 100 0 L 100 20 L 35 80 L 100 80 L 100 100 L 0 100 L 0 80 L 65 20 L 0 20 L 0 0\"\n    />\n  );\n}\n","import { GlyphFactory } from \"./SequenceLogoGlyphs\";\nimport { stringToColor } from \"./Utils\";\nimport {\n  ALL_AMINOACID_COLORSCHEMES,\n  ALL_NUCLEOTIDE_COLORSCHEMES\n} from \"./MolecularStyles\";\n\ninterface IResidueColor {\n  [colorScheme: string]: {\n    hexString: string;\n    rgb: {\n      red: number;\n      green: number;\n      blue: number;\n    };\n    backgroundAlpha: number;\n  };\n}\n\ninterface IAminoAcid {\n  singleLetterCode: string;\n  threeLetterCode: string;\n  fullName: string;\n  glyph: (props: { [key: string]: string }) => JSX.Element;\n  colors: IResidueColor;\n}\n\ninterface INucleotide {\n  singleLetterCode: string;\n  fullName: string;\n  glyph: (props: { [key: string]: string }) => JSX.Element;\n  colors: IResidueColor;\n}\n\nexport class AminoAcid implements IAminoAcid {\n  glyph: (props: { [key: string]: string }) => JSX.Element;\n  colors: IResidueColor;\n\n  public static readonly canonicalAminoAcids: AminoAcid[] = [\n    new AminoAcid(\"A\", \"ALA\", \"Alanine\"),\n    new AminoAcid(\"R\", \"ARG\", \"Arginine\"),\n    new AminoAcid(\"N\", \"ASN\", \"Asparagine\"),\n    new AminoAcid(\"D\", \"ASP\", \"Aspartic Acid\"),\n    new AminoAcid(\"C\", \"CYS\", \"Cysteine\"),\n    new AminoAcid(\"Q\", \"GLU\", \"Glutamine\"),\n    new AminoAcid(\"E\", \"GLN\", \"Glutamic Acid\"),\n    new AminoAcid(\"G\", \"GLY\", \"Glycine\"),\n    new AminoAcid(\"H\", \"HIS\", \"Histidine\"),\n    new AminoAcid(\"I\", \"ILE\", \"Isoleucine\"),\n    new AminoAcid(\"L\", \"LEU\", \"Leucine\"),\n    new AminoAcid(\"K\", \"LYS\", \"Lysine\"),\n    new AminoAcid(\"M\", \"MET\", \"Methionine\"),\n    new AminoAcid(\"F\", \"PHE\", \"Phenylalanine\"),\n    new AminoAcid(\"P\", \"PRO\", \"Proline\"),\n    new AminoAcid(\"S\", \"SER\", \"Serine\"),\n    new AminoAcid(\"T\", \"THR\", \"Threonine\"),\n    new AminoAcid(\"W\", \"TRP\", \"Tryptophan\"),\n    new AminoAcid(\"Y\", \"TYR\", \"Tyrosine\"),\n    new AminoAcid(\"V\", \"VAL\", \"Valine\"),\n\n    new AminoAcid(\"X\", \"UKN\", \"Unknown Amino Acid\")\n  ];\n\n  private static bySingleLetterCode = AminoAcid.canonicalAminoAcids.reduce(\n    (acc, aa) => {\n      acc[aa.singleLetterCode] = aa;\n      return acc;\n    },\n    {} as { [key: string]: AminoAcid }\n  );\n\n  private static byThreeLetterCode = AminoAcid.canonicalAminoAcids.reduce(\n    (acc, aa) => {\n      acc[aa.threeLetterCode] = aa;\n      return acc;\n    },\n    {} as { [key: string]: AminoAcid }\n  );\n\n  public static readonly UNKNOWN = AminoAcid.bySingleLetterCode[\"X\"];\n\n  static fromSingleLetterCode(singleLetterCode: string): IAminoAcid {\n    if (singleLetterCode in this.bySingleLetterCode) {\n      return AminoAcid.bySingleLetterCode[singleLetterCode];\n    }\n    return AminoAcid.UNKNOWN;\n  }\n\n  static fromThreeLetterCode(threeLetterCode: string): IAminoAcid {\n    if (threeLetterCode in this.byThreeLetterCode) {\n      return AminoAcid.byThreeLetterCode[threeLetterCode];\n    }\n    return AminoAcid.UNKNOWN;\n  }\n\n  constructor(\n    public singleLetterCode: string,\n    public threeLetterCode: string,\n    public fullName: string\n  ) {\n    this.singleLetterCode = singleLetterCode;\n    this.threeLetterCode = threeLetterCode;\n    this.fullName = fullName;\n    this.glyph = GlyphFactory.glyphFromChar(singleLetterCode);\n    this.colors = ALL_AMINOACID_COLORSCHEMES.reduce((acc, cs) => {\n      const colorPair = Object.entries(cs.colors).find(([aa, color]) => {\n        if (aa === singleLetterCode) {\n          return true;\n        }\n        return false;\n      });\n\n      let colorString = \"#ffffff\";\n      if (colorPair) {\n        colorString = colorPair[1];\n      }\n      const colorInfo = stringToColor(colorString);\n      acc[cs.commonName] = {\n        hexString: colorInfo.hex,\n        rgb: colorInfo.rgb,\n        backgroundAlpha: cs.backgroundAlpha\n      };\n      return acc;\n    }, {} as IResidueColor);\n  }\n}\n\nexport class Nucleotide implements INucleotide {\n  glyph: (props: { [key: string]: string }) => JSX.Element;\n  colors: IResidueColor;\n\n  static allNucleotides: Nucleotide[] = [\n    new Nucleotide(\"A\", \"Adenine\"),\n    new Nucleotide(\"C\", \"Cytosine\"),\n    new Nucleotide(\"G\", \"Guanine\"),\n    new Nucleotide(\"T\", \"Thymidine\"),\n    new Nucleotide(\"U\", \"Uracil\"),\n\n    new Nucleotide(\"R\", \"Purine\"),\n    new Nucleotide(\"Y\", \"Pyrimidine\"),\n\n    new Nucleotide(\"X\", \"Unknown Nucleotide\")\n  ];\n\n  private static bySingleLetterCode = Nucleotide.allNucleotides.reduce(\n    (acc, aa) => {\n      acc[aa.singleLetterCode] = aa;\n      return acc;\n    },\n    {} as { [key: string]: Nucleotide }\n  );\n\n  public static UNKNOWN = Nucleotide.bySingleLetterCode[\"X\"];\n\n  static fromSingleLetterCode(singleLetterCode: string): Nucleotide {\n    if (singleLetterCode in this.bySingleLetterCode) {\n      return Nucleotide.bySingleLetterCode[singleLetterCode];\n    }\n    return Nucleotide.UNKNOWN;\n  }\n\n  constructor(public singleLetterCode: string, public fullName: string) {\n    this.singleLetterCode = singleLetterCode;\n    this.fullName = fullName;\n    this.glyph = GlyphFactory.glyphFromChar(singleLetterCode);\n    this.colors = ALL_NUCLEOTIDE_COLORSCHEMES.reduce((acc, cs) => {\n      const colorPair = Object.entries(cs.colors).find(([aa, color]) => {\n        if (aa === singleLetterCode) {\n          return true;\n        }\n        return false;\n      });\n\n      let colorString = \"#ffffff\";\n      if (colorPair) {\n        colorString = colorPair[1];\n      }\n      const colorInfo = stringToColor(colorString);\n      acc[cs.commonName] = {\n        hexString: colorInfo.hex,\n        rgb: colorInfo.rgb,\n        backgroundAlpha: cs.backgroundAlpha\n      };\n      return acc;\n    }, {} as IResidueColor);\n  }\n}\n","import { generateUUIDv4 } from \"./Utils\";\nimport { defineNewAlignmentMode } from \"./AceAlignmentMode\";\nimport { Nucleotide } from \"./Residues\";\nimport { AlignmentTypes } from \"./MolecularStyles\";\n\nexport interface ISequence {\n  id: string;\n  sequence: string;\n}\n\nenum DistanceFunctions {\n  \"hamming\",\n}\nexport class SequenceSortOptions {\n  static readonly INPUT = new SequenceSortOptions(\n    \"as-input\",\n    \"As input\",\n    false\n  );\n  static readonly HAMMING_DIST_TARGET = new SequenceSortOptions(\n    \"hamming-dist-to-target\",\n    \"Hamming distance to target sequence\",\n    true,\n    DistanceFunctions.hamming\n  );\n\n  static list = [\n    SequenceSortOptions.INPUT,\n    SequenceSortOptions.HAMMING_DIST_TARGET,\n  ];\n\n  static fromKey(key: string) {\n    return SequenceSortOptions.list.find((at) => {\n      return at.key === key;\n    });\n  }\n\n  private constructor(\n    public readonly key: string,\n    public readonly description: string,\n    public readonly isTargetSequenceDependent: boolean,\n    public readonly distanceFn?: DistanceFunctions\n  ) {}\n}\n\n/**\n * Alignment\n * This class represents a multiple sequence alignment. During initialization,\n * positional statistics are generated about the alignment and a consensus\n * sequence is determined.\n *\n * The class should be instantiated using the static methods:\n *     fromFileContents: accepts a fasta file-like string\n */\nexport class Alignment {\n  private uuid: string;\n  private aceEditorMode: string | undefined;\n  private name: string;\n  private predictedNT: boolean;\n  private sequences: Map<SequenceSortOptions, ISequence[]>;\n  private targetSequence: ISequence;\n  private positionalLetterCounts = new Map<\n    number,\n    { [letter: string]: number }\n  >();\n  private globalAlphaLetterCounts: { [letter: string]: number } = {};\n  private allAlphaLettersSorted: string[];\n  private consensus: {\n    letter: string;\n    position: number;\n    occurrences: number;\n  }[] = [];\n\n  /**\n   * Create and return a new Alignment object from a fasta-type file\n   * @param fileContents the multiple sequence alignment fasta file as a string\n   */\n  static fromFileContents(fileName: string, fileContents: string): Alignment {\n    const fastaSplitCaret = fileContents.split(\">\");\n    var sequences: ISequence[] = [];\n    for (var i = 0; i < fastaSplitCaret.length; i++) {\n      const seqArr = fastaSplitCaret[i].split(/\\r?\\n/);\n      if (seqArr.length > 1) {\n        var seqObj = {\n          id: seqArr[0],\n          sequence: seqArr.slice(1).join(\"\"),\n        };\n        sequences.push(seqObj);\n      }\n    }\n    return new Alignment(fileName, sequences);\n  }\n\n  /**\n   * Determine the distance between two sequences\n   * @param seq1\n   * @param seq2\n   * @param distFn what method should be used to calculate distance\n   * @returns the distance between the sequence pair\n   * @throws an Error if an invalid distance function is provided.\n   */\n  private static getSequenceDistance(\n    seq1: ISequence,\n    seq2: ISequence,\n    distFn: DistanceFunctions\n  ) {\n    const minLength =\n      seq1.sequence.length < seq2.sequence.length\n        ? seq1.sequence.length\n        : seq2.sequence.length;\n    let distance = 0;\n\n    if (distFn === DistanceFunctions.hamming) {\n      for (var i = 0; i < minLength; i++) {\n        if (seq1.sequence[i] !== seq2.sequence[i]) {\n          distance += 1;\n        }\n      }\n      return distance;\n    }\n    throw Error(\n      \"Unable to determine sequence distance with distance function \" + distFn\n    );\n  }\n\n  /**\n   * Normalize all values in an object that contains all counts such that\n   * the sum of those counts equals 1.\n   * @param letterCounts an object that contains the same keys, but whose\n   *                     values now sum to 1.\n   * @param validLetters if provided, returned object will only contain letters\n   *                     that are in this array.\n   */\n  private static normalizeLetterCounts(\n    letterCounts: { [letter: string]: number },\n    validLetters?: string[]\n  ) {\n    const totalCounts = Object.keys(letterCounts).reduce((acc, letter) => {\n      if (!validLetters || validLetters.includes(letter)) {\n        acc += letterCounts[letter];\n      }\n      return acc;\n    }, 0);\n\n    return Object.keys(letterCounts).reduce((acc, letter) => {\n      if (!validLetters || validLetters.includes(letter)) {\n        acc[letter] = letterCounts[letter] / totalCounts;\n      }\n      return acc;\n    }, {} as { [letter: string]: number });\n  }\n\n  /**\n   * Create a new Alignment object. The default target sequence will\n   * be set to the first sequence in sequences. This can be changed\n   * by calling setTargetSequence() after creation\n   * @param sequences\n   */\n  public constructor(name: string, sequencesAsInput: ISequence[]) {\n    this.uuid = generateUUIDv4();\n    this.name = name;\n    this.sequences = new Map<SequenceSortOptions, ISequence[]>();\n    this.sequences.set(SequenceSortOptions.INPUT, sequencesAsInput);\n    this.targetSequence = sequencesAsInput[0];\n    this.predictedNT = true;\n\n    //\n    //generate statistics\n    //\n    const start = new Date();\n    const allLetters: { [key: string]: number } = {}; //all letters in the alignment\n\n    //this for loop takes the bulk of the time\n    for (\n      let sequenceIdx = 0;\n      sequenceIdx < sequencesAsInput.length;\n      sequenceIdx++\n    ) {\n      const seq = sequencesAsInput[sequenceIdx].sequence;\n      for (let positionIdx = 0; positionIdx < seq.length; positionIdx++) {\n        const letter = seq[positionIdx].toUpperCase();\n        const letterIsAlpha = letter.match(/[a-z]/i) ? true : false;\n        if (\n          letterIsAlpha &&\n          this.predictedNT &&\n          Nucleotide.fromSingleLetterCode(letter) === Nucleotide.UNKNOWN\n        ) {\n          this.predictedNT = false;\n        }\n\n        const position = positionIdx; // zero based\n        allLetters[letter] = 1;\n\n        let letterCounts = this.positionalLetterCounts.get(position);\n        if (!letterCounts) {\n          letterCounts = {};\n          this.positionalLetterCounts.set(position, letterCounts);\n        }\n        if (letter in letterCounts === false) {\n          letterCounts[letter] = 0;\n        }\n        letterCounts[letter] += 1;\n\n        if (letterIsAlpha) {\n          if (letter in this.globalAlphaLetterCounts === false) {\n            this.globalAlphaLetterCounts[letter] = 0;\n          }\n          this.globalAlphaLetterCounts[letter] += 1;\n        }\n      }\n    }\n\n    this.allAlphaLettersSorted = Object.keys(allLetters)\n      .sort()\n      .reduce((arr: string[], value: string) => {\n        if (value.match(/[a-z]/i)) {\n          // only keep letters\n          arr.push(value);\n        }\n        return arr;\n      }, []);\n\n    this.consensus = Array.from(this.positionalLetterCounts).map(\n      ([position, letterCounts]) => {\n        const topLetter = this.allAlphaLettersSorted.reduce(\n          (acc, currentLetter) => {\n            if (\n              acc in letterCounts === false ||\n              letterCounts[acc] < letterCounts[currentLetter]\n            ) {\n              return currentLetter;\n            }\n            return acc;\n          }\n        );\n\n        return {\n          position: position,\n          letter: topLetter,\n          occurrences: letterCounts[topLetter],\n        };\n      }\n    );\n    console.log(\n      \"done parsing alignment. took \" +\n        (new Date().getTime() - start.getTime()) +\n        \"ms\"\n    );\n  }\n\n  /**\n   * Is this alignment predicted to be nucleotides?\n   * @returns true if it is predicted to be nucleotide sequences.\n   */\n  getPredictedType(): AlignmentTypes {\n    return this.predictedNT\n      ? AlignmentTypes.NUCLEOTIDE\n      : AlignmentTypes.AMINOACID;\n  }\n\n  /**\n   * Get a unique uuid for this alignment.\n   * @returns a uuid string for this alignment\n   */\n  getUUID() {\n    return this.uuid;\n  }\n\n  /**\n   * Get the name of this alignment\n   * @returns a name for the alignment - usually the filename\n   */\n  getName() {\n    return this.name;\n  }\n\n  /**\n   * Get an ace editor mode for this alignemnt. If one doesn't exist\n   * then it will be defined.\n   * @returns the ace editor mode for this alignment\n   */\n  getAceEditorMode() {\n    if (!this.aceEditorMode) {\n      this.aceEditorMode = \"ace/mode/\" + this.uuid;\n      defineNewAlignmentMode(this.aceEditorMode, this);\n    }\n    return this.aceEditorMode;\n  }\n\n  /**\n   * Get the consensus sequence\n   * @returns a position ordered array of objects that contain each letter, its number of\n   *          occurrences, and the actual position number\n   */\n  getConsensus() {\n    return this.consensus;\n  }\n\n  /**\n   * Get the number of gaps at each position\n   * @returns an array of gap counts, ordered by position\n   */\n  getGapsPerColumn(): number[] {\n    return Array.from(this.positionalLetterCounts).map(\n      ([position, letterCounts]) => {\n        return !isNaN(letterCounts[\"-\"]) ? letterCounts[\"-\"] : 0;\n      }\n    );\n  }\n\n  /**\n   * Get the total number of times each letter appears in the alignment.\n   * @param normalize if true, will normalize the returned array such that\n   *                  it sums to 1.\n   * @param validLetters if provided, only those letters will be included\n   *                     in the resulting counts\n   */\n  getGlobalAlphaLetterCounts(normalize?: boolean, validLetters?: string[]) {\n    if (normalize) {\n      return Alignment.normalizeLetterCounts(\n        this.globalAlphaLetterCounts,\n        validLetters\n      );\n    }\n    return this.globalAlphaLetterCounts;\n  }\n\n  /**\n   * Get the length of the longest sequence\n   * @returns the length of the largest sequence in this alignment\n   */\n  getMaxSequenceLength(): number {\n    return this.getSequences().reduce((acc, seq) => {\n      if (seq.sequence.length > acc) {\n        acc = seq.sequence.length;\n      }\n      return acc;\n    }, -1);\n  }\n\n  /**\n   * Get the frequencies of all letters in this alignment for each position.\n   * @param normalize if true, will normalize the returned letter counts for each\n   *                  position such that each sums to 1.\n   * @param validLetters if provided, only those letters will be included\n   *                     in the resulting counts\n   * @returns a Map whose keys are position (ordered) and values are a dictionary\n   *          with [key = letter (e.g., amino acid code)] and [value = # occurrences].\n   */\n  getPositionalLetterCounts(normalize?: boolean, validLetters?: string[]) {\n    if (normalize) {\n      return Array.from(this.positionalLetterCounts).reduce(\n        (acc, [position, letterCounts]) => {\n          acc.set(\n            position,\n            Alignment.normalizeLetterCounts(letterCounts, validLetters)\n          );\n          return acc;\n        },\n        new Map<Number, { [letter: string]: number }>()\n      );\n    }\n\n    return this.positionalLetterCounts;\n  }\n\n  /**\n   * Get all the sequences in this alignment - ordered as they were input\n   * @param sortBy specifies the order of the returned sequences. If it isn't\n   *               provided, returns the sequences as they were input to create\n   *               the Alignment object, e.g., usually fasta order.\n   * @param forceReSort if provided, sequences are forced to be re-sorted (rather\n   *                    than possibly cached)\n   * @returns all sequences in this alignment\n   */\n  getSequences(\n    sortBy?: SequenceSortOptions,\n    forceReSort?: boolean\n  ): ISequence[] {\n    sortBy = sortBy ? sortBy : SequenceSortOptions.INPUT;\n    forceReSort = forceReSort ? forceReSort : false;\n    if (!this.sequences.has(sortBy) || forceReSort) {\n      //cache not yet populated for this sort option\n      switch (sortBy) {\n        case SequenceSortOptions.INPUT:\n          break;\n        case SequenceSortOptions.HAMMING_DIST_TARGET:\n          this.sequences.set(\n            sortBy,\n            this.sortByDistanceToTargetSequence(\n              SequenceSortOptions.HAMMING_DIST_TARGET.distanceFn!\n            )\n          );\n          break;\n        default:\n          throw Error(\n            `The sortBy option provided \"${sortBy}\" is not implemented`\n          );\n      }\n    }\n    return this.sequences.get(sortBy)!;\n  }\n\n  /**\n   * Get a sorted list of all of the letters in the alignment.\n   * @returns a list of all letters in the alignment sorted alphabetically.\n   */\n  getSortedAlphaLetters(): string[] {\n    return this.allAlphaLettersSorted;\n  }\n\n  /**\n   * Get all the first sequence in the alignment, aka, target / query / first\n   * @returns all sequences in this alignment\n   */\n  getTargetSequence(): ISequence {\n    return this.targetSequence;\n  }\n\n  /**\n   * Set the target sequence\n   * @param newTarget The new target sequence. Must already exist in the alignment.\n   * @throws an error if the target sequence does not yet exist in the alignment\n   *\n   * IMPORTANT: Requires re-sorting\n   */\n  setTargetSequence(newTarget: ISequence) {\n    const targetInAlignment = this.getSequences().find((seq) => {\n      if (seq === newTarget) {\n        return true;\n      }\n      return false;\n    });\n    if (targetInAlignment !== undefined) {\n      this.targetSequence = newTarget;\n\n      this.sequences.forEach(\n        (sequences: ISequence[], sortBy: SequenceSortOptions) => {\n          this.getSequences(sortBy, true); // force re-sorting, which updates cache\n        }\n      );\n    } else {\n      throw Error(\"target sequence does not exist in alignment\");\n    }\n  }\n\n  /**\n   * This method sorts sequences or\n   * Sort the current alignment similarity to the target sequence\n   * @returns a new alignment whose sequences are sorted in descending\n   *          order by similarity to the target sequence.\n   */\n  private sortByDistanceToTargetSequence(distFn: DistanceFunctions) {\n    const inputSequences = this.getSequences();\n    switch (distFn) {\n      case DistanceFunctions.hamming:\n        return inputSequences\n          .map((s) => s)\n          .sort((seq1, seq2) => {\n            const dist1 = Alignment.getSequenceDistance(\n              this.targetSequence,\n              seq1,\n              DistanceFunctions.hamming\n            );\n            const dist2 = Alignment.getSequenceDistance(\n              this.targetSequence,\n              seq2,\n              DistanceFunctions.hamming\n            );\n            return dist1 - dist2;\n          });\n      default:\n        throw Error(\n          `The distFn option provided \"${distFn}\" is not implemented`\n        );\n    }\n  }\n}\n","import { Ace } from \"ace-builds\";\n\n/**\n * ScrollSync.ts\n * This helper is used to synchronize the different ace and div\n * scrolling.\n *\n * Should be used as a singleton:\n *     import ScrollSync from './ScrollSync';\n *     let scrollSync = ScrollSync.singleton();\n *     scrollSync.setScrollerGroup('verticalScrollersA', 'vertical')\n *     scrollSync.registerScrollElement(element, group) //AND/OR\n *     scrollSync.registerScrollAceEditor(aceEditor, group) //OR\n *\n * Ideas taken from 2 projects:\n *   https://github.com/okonet/react-scroll-sync\n *   https://github.com/AhmadMHawwash/scroll-sync-react\n */\nexport enum ScrollType {\n  vertical,\n  horizontal,\n  both,\n}\n\ninterface ScrollProps {\n  scrolltype: ScrollType;\n  scrollers: (HTMLElement | Ace.Editor)[];\n}\n\nexport class ScrollSync {\n  static singleton: undefined | ScrollSync = undefined;\n\n  private _groupScrollpropsHM: { [key: string]: ScrollProps } = {};\n  private _lastScrollerOffsets: Map<\n    Ace.Editor | HTMLElement,\n    { lastTop: number; lastLeft: number }\n  > = new Map();\n  private _blockNextHorizontalScrollEvent: Map<\n    Ace.Editor | HTMLElement,\n    boolean\n  > = new Map();\n  private _blockNextVerticalScrollEvent: Map<\n    Ace.Editor | HTMLElement,\n    boolean\n  > = new Map();\n\n  /**\n   * @returns {ScrollSync}\n   */\n  static getInstance(): ScrollSync {\n    if (!this.singleton) {\n      this.singleton = new ScrollSync();\n    }\n    return this.singleton;\n  }\n\n  _setScrollerLastOffsets(scroller: HTMLElement | Ace.Editor) {}\n\n  /**\n   * Returns the width of the hidden area (scroll width) in px of the element or ace editor.\n   * @param scroller\n   */\n  _getAceMaxScrollWidth(scroller: Ace.Editor): number {\n    //scroller is an ace editor\n    return (\n      scroller.renderer.$getLongestLine() +\n      2 * scroller.renderer.$padding -\n      scroller.renderer.$size.scrollerWidth\n    );\n  }\n\n  /**\n   *\n   */\n  _handleScrollEvent(\n    scrolledScroller: HTMLElement | Ace.Editor,\n    groupName: string,\n    newScrollValue: number,\n    scrollDirection: ScrollType.horizontal | ScrollType.vertical\n  ) {\n    if (!this._blockNextHorizontalScrollEvent.get(scrolledScroller)) {\n      this._setScrollerLastOffsets(scrolledScroller);\n      //update other nodes in the group\n      const group = this._groupScrollpropsHM[groupName];\n      group.scrollers.forEach((siblingScroller) => {\n        if (siblingScroller !== scrolledScroller) {\n          if (\"renderer\" in siblingScroller) {\n            //the siblingScroller is an ace editor\n            if (\n              scrollDirection === ScrollType.horizontal &&\n              siblingScroller.session.getScrollLeft() !== newScrollValue\n            ) {\n              this._blockNextHorizontalScrollEvent.set(siblingScroller, true);\n              siblingScroller.session.setScrollLeft(newScrollValue); //not proportional\n            } else if (\n              scrollDirection === ScrollType.vertical &&\n              siblingScroller.session.getScrollTop() !== newScrollValue\n            ) {\n              this._blockNextVerticalScrollEvent.set(siblingScroller, true);\n              siblingScroller.session.setScrollTop(newScrollValue); //not proportional\n            }\n          } else {\n            //the siblingScroller is an html element\n            if (\n              scrollDirection === ScrollType.horizontal &&\n              siblingScroller.scrollLeft !== newScrollValue\n            ) {\n              this._blockNextHorizontalScrollEvent.set(siblingScroller, true);\n              siblingScroller.scrollLeft = newScrollValue;\n            } else if (\n              scrollDirection === ScrollType.vertical &&\n              siblingScroller.scrollTop !== newScrollValue\n            ) {\n              this._blockNextVerticalScrollEvent.set(siblingScroller, true);\n              siblingScroller.scrollTop = newScrollValue;\n            }\n          }\n        }\n      });\n    }\n    this._blockNextHorizontalScrollEvent.set(scrolledScroller, false);\n  }\n\n  /**\n   * DEPRICATING _handleHorizontalScrollEvent\n   * @param scroller\n   * @param groupName\n   * @param newScrollLeft\n   \n  _handleHorizontalScrollEvent(\n    scroller: HTMLElement | Ace.Editor,\n    groupName: string,\n    newScrollLeft: number\n  ) {\n    this._setScrollerLastOffsets(scroller);\n\n    //determine properties of the node being scrolled and set \"last\" scrolled numbers\n    var scrollerFractionScrolled;\n    if (\"renderer\" in scroller) {\n      //the node being scrolled is an ace editor\n      scrollerFractionScrolled =\n        newScrollLeft / this._getAceMaxScrollWidth(scroller);\n    } else {\n      //the node being scrolled is an HTMLElement\n      scrollerFractionScrolled =\n        newScrollLeft / (scroller.scrollWidth - scroller.offsetWidth);\n    }\n\n    //update other nodes in the group\n    const group = this._groupScrollpropsHM[groupName];\n    for (var i = 0; i < group.scrollers.length; i++) {\n      const targetScroller = group.scrollers[i];\n      if (targetScroller !== scroller) {\n        if (\"renderer\" in targetScroller) {\n          //its another ace editor\n          const targetMaxWidth = this._getAceMaxScrollWidth(targetScroller);\n          const proportionalScrollLeft = Math.round(\n            scrollerFractionScrolled * targetMaxWidth\n          );\n          if (\n            proportionalScrollLeft !== targetScroller.session.getScrollLeft()\n          ) {\n          //targetScroller.session.setScrollLeft(proportionalScrollLeft);\n          }\n          if (targetScroller.session.getScrollLeft() !== newScrollLeft) {\n            this._blockNextHorizontalScrollEvent.set(targetScroller, true);\n            targetScroller.session.setScrollLeft(newScrollLeft); //TODO: KEEP / REMOVE? CURRENTLY TESTING (not proportional)\n          }\n        } else {\n          //its an html element\n          const targetMaxWidth =\n            targetScroller.scrollWidth - targetScroller.offsetWidth;\n          const proportionalScrollLeft = Math.round(\n            scrollerFractionScrolled * targetMaxWidth\n          );\n          if (targetScroller.scrollLeft !== proportionalScrollLeft) {\n          //targetScroller.scrollLeft = proportionalScrollLeft;\n          }\n          if (targetScroller.scrollLeft !== newScrollLeft) {\n            this._blockNextHorizontalScrollEvent.set(targetScroller, true);\n            targetScroller.scrollLeft = newScrollLeft; //TODO: KEEP / REMOVE? CURRENTLY TESTING (not proportional)\n          }\n        }\n      }\n    }\n  }*/\n\n  /**\n   * Add or modify a group of synchronized scrollers.\n   *\n   * @param {string} groupName The name of the group to add .\n   * @param {string} scrollType The type of scolling: \"vertical\", \"horizontal\", \"both\".\n   *                            default=\"both\"\n   */\n  setScrollerGroup(groupName: string, scrollType: ScrollType) {\n    this._groupScrollpropsHM[groupName] = {\n      scrolltype: scrollType,\n      scrollers: this._groupScrollpropsHM[groupName]\n        ? this._groupScrollpropsHM[groupName].scrollers\n        : [],\n    };\n  }\n\n  /**\n   * Register an element or ace editor for scroll synchronization.\n   * @param scroller\n   * @param groupName\n   * @param dontErrorOnDuplicate if true, silently returns if the scroller is already registered\n   *                             with this group, otherwise throws an error.\n   */\n  registerScroller(\n    scroller: HTMLElement | Ace.Editor,\n    groupName: string,\n    dontErrorOnDuplicate?: boolean\n  ) {\n    const group = this._groupScrollpropsHM[groupName];\n    if (!group) {\n      throw new Error(`Error: attempt to register scroll sync on unknown group \"${groupName}\"\n                    please register group first with setScrollerGroup`);\n    }\n    if (group.scrollers.includes(scroller)) {\n      if (dontErrorOnDuplicate) {\n        return;\n      }\n      throw new Error(\n        `Error: attempt to re-add scroller to group \"${groupName}\"`\n      );\n    }\n\n    group.scrollers.push(scroller);\n    this._setScrollerLastOffsets(scroller); // initialize \"last\" offsets\n\n    if (\"renderer\" in scroller) {\n      //the scroller is an ace editor\n      if (\n        group.scrolltype === ScrollType.both ||\n        group.scrolltype === ScrollType.horizontal\n      ) {\n        scroller.session.on(\"changeScrollLeft\", (newScrollLeft) => {\n          this._handleScrollEvent(\n            scroller,\n            groupName,\n            Math.round(scroller.session.getScrollLeft()),\n            ScrollType.horizontal\n          );\n        });\n      }\n\n      if (\n        group.scrolltype === ScrollType.both ||\n        group.scrolltype === ScrollType.vertical\n      ) {\n        scroller.session.on(\"changeScrollTop\", (e) => {\n          this._handleScrollEvent(\n            scroller,\n            groupName,\n            Math.round(scroller.session.getScrollTop()),\n            ScrollType.vertical\n          );\n        });\n      }\n    } else {\n      //the scroller is an html element\n      scroller.onscroll = (e) => {\n        //determine direction - if the last scroll left !== to the new left\n        //then it is horizontal otherwise it is vertical\n        const direction =\n          (e.target as HTMLElement).scrollLeft !==\n          this._lastScrollerOffsets.get(scroller)?.lastLeft\n            ? ScrollType.horizontal\n            : ScrollType.vertical;\n\n        if (\n          group.scrolltype === ScrollType.both ||\n          group.scrolltype === direction\n        ) {\n          this._handleScrollEvent(\n            scroller,\n            groupName,\n            (e.target as HTMLElement).scrollLeft,\n            direction\n          );\n        }\n      };\n    }\n  }\n}\n","/**\n *\n * Sequence logo component.\n * Inspired / derived from https://github.com/weng-lab/logojs-package\n *  (but much simpler)\n */\n\nimport React from \"react\";\nimport { Alignment } from \"../common/Alignment\";\nimport { GlyphFactory } from \"../common/SequenceLogoGlyphs\";\nimport { getFinalLetterClassNames } from \"../common/MolecularStyles\";\n\nexport enum LOGO_TYPES {\n  LETTERS = \"letter stack\",\n  BARS = \"bar plot\",\n}\n\ninterface IGlyphFrequency {\n  frequency: number;\n  letter: {\n    letter: string;\n    classNames: string;\n  };\n}\ninterface IGlyphStack extends Array<IGlyphFrequency> {}\n\nexport interface ISequenceLogoProps {\n  alignment: Alignment;\n  glyphWidth: number;\n  logoType?: LOGO_TYPES;\n\n  logoLoaded?(node: HTMLDivElement): void;\n\n  readonly id: string;\n}\n\nexport class SequenceLogoComponent extends React.Component<ISequenceLogoProps> {\n  private scrollerDiv?: HTMLDivElement | null;\n  private loaded: boolean = false;\n\n  static defaultProps = {\n    logoType: LOGO_TYPES.LETTERS,\n  };\n\n  divLoaded(e: HTMLDivElement | null) {\n    if (e && !this.scrollerDiv) {\n      //only run if first time element available\n      this.scrollerDiv = e;\n      if (this.props.logoLoaded) {\n        this.props.logoLoaded(this.scrollerDiv);\n      }\n    }\n  }\n\n  shouldComponentUpdate(nextProps: ISequenceLogoProps) {\n    if (\n      this.loaded === false ||\n      this.props.logoType !== nextProps.logoType ||\n      this.props.glyphWidth !== nextProps.glyphWidth ||\n      this.props.alignment !== nextProps.alignment\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  render() {\n    if (!this.props.alignment || !this.props.glyphWidth) {\n      return null;\n    }\n\n    const positionalLetterCounts = this.props.alignment.getPositionalLetterCounts();\n    const lettersSorted = this.props.alignment.getSortedAlphaLetters();\n\n    //calculate the frequencies of all letters in each column\n    const frequencies: number[][] = [];\n    positionalLetterCounts.forEach((letterCounts, position) => {\n      const totalCountAtPosition = Object.keys(letterCounts).reduce(\n        (total, letter) => {\n          total += letterCounts[letter];\n          return total;\n        },\n        0\n      );\n\n      const frequenciesAtPosition: number[] = lettersSorted.map((letter) => {\n        let freq = 0;\n        if (letter in letterCounts) {\n          freq = letterCounts[letter] / totalCountAtPosition;\n        }\n        return freq;\n      });\n\n      frequencies.push(frequenciesAtPosition);\n    });\n\n    //load alphabet information\n    const sortedAlphabet = lettersSorted.map((letter) => {\n      return {\n        letter: letter,\n        classNames: getFinalLetterClassNames(letter, false, false),\n      };\n    });\n\n    //munge in alphabet and sort by frequency\n    const logoData = frequencies.map((frequenciesAtPosition, positionIdx) => {\n      return frequenciesAtPosition\n        .map((frequency, letterIdx) => {\n          return {\n            frequency: frequency,\n            letter: sortedAlphabet[letterIdx],\n          };\n        })\n        .filter((freq) => {\n          return freq.frequency !== 0;\n        })\n        .sort((a, b) => (a.frequency > b.frequency ? 1 : -1));\n    });\n\n    const totalWidth = frequencies.length * this.props.glyphWidth;\n    const totalHeight = 100;\n    this.loaded = true;\n\n    /**\n     * Generate the svg elements for a single position, i.e., column\n     *\n     */\n    const generateStack = (positionalFrequencies: IGlyphStack) => {\n      let dy = 100;\n\n      return positionalFrequencies.map((freq, idx) => {\n        dy = dy - freq.frequency * 100;\n\n        if (this.props.logoType === LOGO_TYPES.BARS) {\n          const xscale = 2 / logoData.length; // not exact, but works.\n          return (\n            <rect\n              width=\"100\"\n              height=\"100\"\n              transform={`translate(0, ${dy}) scale(${xscale},${freq.frequency})`}\n              className={freq.letter.classNames}\n              key={`idxrect_${idx}`}\n            ></rect>\n          );\n        }\n\n        const xscale = 0.009; // invariant scaling\n        const selectedGlyph = GlyphFactory.glyphFromChar(freq.letter.letter)({\n          className: freq.letter.classNames,\n          transform: `translate(0, ${dy}) scale(${xscale},${freq.frequency})`,\n          key: `idxglyph_${idx}`,\n        });\n        return selectedGlyph;\n      });\n    };\n\n    console.log(logoData);\n\n    return (\n      <div id={this.props.id} ref={(e) => this.divLoaded(e)}>\n        <svg\n          preserveAspectRatio=\"none\"\n          viewBox={`0 0 ${logoData.length} 100`}\n          style={{ width: totalWidth, height: totalHeight }}\n          xmlns=\"http://www.w3.org/2000/svg\"\n        >\n          {logoData.map((singlePositionData, positionIdx) => {\n            return (\n              <g\n                transform={`translate(${positionIdx},0)`}\n                key={\"p_\" + positionIdx}\n              >\n                {generateStack(singlePositionData)}\n              </g>\n            );\n          })}\n        </svg>\n      </div>\n    );\n  }\n}\n","import React from \"react\";\nimport { Alignment } from \"../common/Alignment\";\n\nexport interface ISequenceConservationProps {\n  alignment: Alignment;\n  characterWidth: number;\n\n  conservationPlotLoaded?(node: HTMLDivElement): void;\n\n  readonly id: string;\n}\n\ninterface ISequenceConservationState {\n  isHovered: boolean;\n}\n\nexport class SequenceConservationComponent extends React.Component<\n  ISequenceConservationProps,\n  ISequenceConservationState\n> {\n  private scrollerDiv?: HTMLDivElement | null;\n\n  constructor(props: ISequenceConservationProps) {\n    super(props);\n    this.state = {\n      isHovered: false,\n    };\n    this.handleSvgHover = this.handleSvgHover.bind(this);\n  }\n\n  handleSvgHover(isHovered: boolean) {\n    this.setState({\n      isHovered: isHovered,\n    });\n  }\n\n  /**\n   * Compute the Kullback-Leibler (KL) entropy for individual columns in the alignment\n   *        S = sum(pk * log(pk / qk)\n   * also see scipy docs:\n   *     https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.entropy.html\n   *\n   * @param pk Column data: an object whose keys are all letters in the column and\n   *           values are normalized (sum to 1) frequency of occurrence.\n   *           From scipy docs: \"the (discrete) distribution. pk[i] is the\n   *                              ... probability of event i\"\n   * @param qk an object whose keys are all letters in the alignment and values are\n   *           normalized (sum to 1) frequency of occurrence.\n   *           From scipy docs: \"Sequence against which the relative entropy is\n   *                              computed. Should be in the same format as pk.\"\n   */\n  computeEntropy(\n    allLetters: string[],\n    pk: { [letter: string]: number },\n    qk: { [letter: string]: number },\n    doLog?: boolean\n  ) {\n    return allLetters.reduce((acc, letter) => {\n      if (letter in pk) {\n        acc += pk[letter] * Math.log(pk[letter] / qk[letter]);\n      }\n      return acc;\n    }, 0);\n  }\n\n  /**\n   *\n   * @param maxSeqLength\n   */\n  createConservationCountGs() {\n    const toReturn: JSX.Element[] = [];\n    const allLetters = this.props.alignment.getSortedAlphaLetters();\n    const positionalLetterCounts = this.props.alignment.getPositionalLetterCounts(\n      true,\n      allLetters\n    );\n    const backgroundLetterCounts = this.props.alignment.getGlobalAlphaLetterCounts(\n      true,\n      allLetters\n    );\n\n    //const maximumEntropy = this.computeEntropy(allLetters, backgroundLetterCounts, backgroundLetterCounts);\n    const entropies = Array.from(positionalLetterCounts).map(\n      ([position, letterCounts]) => {\n        return this.computeEntropy(\n          allLetters,\n          letterCounts,\n          backgroundLetterCounts\n        );\n      }\n    );\n\n    //normalize between 0 and 1\n    const maxEmpiricalEntropy = Math.max(...entropies);\n    const normalizedEntropies = entropies.map((entropy) => {\n      return (entropy / maxEmpiricalEntropy) * 100;\n    });\n    //console.log('entropies', entropies);\n    //console.log('normalizedEntropies', normalizedEntropies);\n\n    normalizedEntropies.forEach((normalizedEntropy, idx) => {\n      toReturn.push(\n        <g transform={`translate(${idx},${100 - normalizedEntropy})`} key={idx}>\n          <rect width={0.5} height={`${normalizedEntropy}`}></rect>\n        </g>\n      );\n    });\n    return toReturn;\n  }\n\n  /**\n   * Generate a chart to depict the number of gaps in each column. The bar\n   * chart is normalized to a maximum height of 100 (if the number of gaps in\n   * a particular column was equal to the number of sequences in that column)\n   * @param maxSeqLength The total number of possible sequences in the column.\n   *                     Used to normalize the output to a maximum height of 100.\n   */\n  createGapCountGs(maxSeqLength: number) {\n    const toReturn: JSX.Element[] = [];\n    const numSequences = this.props.alignment.getSequences().length;\n    const gapCounts = this.props.alignment.getGapsPerColumn();\n\n    for (let i = 0; i < maxSeqLength; i++) {\n      const gapPercentage = (gapCounts[i] / numSequences) * 100;\n      toReturn.push(\n        <g transform={`translate(${i + 0.5},${100 - gapPercentage})`} key={i}>\n          <rect width={0.5} height={gapPercentage}></rect>\n        </g>\n      );\n    }\n    return toReturn;\n  }\n\n  divLoaded(e: HTMLDivElement | null) {\n    if (e && !this.scrollerDiv) {\n      //only run if first time element available\n      this.scrollerDiv = e;\n      if (this.props.conservationPlotLoaded) {\n        this.props.conservationPlotLoaded(this.scrollerDiv);\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    //TODO: notify parent of unloading and release dom\n  }\n\n  render() {\n    if (!this.props.alignment || !this.props.characterWidth) {\n      return null;\n    }\n\n    const maxSeqLength = this.props.alignment.getMaxSequenceLength();\n    const totalWidth = this.props.characterWidth * maxSeqLength;\n    const hoveredClass = this.state.isHovered\n      ? \"conservation hovered\"\n      : \"conservation\";\n\n    return (\n      <div>\n        <div\n          style={{\n            backgroundColor: \"rgba(255,255,255,0.9)\",\n            border: \"solid 1px black\",\n            position: \"absolute\",\n            padding: \"3px\",\n            top: 0,\n            right: 0,\n            color: \"red\",\n            visibility: this.state.isHovered ? \"visible\" : \"hidden\",\n            zIndex: 1000,\n          }}\n        >\n          <span style={{ color: \"#000000\" }}>Entropy</span>\n          <span style={{ color: \"#b7b7b7\", paddingLeft: 10 }}>&#35; Gaps</span>\n        </div>\n\n        <div id={this.props.id} ref={(e) => this.divLoaded(e)}>\n          <div className=\"svg_container\">\n            <svg\n              preserveAspectRatio=\"none\"\n              viewBox={`0 0 ${maxSeqLength} 100`}\n              style={{ width: totalWidth, height: 100 }}\n              className={hoveredClass}\n              xmlns=\"http://www.w3.org/2000/svg\"\n              onMouseEnter={() => this.handleSvgHover(true)}\n              onMouseLeave={() => this.handleSvgHover(false)}\n            >\n              <g className=\"gapCount\">{this.createGapCountGs(maxSeqLength)}</g>\n              <g className=\"entropy\">{this.createConservationCountGs()}</g>\n            </svg>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","import React from \"react\";\nimport { Alignment, SequenceSortOptions, ISequence } from \"../common/Alignment\";\nimport { Nucleotide, AminoAcid } from \"../common/Residues\";\nimport * as PIXI from \"pixi.js\";\nimport { PixiComponent, Stage, Sprite, AppContext } from \"@inlet/react-pixi\";\nimport { Viewport } from \"pixi-viewport\";\nimport { Graphics } from \"pixi.js\";\n\nimport {\n  IColorScheme,\n  PositionsToStyle,\n  AlignmentTypes,\n} from \"../common/MolecularStyles\";\n\nexport interface IAlignmentCanvasProps {\n  alignment: Alignment;\n  alignmentType: AlignmentTypes;\n  sortBy: SequenceSortOptions;\n  positionsToStyle: PositionsToStyle;\n  colorScheme: IColorScheme;\n  highlightRows?: [number, number]; //[startRowNum, endRowNum]\n  stageResolution?: {\n    width: number;\n    height: number;\n  };\n  viewportProps?: Partial<IViewportProps>;\n\n  mouseDown?(x: number, y: number): void;\n\n  readonly id: string;\n}\n\ninterface ITiledImages {\n  targetTileWidth: number;\n  targetTileHeight: number;\n  lastTileWidth: number;\n  lastTileHeight: number;\n  numXTiles: number;\n  numYTiles: number;\n  tiles: {\n    tileX: number;\n    tileY: number;\n    pixelX: number;\n    pixelY: number;\n    width: number;\n    height: number;\n    image: HTMLCanvasElement;\n  }[];\n}\n\nconst AlignmentHighlighter = PixiComponent(\"AlignmentHighlighter\", {\n  create: (props: any) => new Graphics(),\n  applyProps: (instance, _, props) => {\n    const { x, y, width, height, fillColor, fillAlpha } = props;\n    instance.clear();\n    instance.beginFill(fillColor, fillAlpha);\n    instance.drawRect(x, y, width, height);\n    instance.endFill();\n  },\n});\n\nexport class AlignmentCanvasComponent extends React.Component<\n  IAlignmentCanvasProps\n> {\n  app?: PIXI.Application;\n  scaleX: number = 1;\n  scaleY: number = 1;\n\n  static defaultProps = {\n    mouseDown: () => {},\n    stageResolution: {\n      width: 485,\n      height: 650,\n    },\n    viewportProps: {\n      useDrag: true,\n      usePinch: true,\n      useWheel: true,\n      zoomPercent: 0,\n    },\n  };\n\n  sliderChanged(newValue: number, xy: \"x\" | \"y\") {\n    if (this.app) {\n      this.app.stage.children.forEach((sprite) => {\n        if (xy === \"x\") {\n          sprite.scale.x = newValue;\n        } else {\n          sprite.scale.y = newValue;\n        }\n      });\n    }\n  }\n\n  render() {\n    const {\n      alignment,\n      alignmentType,\n      colorScheme,\n      highlightRows,\n      id,\n      positionsToStyle,\n      sortBy,\n      stageResolution,\n      viewportProps,\n    } = this.props;\n    if (!alignment) {\n      return null;\n    }\n    const numSequences = alignment.getSequences().length;\n    const maxSeqLength = alignment.getMaxSequenceLength();\n\n    PIXI.utils.skipHello();\n    PIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST; //\n    //TODO: still anti-aliases on retina devices. probably requires\n    //      writing 4x the pixels and telling pixi that it is a retina\n    //      image\n    //PIXI.settings.RESOLUTION = 2;\n    //PIXI.settings.ROUND_PIXELS = true; //\n    const height = highlightRows\n      ? highlightRows[1] - highlightRows[0]\n      : undefined;\n\n    return (\n      <div\n        id={id}\n        onWheel={this.onWheel}\n        onMouseEnter={this.onMouseEnter}\n        onMouseLeave={this.onMouseLeave}\n      >\n        <Stage\n          width={stageResolution?.width}\n          height={stageResolution?.height}\n          options={{ transparent: true }}\n        >\n          <AppContext.Consumer>\n            {(app) => {\n              this.app = app;\n              return <></>;\n            }}\n          </AppContext.Consumer>\n          <AppContext.Consumer>\n            {(app) => (\n              <PixiViewport\n                app={app}\n                numColumns={maxSeqLength}\n                numRows={numSequences}\n                mouseDown={this.props.mouseDown}\n                {...viewportProps}\n              >\n                <PixiAlignmentTiled\n                  id=\"tiled-alignment\"\n                  alignment={alignment}\n                  alignmentType={alignmentType}\n                  sortBy={sortBy}\n                  colorScheme={colorScheme}\n                  positionsToStyle={positionsToStyle}\n                />\n                {height ? (\n                  <>\n                    {this.renderAlignmentHighlighter({\n                      x: 0,\n                      y: this.props.highlightRows![0],\n                      width: maxSeqLength,\n                      height,\n                    })}\n                  </>\n                ) : (\n                  <></>\n                )}\n              </PixiViewport>\n            )}\n          </AppContext.Consumer>\n        </Stage>\n      </div>\n    );\n  }\n\n  protected renderAlignmentHighlighter = (props: {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    fillColor?: number;\n    fillAlpha?: number;\n  }) => (\n    <AlignmentHighlighter\n      {...{ fillColor: 0xff0000, fillAlpha: 0.25, ...props }}\n    />\n  );\n\n  protected onMouseEnter = (e: React.MouseEvent<HTMLDivElement>) => {\n    document.body.style.overflow = \"hidden\";\n  };\n\n  protected onMouseLeave = (e: React.MouseEvent<HTMLDivElement>) => {\n    document.body.style.overflow = \"auto\";\n  };\n\n  protected onWheel = (e: React.WheelEvent<HTMLDivElement>) => {\n    //e.preventDefault(); //TODO Drew is this necessary?\n  };\n}\nclass PixiAlignmentTiled extends React.Component<IAlignmentCanvasProps> {\n  shouldComponentUpdate(nextProps: IAlignmentCanvasProps) {\n    const toReturn =\n      nextProps.alignment !== this.props.alignment ||\n      nextProps.colorScheme !== this.props.colorScheme ||\n      nextProps.positionsToStyle !== this.props.positionsToStyle ||\n      nextProps.sortBy !== this.props.sortBy;\n    /*console.log(\n      \"UPDATING Canvas Tiling: \" +\n        (nextProps.colorScheme !== this.currentColorScheme) +\n        \":\" +\n        (nextProps.positionsToStyle !== this.currentPositionsStyled) +\n        \" :: \" +\n        toReturn\n    );*/\n    //console.log(\"CANVAS rerender??\");\n    return toReturn;\n  }\n\n  render() {\n    if (!this.props.alignment) {\n      return null;\n    }\n\n    const {\n      alignment,\n      alignmentType,\n      colorScheme,\n      positionsToStyle,\n      sortBy,\n    } = this.props;\n\n    // Generate multiple tiled images from the alignment\n    const sequences = alignment.getSequences(sortBy);\n    const fullWidth = alignment.getMaxSequenceLength();\n    const fullHeight = sequences.length;\n\n    const sizes = {\n      fullWidth,\n      fullHeight,\n      targetTileWidth: Math.min(400, fullWidth),\n      targetTileHeight: Math.min(400, fullHeight),\n    };\n\n    const tiledImages: ITiledImages = this.initializeTiledImages(sizes);\n\n    for (\n      let tileYNumber = 0;\n      tileYNumber < tiledImages.numYTiles;\n      tileYNumber++\n    ) {\n      for (\n        let tileXNumber = 0;\n        tileXNumber < tiledImages.numXTiles;\n        tileXNumber++\n      ) {\n        const tiledImage = this.generateCanvasForTile(\n          tileXNumber,\n          tileYNumber,\n          sizes.targetTileWidth,\n          sizes.targetTileHeight,\n          tiledImages,\n          sequences\n        );\n        tiledImages.tiles.push(tiledImage);\n      }\n    }\n\n    //console.log(\"CANVAS rerender [\" + sortBy.key + \"]\", sequences);\n    return (\n      <>\n        {tiledImages.tiles.map((tile) => (\n          <Sprite\n            source={tile.image}\n            x={tile.pixelX}\n            y={tile.pixelY}\n            key={`${tile.tileX}_\n                  ${tile.tileY}_\n                  ${colorScheme.commonName}_\n                  ${positionsToStyle.key}_\n                  ${alignmentType.key}_\n                  ${sortBy.key}_\n                  ${alignment.getName()}`}\n          ></Sprite>\n        ))}\n      </>\n    );\n  }\n\n  protected colorCanvasWithSequence(\n    tileImageData: ImageData,\n    tileCanvasContext: CanvasRenderingContext2D,\n    tileCanvas: HTMLCanvasElement,\n    sequences: ISequence[],\n    offsets: { seqY: number; letterX: number }\n  ) {\n    let imageDataIdx = 0;\n\n    for (let seqIdx = 0; seqIdx < tileCanvas.height; seqIdx++) {\n      const seq = sequences[seqIdx + offsets.seqY];\n      for (let letterIdx = 0; letterIdx < tileCanvas.width; letterIdx++) {\n        const letter = seq.sequence[letterIdx + offsets.letterX];\n        const colorScheme = this.getCurrentMoleculeColors(\n          letter,\n          letterIdx,\n          offsets\n        );\n\n        tileImageData.data[imageDataIdx] = colorScheme.rgb.red;\n        tileImageData.data[imageDataIdx + 1] = colorScheme.rgb.green;\n        tileImageData.data[imageDataIdx + 2] = colorScheme.rgb.blue;\n        tileImageData.data[imageDataIdx + 3] = 255; //alpha between 0 (transparent) and 255 (opaque)\n\n        imageDataIdx += 4;\n      }\n    }\n    tileCanvasContext.putImageData(tileImageData, 0, 0);\n  }\n\n  protected generateCanvasForTile(\n    tileXNumber: number,\n    tileYNumber: number,\n    targetTileWidth: number,\n    targetTileHeight: number,\n    tiledImages: ITiledImages,\n    sequences: ISequence[]\n  ) {\n    const tileCanvas = document.createElement(\"canvas\") as HTMLCanvasElement;\n    tileCanvas.height =\n      tileYNumber === tiledImages.numYTiles - 1\n        ? tiledImages.lastTileHeight\n        : targetTileHeight;\n    tileCanvas.width =\n      tileXNumber === tiledImages.numXTiles - 1\n        ? tiledImages.lastTileWidth\n        : targetTileWidth;\n\n    const offsets = {\n      seqY: tileYNumber * targetTileHeight,\n      letterX: tileXNumber * targetTileWidth,\n    };\n\n    const tileCanvasContext = tileCanvas.getContext(\"2d\");\n    tileCanvasContext?.fillRect(0, 0, tileCanvas.width, tileCanvas.height); //unclear why necessary\n    const tileImageData = tileCanvasContext?.getImageData(\n      0,\n      0,\n      tileCanvas.width,\n      tileCanvas.height\n    );\n\n    if (tileImageData && tileCanvasContext) {\n      this.colorCanvasWithSequence(\n        tileImageData,\n        tileCanvasContext,\n        tileCanvas,\n        sequences,\n        offsets\n      );\n    }\n\n    return {\n      tileX: tileXNumber,\n      tileY: tileYNumber,\n      pixelX: offsets.letterX,\n      pixelY: offsets.seqY,\n      width: tileCanvas.width,\n      height: tileCanvas.height,\n      image: tileCanvas,\n    };\n  }\n\n  protected getCurrentMoleculeColors(\n    letter: string,\n    letterIdx: number,\n    offsets: { seqY: number; letterX: number }\n  ) {\n    const { alignment, alignmentType, colorScheme } = this.props;\n    const consensusSequence = alignment.getConsensus();\n    const querySequence = alignment.getTargetSequence().sequence;\n    const moleculeClass =\n      alignmentType === AlignmentTypes.AMINOACID ? AminoAcid : Nucleotide;\n    let molecule = moleculeClass.UNKNOWN;\n\n    if (this.props.positionsToStyle === PositionsToStyle.ALL) {\n      molecule = moleculeClass.fromSingleLetterCode(letter);\n    } else {\n      const isConsensus =\n        consensusSequence[letterIdx + offsets.letterX].letter === letter;\n      const isQuery = querySequence[letterIdx + offsets.letterX] === letter;\n      if (\n        (this.props.positionsToStyle === PositionsToStyle.CONSENSUS &&\n          isConsensus) ||\n        (this.props.positionsToStyle === PositionsToStyle.CONSENSUS_DIFF &&\n          !isConsensus) ||\n        (this.props.positionsToStyle === PositionsToStyle.QUERY && isQuery) ||\n        (this.props.positionsToStyle === PositionsToStyle.QUERY_DIFF &&\n          !isQuery)\n      ) {\n        molecule = moleculeClass.fromSingleLetterCode(letter);\n      }\n    }\n    return molecule.colors[colorScheme.commonName];\n  }\n\n  protected initializeTiledImages({\n    targetTileWidth = 0,\n    targetTileHeight = 0,\n    fullWidth = 0,\n    fullHeight = 0,\n  }): ITiledImages {\n    return {\n      targetTileWidth: targetTileWidth,\n      targetTileHeight: targetTileHeight,\n      lastTileWidth:\n        fullWidth % targetTileWidth !== 0\n          ? fullWidth % targetTileWidth\n          : targetTileWidth,\n      lastTileHeight:\n        fullHeight % targetTileHeight !== 0\n          ? fullHeight % targetTileHeight\n          : targetTileHeight,\n      numXTiles:\n        fullWidth % targetTileWidth !== 0\n          ? Math.floor(fullWidth / targetTileWidth) + 1\n          : Math.floor(fullWidth / targetTileWidth),\n      numYTiles:\n        fullHeight % targetTileHeight !== 0\n          ? Math.floor(fullHeight / targetTileHeight) + 1\n          : Math.floor(fullHeight / targetTileHeight),\n      tiles: [],\n    };\n  }\n}\n\nexport interface IViewportProps {\n  useDrag?: boolean; // Allows the user to drag the viewport around.\n  usePinch?: boolean; // Allows the user to pinch to zoom; e.g. on a trackpad.\n  useWheel?: boolean; // Allows the user to use a mouse wheel to zoom.\n  numColumns: number;\n  numRows: number;\n  app: PIXI.Application;\n  mouseDown?: (x: number, y: number) => void;\n  zoomPercent?: number;\n}\n\nconst PixiViewport = PixiComponent<IViewportProps, any>(\"PixiViewport\", {\n  create(props: IViewportProps) {\n    const {\n      app,\n      numColumns,\n      numRows,\n      useDrag,\n      usePinch,\n      useWheel,\n      zoomPercent,\n    } = props;\n    app.renderer.backgroundColor = 0xffffff;\n\n    let vp = new Viewport({\n      screenWidth: app.renderer.width,\n      screenHeight: app.renderer.height,\n      worldWidth: numColumns,\n      worldHeight: numRows,\n      interaction: app.renderer.plugins.interaction,\n    })\n      .decelerate()\n      .clamp({\n        direction: \"all\",\n      })\n      .bounce({ friction: 0.1, time: 150, underflow: \"center\" })\n      .clampZoom({\n        maxHeight: app.renderer.height,\n        maxWidth: app.renderer.width,\n      });\n    /*\n      .drag()\n      .pinch()\n      .wheel()\n      .decelerate()\n      .clamp({\n        direction: \"all\"\n      })\n      .bounce({ friction: 0.1, time: 500, underflow: \"center\" })\n      .clampZoom({\n        maxHeight: app.renderer.height,\n        maxWidth: app.renderer.width\n      });*/\n\n    // !IMPORTANT\n    // Two-finger drag on trackpad is also enabled by this.\n    // Issue currently open: https://github.com/davidfig/pixi-viewport/issues/143\n    if (useDrag) {\n      vp = vp.drag({\n        direction: \"all\", //this is the line that kills pinch\n      });\n    }\n\n    if (usePinch) {\n      vp = vp.pinch();\n    }\n\n    if (useWheel) {\n      vp = vp.wheel();\n    }\n\n    if (zoomPercent) {\n      vp = vp.zoomPercent(zoomPercent);\n    }\n    vp.on(\"clicked\", (e) => {\n      if (props.mouseDown) {\n        props.mouseDown(e.world.x, e.world.y);\n      }\n    });\n\n    //start the component zoomed such that the entire alignment width\n    //is visible in the frame.\n    //vp = vp.setZoom(app.renderer.width / numColumns, true);\n    //vp = vp.fitWorld(true);\n    return vp;\n  },\n\n  applyProps(\n    vp: Viewport, //PIXI.Graphics,\n    oldProps: IViewportProps,\n    newProps: IViewportProps\n  ) {\n    //if (oldProps.zoomPercent !== newProps.zoomPercent && newProps.zoomPercent) {\n    //  viewport = viewport.setZoom(newProps.zoomPercent, false);\n    // }\n    //vp = vp.fitWorld(true);\n    //vp = vp.setZoom(50, false);\n    if (\n      oldProps.numColumns !== newProps.numColumns ||\n      oldProps.numRows !== newProps.numRows\n    ) {\n      vp.screenWidth = newProps.app.renderer.width;\n      vp.screenHeight = newProps.app.renderer.height;\n      vp.worldWidth = newProps.numColumns;\n      vp.worldHeight = newProps.numRows;\n      vp = vp.fitWorld(true);\n      vp = vp.setZoom(newProps.app.renderer.width / newProps.numColumns, false);\n    }\n    return vp;\n  },\n});\n","import * as React from \"react\";\n\nimport { AlignmentCanvasComponent } from \"./AlignmentCanvasComponent\";\nimport { Alignment, SequenceSortOptions } from \"../common/Alignment\";\nimport {\n  AminoAcidAlignmentStyle,\n  NucleotideAlignmentStyle,\n} from \"../common/MolecularStyles\";\n\nexport interface IMiniMapProps {\n  alignHorizontal: \"left\" | \"right\";\n  //alignVertical: \"top\" | \"bottom\";\n  alignment: Alignment;\n  height: number;\n  highlightRows?: [number, number];\n  onClick?: (x: number, y: number) => void;\n  sortBy: SequenceSortOptions;\n  style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle;\n  width: number;\n}\n\nexport interface IMiniMapState {\n  zoomPercent: number;\n}\n\nexport class MiniMapComponent extends React.Component<\n  IMiniMapProps,\n  IMiniMapState\n> {\n  public static defaultProps = {\n    alignHorizontal: \"right\",\n    //alignVertical: \"top\",\n    height: 600,\n    width: 300,\n  };\n  constructor(props: IMiniMapProps) {\n    super(props);\n    this.state = {\n      zoomPercent: 1,\n    };\n  }\n\n  protected getSizing() {\n    const frameBorderWidth = 1; // in pixels\n    const frameMargin = 2; // in pixels\n    return {\n      borderWidth: frameBorderWidth,\n      margin: frameMargin,\n      frameHeight: this.props.height - 2 * frameMargin - 1 * frameBorderWidth,\n      frameWidth: this.props.width - 2 * frameMargin - 1 * frameBorderWidth,\n    };\n  }\n\n  public render() {\n    const { alignHorizontal, width } = this.props;\n    const size = this.getSizing();\n    return (\n      <div\n        style={{\n          zIndex: 100000,\n          ...(alignHorizontal === \"left\" ? { left: 0 } : { right: 0 }),\n          //...(alignVertical === \"top\" ? { top: 0 } : { bottom: 0 }),\n          top: 0,\n          bottom: 0,\n          height: size.frameHeight,\n          width: size.frameWidth,\n          position: \"fixed\",\n          backgroundColor: \"white\",\n          borderColor: \"#333333\",\n          borderStyle: \"solid\",\n          borderWidth: `${size.borderWidth}px`,\n          margin: `${size.margin}px`,\n        }}\n      >\n        {this.renderCanvasComponent()}\n        {/*this.renderZoomControls()*/}\n      </div>\n    );\n  }\n\n  protected renderCanvasComponent = () => {\n    const { alignment, highlightRows, sortBy, style, width } = this.props;\n    const { zoomPercent } = this.state;\n    const size = this.getSizing();\n    return (\n      <div>\n        <AlignmentCanvasComponent\n          id=\"alignment_canvas\"\n          alignment={alignment}\n          alignmentType={style.alignmentType}\n          positionsToStyle={style.positionsToStyle}\n          colorScheme={style.colorScheme}\n          sortBy={sortBy}\n          stageResolution={{\n            width: size.frameWidth,\n            height: size.frameHeight,\n          }}\n          highlightRows={highlightRows}\n          viewportProps={{\n            useDrag: true,\n            usePinch: true,\n            useWheel: true,\n            zoomPercent,\n          }}\n          mouseDown={this.onMouseDown}\n        />\n      </div>\n    );\n  };\n  protected onMouseDown = (x: number, y: number) => {\n    const { onClick } = this.props;\n    if (onClick) {\n      onClick(x, y);\n    }\n  };\n\n  /*\n\n  protected renderZoomControls = () => (\n    <div style={{ textAlign: \"center\", opacity: 1 }}>\n      <button onClick={this.onZoomOut}>-</button>\n      <button onClick={this.onZoomReset}>Reset</button>\n      <button onClick={this.onZoomIn}>+</button>\n    </div>\n  );\n\n  protected onZoomIn = () => {\n    const { zoomPercent } = this.state;\n    this.setState({\n      zoomPercent: Math.min(8, zoomPercent + 0.25),\n    });\n  };\n\n  protected onZoomOut = () => {\n    const { zoomPercent } = this.state;\n    this.setState({\n      // A zoomPercent of 0 will not actually zoom out!\n      zoomPercent: Math.max(0.25, zoomPercent - 0.25),\n    });\n  };\n\n  protected onZoomReset = () => {\n    this.setState({\n      zoomPercent: 1,\n    });\n  };*/\n}\n","/**\n * Base class for Ace Editor Components\n */\nimport React from \"react\";\nimport ace from \"ace-builds\";\nimport { Ace } from \"ace-builds\";\n\nexport interface IAceEditorProps {\n  readonly id: string;\n\n  text?: string;\n  fontSize?: number;\n  editorMode?: string;\n  classNames?: string;\n\n  editorLoaded?(editor: Ace.Editor): void;\n  characterSizeChanged?(newCharacterWidth: number): void;\n\n  mouseDown?(e: {\n    mouseRow: number;\n    mouseColumn: number;\n    mousePageX: number;\n    mousePageY: number;\n    //mouseContainerX: number;\n    //mouseContainerY: number;\n  }): void;\n\n  mouseMove?(e: {\n    mouseRow: number;\n    mouseColumn: number;\n    mousePageX: number;\n    mousePageY: number;\n    //mouseContainerX: number;\n    //mouseContainerY: number;\n  }): void;\n\n  mouseEnter?(): void;\n  mouseLeave?(): void;\n}\n\nexport class AceEditorComponent<\n  P extends IAceEditorProps,\n  S = {}\n> extends React.Component<P, S> {\n  private editor?: Ace.Editor;\n  private lastText?: string;\n  private lastMode?: string;\n  private element?: HTMLElement;\n  private lastElementWidth?: number;\n  private lastElementHeight?: number;\n\n  static defaultProps = {\n    fontSize: 14,\n  };\n\n  /**************************\n   *\n   *\n   * METHODS REQUIRED FROM SUBCLASSES\n   *\n   *\n   **************************/\n  getText(): string {\n    if (this.props.text) {\n      return this.props.text!;\n    }\n    throw Error(\n      \"Internal error: 'text' attribute must be provided or subclasses must implement getText()\"\n    );\n  }\n  getEditorMode(): string | undefined {\n    return this.props.editorMode;\n  }\n\n  /**************************\n   *\n   *\n   * PROTECTED METHODS\n   *\n   *\n   **************************/\n  /**\n   * Load and setup the ace editor\n   * @param el the element that will hold the ace editor.\n   */\n  protected setupEditorAndEventListeners(el: HTMLElement) {\n    this.editor = ace.edit(el);\n    this.editor.setShowPrintMargin(false);\n    this.editor.setReadOnly(true);\n    this.editor.setHighlightActiveLine(false);\n    this.editor.setHighlightGutterLine(false);\n    this.editor.setFontSize(this.props.fontSize + \"px\");\n    this.editor.renderer.setShowGutter(false);\n    this.editor.renderer.setPadding(0);\n    this.editor.renderer.$cursorLayer.element.style.display = \"none\";\n  }\n\n  /**\n   * listen to mouse events and report them to instantiator\n   */\n  protected addMouseEventListeners() {\n    if (!this.editor) {\n      throw Error(\"Editor must be defined before adding mouse listeners.\");\n    }\n\n    function getMousePosition(editor: Ace.Editor, event: Ace.AceEvent) {\n      var pos = event.getDocumentPosition();\n      var screenCoordinates = editor.renderer.textToScreenCoordinates(\n        pos.row,\n        pos.column\n      );\n      return {\n        mouseRow: pos.row,\n        mouseColumn: pos.column,\n        mousePageX: screenCoordinates.pageX,\n        mousePageY: screenCoordinates.pageY,\n        //mouseContainerX:\n        //  characterWidth * pos.column - this.editor.session.getScrollLeft(),\n        //mouseContainerY: characterWidth * pos.row ???\n      };\n    }\n\n    this.editor!.on(\"mousemove\", (e) => {\n      if (!this.props.mouseMove) {\n        return;\n      }\n      this.props.mouseMove(getMousePosition(this.editor!, e));\n    });\n\n    this.editor!.on(\"mousedown\", (e) => {\n      if (!this.props.mouseDown) {\n        return;\n      }\n      this.props.mouseDown(getMousePosition(this.editor!, e));\n    });\n\n    return this.editor;\n  }\n\n  /**\n   * update the text in the editor and set the editor to use that\n   * mode (if provided).\n   * @param newText\n   * @param modeName the mode name for highlighting this ace editor. For alignments, this can\n   *                 be defined as follows:\n   *    const modeName = \"ace/mode/\" + this.props.alignment.getName();\n   *    defineNewAlignmentMode(modeName, this.props.alignment);\n   *    setText()\n   * @throws an error if the editor is not yet defined.\n   */\n  protected setText() {\n    if (!this.editor) {\n      throw Error(\"Editor must be defined to call setText()\");\n    }\n    //only update if needed\n    if (this.props.fontSize + \"px\" !== this.editor.getFontSize()) {\n      this.editor.setFontSize(this.props.fontSize + \"px\");\n      if (\n        this.props.characterSizeChanged &&\n        this.editor.renderer.characterWidth\n      ) {\n        this.props.characterSizeChanged(this.editor.renderer.characterWidth);\n      }\n    }\n    if (this.lastMode !== this.getEditorMode()) {\n      const newMode = this.getEditorMode();\n      this.editor.session.setMode(newMode!);\n      this.lastMode = newMode;\n    }\n    if (!this.lastText || this.lastText !== this.getText()) {\n      this.editor.selectAll();\n      this.editor.removeLines();\n      const newText = this.getText();\n      this.editor.insert(newText);\n      this.lastText = newText;\n    }\n  }\n\n  /**\n   * The initial editor load function. Will only run a single time.\n   * @param e the HTMLelment that will hold the ace editor\n   */\n  protected initialLoad(e: HTMLDivElement | null) {\n    if (e && !this.editor) {\n      //only run if editor not loaded\n      this.element = e;\n      this.lastElementWidth = e.clientWidth;\n      this.lastElementHeight = e.clientHeight;\n      this.setupEditorAndEventListeners(e);\n      this.addMouseEventListeners();\n      this.setText();\n      if (this.props.editorLoaded) {\n        this.props.editorLoaded(this.editor!); //inform parent of loading.\n      }\n    }\n  }\n\n  /**************************\n   *\n   *\n   * REACT METHODS\n   *\n   *\n   **************************/\n  componentDidUpdate() {\n    if (!this.editor || !this.element) {\n      throw Error(\n        \"internal error - componentDidUpdate called before editor initialized\"\n      );\n    }\n    this.setText(); //smart and will update only if needed.\n    if (\n      this.element.clientWidth !== this.lastElementWidth ||\n      this.element.clientHeight !== this.lastElementHeight\n    ) {\n      this.lastElementWidth = this.element.clientWidth;\n      this.lastElementHeight = this.element.clientHeight;\n      this.editor.resize();\n    }\n    return false;\n  }\n\n  render() {\n    return (\n      <div\n        className={this.props.classNames}\n        onMouseEnter={() => {\n          if (this.props.mouseEnter) {\n            this.props.mouseEnter();\n          }\n        }}\n        onMouseLeave={() => {\n          if (this.props.mouseLeave) {\n            this.props.mouseLeave();\n          }\n        }}\n      >\n        <div id={this.props.id} ref={(e) => this.initialLoad(e)}></div>\n      </div>\n    );\n  }\n}\n","import { Alignment, SequenceSortOptions } from \"../common/Alignment\";\nimport { AceEditorComponent, IAceEditorProps } from \"./AceEditorComponent\";\n\nexport interface IAceMultipleSequenceAlignmentProps extends IAceEditorProps {\n  alignment: Alignment;\n  sortBy?: SequenceSortOptions;\n}\n\nexport class AceMultipleSequenceAlignmentComponent extends AceEditorComponent<\n  IAceMultipleSequenceAlignmentProps,\n  {}\n> {\n  static defaultProps = {\n    sortBy: SequenceSortOptions.INPUT,\n    fontSize: 14,\n  };\n\n  getText(): string {\n    return this.props.alignment\n      .getSequences(this.props.sortBy)\n      .map((x) => x.sequence)\n      .join(\"\\n\");\n  }\n  getEditorMode() {\n    return this.props.alignment.getAceEditorMode();\n  }\n}\n","import { AceMultipleSequenceAlignmentComponent } from \"./AceMultipleSequenceAlignmentComponent\";\n\nexport class AceConsensusSequenceComponent extends AceMultipleSequenceAlignmentComponent {\n  getText() {\n    return this.props.alignment\n      .getConsensus()\n      .map((letter) => {\n        return letter.letter;\n      })\n      .join(\"\");\n  }\n}\n","import { AceMultipleSequenceAlignmentComponent } from \"./AceMultipleSequenceAlignmentComponent\";\n\nexport class AceTargetSequenceComponent extends AceMultipleSequenceAlignmentComponent {\n  getText() {\n    return this.props.alignment.getTargetSequence().sequence;\n  }\n}\n","import { Alignment } from \"../common/Alignment\";\nimport { AceEditorComponent, IAceEditorProps } from \"./AceEditorComponent\";\n\nexport interface IAceTextualRulerComponentProps extends IAceEditorProps {\n  alignment: Alignment;\n}\n\nexport default class AceTextualRulerComponent extends AceEditorComponent<\n  IAceTextualRulerComponentProps,\n  {}\n> {\n  /**\n   * Generate a string axis (positional information) with one character per position\n   * through the maxLength. Taken from alignmentviewer 1.0:\n   *     https://github.com/sanderlab/alignmentviewer\n   * May want to implement this better in the future (SVG + sliding tooltip for cursor?)\n   * @param maxLength\n   */\n  static generateTextualRuler(maxLength: number): string {\n    let s = \"\"; // should be a better way to do this to be honest\n    for (let i = 1; i <= maxLength + 1; i++) {\n      const Q = i % 10 === 0;\n      const Q5 = !Q && i % 5 === 0;\n      s += Q ? \"|\" : Q5 ? \":\" : \".\";\n      if (!Q) {\n        continue;\n      }\n      const sn = \"\" + i;\n      const np = s.length - sn.length - 1; // where num starts\n      if (np < 0) {\n        continue;\n      }\n      s = s.substr(0, np) + sn + \"|\";\n    }\n    return s; // this.hruler = s.replace(/ /g, '.');\n  }\n\n  getText(): string {\n    return AceTextualRulerComponent.generateTextualRuler(\n      this.props.alignment.getMaxSequenceLength()\n    );\n  }\n  getEditorMode() {\n    return undefined;\n  }\n}\n","import React from \"react\";\nimport \"./AlignmentViewer.scss\";\nimport { Ace } from \"ace-builds\";\nimport { Alignment, SequenceSortOptions } from \"../common/Alignment\";\nimport { ScrollSync, ScrollType } from \"../common/ScrollSync\";\nimport { SequenceLogoComponent, LOGO_TYPES } from \"./SequenceLogoComponent\";\nimport { SequenceConservationComponent } from \"./SequenceConservationComponent\";\nimport {\n  AminoAcidAlignmentStyle,\n  NucleotideAlignmentStyle,\n  PositionsToStyle,\n} from \"../common/MolecularStyles\";\nimport { MiniMapComponent } from \"./MiniMapComponent\";\nimport { AceMultipleSequenceAlignmentComponent } from \"./AceMultipleSequenceAlignmentComponent\";\nimport { AceConsensusSequenceComponent } from \"./AceConsensusSequenceComponent\";\nimport { AceTargetSequenceComponent } from \"./AceTargetSequenceComponent\";\nimport AceTextualRulerComponent from \"./AceTextualRulerComponent\";\nimport { AceEditorComponent } from \"./AceEditorComponent\";\n\nexport type IAlignmentViewerProps = {\n  alignment: Alignment;\n} & Partial<DefaultPropsTypes>;\n\ntype DefaultPropsTypes = Readonly<typeof defaultProps>;\n\nconst defaultProps = {\n  style: new AminoAcidAlignmentStyle() as\n    | AminoAcidAlignmentStyle\n    | NucleotideAlignmentStyle,\n  logoPlotStyle: LOGO_TYPES.LETTERS as LOGO_TYPES,\n  zoomLevel: 13 as number,\n  sortBy: SequenceSortOptions.INPUT as SequenceSortOptions,\n  showMiniMap: false as boolean,\n  showAnnotations: true as boolean,\n};\n\ninterface IAlignmentViewerState {\n  aceCharacterWidth: number;\n  aceEditors: Ace.Editor[];\n  alignmentEditorVisibleFirstRow?: number;\n  alignmentEditorVisibleLastRow?: number;\n\n  windowWidth: number;\n  windowHeight: number;\n}\n\nexport class AlignmentViewer extends React.Component<\n  IAlignmentViewerProps,\n  IAlignmentViewerState\n> {\n  static defaultProps = defaultProps;\n\n  constructor(props: IAlignmentViewerProps) {\n    super(props);\n\n    this.state = {\n      aceEditors: [],\n      aceCharacterWidth: 0,\n      windowWidth: window.innerWidth,\n      windowHeight: window.innerHeight,\n    };\n\n    //setup scroll groups\n    ScrollSync.getInstance().setScrollerGroup(\n      \"horizontal\",\n      ScrollType.horizontal\n    );\n    ScrollSync.getInstance().setScrollerGroup(\"vertical\", ScrollType.vertical);\n  }\n\n  private handleCharacterSizeChanged = (newCharSize: number) => {\n    if (this.state.aceCharacterWidth !== newCharSize) {\n      this.setState({\n        aceCharacterWidth: newCharSize,\n      });\n    }\n  };\n\n  private aceEditorLoaded = (\n    id: string,\n    editor: Ace.Editor,\n    scrollSyncDirection: ScrollType\n  ) => {\n    //console.log(\"_aceEditorLoaded id =\" + id);\n\n    let scrollSync = ScrollSync.getInstance();\n    if (\n      scrollSyncDirection === ScrollType.horizontal ||\n      scrollSyncDirection === ScrollType.both\n    ) {\n      scrollSync.registerScroller(editor, \"horizontal\");\n    }\n    if (\n      scrollSyncDirection === ScrollType.vertical ||\n      scrollSyncDirection === ScrollType.both\n    ) {\n      scrollSync.registerScroller(editor, \"vertical\");\n    }\n    this.setState({\n      aceCharacterWidth: editor.renderer.characterWidth, //todo: check if the same always.\n      aceEditors: [editor].concat(this.state.aceEditors),\n    });\n\n    //track visible rows to show in canvas MSA\n    if (id === \"ace-alignment\") {\n      editor.renderer.on(\"afterRender\", () => {\n        // BREAKS LOGO, rerenders everything below and kills performance. React lifecycle stuff.\n        setTimeout(() => {\n          this.setState({\n            alignmentEditorVisibleFirstRow: editor.renderer.getFirstFullyVisibleRow(),\n            alignmentEditorVisibleLastRow: editor.renderer.getLastFullyVisibleRow(),\n          });\n        });\n      });\n    }\n  };\n\n  private generateWidget(\n    className: string,\n    annotation: string | JSX.Element,\n    content: JSX.Element,\n    addAsElementToScrollSync?: boolean\n  ) {\n    return (\n      <div className={`av-widget ${className}`}>\n        <div className=\"av-annotation\">{annotation}</div>\n        <div\n          className=\"av-content\"\n          ref={(e) => {\n            if (e && addAsElementToScrollSync) {\n              //TODO: move into separate component .. Ref can be null here and\n              //      also good to keep track of removal / addition for scroll sync\n              //console.log(\"the ref is:\", e);\n              let scrollSync = ScrollSync.getInstance();\n              scrollSync.registerScroller(e, \"horizontal\", true);\n            }\n          }}\n        >\n          {content}\n        </div>\n      </div>\n    );\n  }\n\n  protected windowDimensionsUpdated = () => {\n    this.setState({\n      windowWidth: window.innerWidth,\n      windowHeight: window.innerHeight,\n    });\n  };\n\n  componentDidMount() {\n    window.addEventListener(\"resize\", this.windowDimensionsUpdated);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"resize\", this.windowDimensionsUpdated);\n  }\n\n  render() {\n    if (!this.props.alignment) {\n      return null;\n    }\n\n    const annotationClass = this.props.showAnnotations\n      ? \"\"\n      : \" annotation-closed\";\n\n    return (\n      <div className={`alignment_viewer${annotationClass}`}>\n        {this.renderMiniMap()}\n        {/*<div id=\"column_mouseover\"></div>*/}\n\n        {this.generateWidget(\n          \"av-conservation-gaps\",\n          \"Conservation / gaps:\",\n          this.renderConservationBox(),\n          true\n        )}\n\n        {this.generateWidget(\n          \"av-sequence-logo\",\n          \"Logo:\",\n          this.renderSequenceLogo(),\n          true\n        )}\n\n        {this.generateWidget(\n          \"av-consensus-seq\",\n          \"Consensus sequence:\",\n          this.renderConsensusQueryBox()\n        )}\n\n        {this.generateWidget(\n          \"av-target-seq\",\n          \"Query sequence:\",\n          this.renderQuerySeqBox()\n        )}\n\n        {this.generateWidget(\n          \"av-position-indicator\",\n          \"Position:\",\n          this.renderPositionBox()\n        )}\n\n        {this.generateWidget(\n          \"av-ace-msa\",\n          this.renderAlignmentAnnotationBox(),\n          this.renderAlignmentBox()\n        )}\n\n        {/*\n        //this is where we would add the webgl msa ..\n        this.generateWidget(\n          \"av-webgl-msa\",\n          \"\",\n          this.renderDatatableBox()\n        )*/}\n      </div>\n    );\n  }\n\n  protected renderSequenceLogo = () => (\n    <div\n      className={\n        `logo_box ${this.props.style!.alignmentType.className} ` +\n        `${this.props.style!.colorScheme.className} ` +\n        `${PositionsToStyle.ALL.className}`\n      }\n    >\n      {\n        <SequenceLogoComponent\n          id=\"sequence_logo\"\n          alignment={this.props.alignment}\n          glyphWidth={this.state.aceCharacterWidth}\n          logoType={this.props.logoPlotStyle}\n        />\n      }\n    </div>\n  );\n\n  protected renderConservationBox = () => (\n    <SequenceConservationComponent\n      id=\"sequence_conservation\"\n      alignment={this.props.alignment}\n      characterWidth={this.state.aceCharacterWidth}\n    />\n  );\n\n  protected renderConsensusQueryBox = () => (\n    <div className=\"consensusseq_box\">\n      <AceConsensusSequenceComponent\n        id=\"ace-consensusseq\"\n        alignment={this.props.alignment}\n        fontSize={this.props.zoomLevel}\n        classNames={[\n          this.props.style!.residueDetail.className,\n          this.props.style!.alignmentType.className,\n          this.props.style!.positionsToStyle.className,\n          this.props.style!.colorScheme.className,\n        ].join(\" \")}\n        editorLoaded={(editor) => {\n          this.aceEditorLoaded(\n            \"ace-consensusseq\",\n            editor,\n            ScrollType.horizontal\n          );\n        }}\n      ></AceConsensusSequenceComponent>\n    </div>\n  );\n\n  protected renderQuerySeqBox = () => (\n    <div className=\"queryseq_box\">\n      <AceTargetSequenceComponent\n        id=\"ace-queryseq\"\n        alignment={this.props.alignment}\n        fontSize={this.props.zoomLevel}\n        sortBy={this.props.sortBy}\n        classNames={[\n          this.props.style!.residueDetail.className,\n          this.props.style!.alignmentType.className,\n          this.props.style!.positionsToStyle.className,\n          this.props.style!.colorScheme.className,\n        ].join(\" \")}\n        editorLoaded={(editor) => {\n          this.aceEditorLoaded(\"ace-queryseq\", editor, ScrollType.horizontal);\n        }}\n      ></AceTargetSequenceComponent>\n    </div>\n  );\n\n  protected renderPositionBox = () => (\n    <div className=\"position_box\">\n      {\n        <AceTextualRulerComponent\n          id=\"ace-positions\"\n          alignment={this.props.alignment}\n          fontSize={this.props.zoomLevel}\n          editorLoaded={(editor) => {\n            this.aceEditorLoaded(\n              \"ace-positions\",\n              editor,\n              ScrollType.horizontal\n            );\n          }}\n          mouseEnter={() => {\n            //console.log(\"mouse entered position box\");\n          }}\n          mouseLeave={() => {\n            //console.log(\"mouse left position box\");\n          }}\n          mouseMove={(e) => {\n            //console.log(\"mouse moved in position box\", e);\n          }}\n          mouseDown={(e) => {\n            //console.log(\"mouse down in position box\", e);\n          }}\n        />\n      }\n    </div>\n  );\n\n  protected renderAlignmentBox = () => (\n    <div className=\"alignment_box\">\n      <AceMultipleSequenceAlignmentComponent\n        id=\"ace-alignment\"\n        alignment={this.props.alignment}\n        fontSize={this.props.zoomLevel}\n        sortBy={this.props.sortBy}\n        classNames={[\n          this.props.style!.residueDetail.className,\n          this.props.style!.alignmentType.className,\n          this.props.style!.positionsToStyle.className,\n          this.props.style!.colorScheme.className,\n        ].join(\" \")}\n        characterSizeChanged={this.handleCharacterSizeChanged}\n        editorLoaded={(editor) => {\n          this.aceEditorLoaded(\"ace-alignment\", editor, ScrollType.both);\n        }}\n      ></AceMultipleSequenceAlignmentComponent>\n    </div>\n  );\n\n  protected renderAlignmentAnnotationBox = () => (\n    <div className=\"alignment_metadata_box\">\n      <AceEditorComponent\n        id=\"ace-alignment-metadata\"\n        text={this.props.alignment\n          .getSequences(this.props.sortBy)\n          .map((x) => x.id)\n          .join(\"\\n\")}\n        fontSize={this.props.zoomLevel}\n        editorLoaded={(editor) => {\n          this.aceEditorLoaded(\n            \"ace-alignment-metadata\",\n            editor,\n            ScrollType.vertical\n          );\n        }}\n      ></AceEditorComponent>\n    </div>\n  );\n\n  protected renderMiniMap() {\n    const {\n      alignment,\n      sortBy,\n      showMiniMap,\n      style,\n      //minimapOptions,\n    } = this.props;\n    const { windowWidth, windowHeight } = this.state;\n\n    //let width, height;\n    //if (minimapOptions) {\n    //width = minimapOptions.width ?\n    //}\n    const width = Math.max(\n      300,\n      Math.min(450, alignment.getMaxSequenceLength())\n    );\n\n    const mmClassName = showMiniMap ? \"mini-map\" : \"mini-map hidden\";\n    return (\n      alignment &&\n      style && (\n        <div className={mmClassName}>\n          <MiniMapComponent\n            width={width}\n            height={windowHeight}\n            alignHorizontal={\"right\"}\n            alignment={alignment}\n            style={style}\n            sortBy={sortBy!}\n            highlightRows={\n              this.state.alignmentEditorVisibleFirstRow !== undefined &&\n              this.state.alignmentEditorVisibleLastRow !== undefined\n                ? [\n                    this.state.alignmentEditorVisibleFirstRow,\n                    this.state.alignmentEditorVisibleLastRow,\n                  ]\n                : undefined\n            }\n            onClick={this.onMinimapClick}\n          />\n        </div>\n      )\n    );\n  }\n\n  protected onMinimapClick = (x: number, y: number) => {\n    const {\n      aceEditors,\n      alignmentEditorVisibleFirstRow: alignmentEditorFirstRow,\n      alignmentEditorVisibleLastRow: alignmentEditorLastRow,\n    } = this.state;\n    let rowCount = 40;\n    if (\n      alignmentEditorFirstRow !== undefined &&\n      alignmentEditorLastRow !== undefined\n    ) {\n      rowCount = alignmentEditorLastRow - alignmentEditorFirstRow;\n    }\n\n    if (aceEditors.length >= 1) {\n      aceEditors[0].scrollToRow(Math.floor(y - rowCount / 2));\n    }\n  };\n}\n","import * as React from \"react\";\n\nexport interface IFileInputProps {\n  labelText: string;\n  onFileLoadCb?: (file: File, event: React.FormEvent) => void;\n}\n\n// Shamelessly based on from https://reactjs.org/docs/uncontrolled-components.html\nexport class FileInputComponent extends React.Component<IFileInputProps> {\n  public static defaultProps = {\n    labelText: \"Upload:\"\n  };\n\n  protected fileInput: React.RefObject<HTMLInputElement>;\n  constructor(props: IFileInputProps) {\n    super(props);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.fileInput = React.createRef();\n  }\n\n  handleSubmit(event: React.FormEvent) {\n    const { onFileLoadCb } = this.props;\n    event.preventDefault();\n    if (\n      onFileLoadCb &&\n      this.fileInput.current &&\n      this.fileInput.current.files\n    ) {\n      onFileLoadCb(this.fileInput.current.files[0], event);\n    }\n  }\n\n  render() {\n    const { labelText } = this.props;\n    return (\n      <label>\n        <strong>{labelText}</strong>\n        <input type=\"file\" ref={this.fileInput} onInput={this.handleSubmit} />\n      </label>\n    );\n  }\n}\n","import * as React from \"react\";\n\nexport interface IExampleFileProps {\n  labelText: string;\n  fileURL: string;\n  fileName: string;\n  onFileLoaded: (file: File) => void;\n  onStartLoading?: () => void;\n}\n\nexport class ExampleFileComponent extends React.Component<IExampleFileProps> {\n  render() {\n    const {\n      fileURL,\n      fileName,\n      labelText,\n      onStartLoading,\n      onFileLoaded,\n    } = this.props;\n    return (\n      <button\n        type=\"button\"\n        className=\"button-link\"\n        onClick={async (e) => {\n          if (onStartLoading) {\n            onStartLoading();\n          }\n          const f = new File(\n            [await (await fetch(`${fileURL}`)).blob()],\n            fileName\n          );\n          onFileLoaded(f);\n        }}\n      >\n        {labelText}\n      </button>\n    );\n  }\n}\n","import React from \"react\";\nimport \"./App.scss\";\nimport { Alignment, SequenceSortOptions } from \"./common/Alignment\";\nimport { AlignmentViewer } from \"./components/AlignmentViewerComponent\";\nimport {\n  AminoAcidAlignmentStyle,\n  NucleotideAlignmentStyle,\n  AlignmentStyle,\n  AlignmentTypes,\n  PositionsToStyle,\n  IColorScheme,\n  ResidueDetailTypes,\n} from \"./common/MolecularStyles\";\nimport { LOGO_TYPES } from \"./components/SequenceLogoComponent\";\nimport { FileInputComponent } from \"./components/FileInputComponent\";\nimport { ExampleFileComponent } from \"./components/ExampleFileComponent\";\n\ninterface AppProps {}\ninterface AppState {\n  alignment?: Alignment;\n  style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle;\n  sortBy: SequenceSortOptions;\n  logoPlotStyle: LOGO_TYPES;\n  zoomLevel: number;\n  showMiniMap: boolean;\n  showAnnotations: boolean;\n  showSettings: boolean;\n  loading?: boolean;\n}\n\nexport default class App extends React.Component<AppProps, AppState> {\n  constructor(props: AppProps) {\n    super(props);\n    this.state = {\n      style: new AminoAcidAlignmentStyle(),\n      logoPlotStyle: LOGO_TYPES.LETTERS, //TODO - decide NT or AA based on alignment\n      zoomLevel: 14,\n      sortBy: SequenceSortOptions.INPUT,\n      showMiniMap: false,\n      showAnnotations: true,\n      showSettings: true,\n    };\n  }\n\n  render() {\n    const {\n      alignment,\n      logoPlotStyle,\n      showAnnotations,\n      showMiniMap,\n      sortBy,\n      style,\n      zoomLevel,\n    } = this.state;\n\n    const alignmentElement = !alignment ? (\n      <></>\n    ) : (\n      <div className=\"av_holder\">\n        <AlignmentViewer\n          alignment={alignment}\n          style={style}\n          logoPlotStyle={logoPlotStyle}\n          zoomLevel={zoomLevel}\n          sortBy={sortBy}\n          showMiniMap={showMiniMap}\n          showAnnotations={showAnnotations}\n        ></AlignmentViewer>\n      </div>\n    );\n\n    return (\n      <div>\n        {this.renderSettingsBox(style)}\n        {alignmentElement}\n      </div>\n    );\n  }\n\n  /*\n  protected getAlignmentForFile = async (filename: string) => {\n    const result = await fetch(`${process.env.PUBLIC_URL}/${filename}`);\n\n    return Alignment.fromFileContents(filename, await result.text());\n  };*/\n\n  protected renderSettingsBox = (\n    style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle\n  ) => {\n    const { alignment } = this.state;\n    const alignmentDescription = alignment ? (\n      <div>\n        <h3>{alignment.getName()}</h3>\n        <h4>{`${\n          alignment.getSequences().length\n        } sequences (rows) and ${alignment.getMaxSequenceLength()} positions (columns) `}</h4>\n      </div>\n    ) : (\n      <></>\n    );\n\n    return (\n      <div className=\"settings_box\">\n        <form>\n          <div className=\"settings-header\">\n            <button\n              style={{\n                display: this.state.showSettings ? \"none\" : \"block\",\n              }}\n              type=\"button\"\n              className=\"button-link\"\n              onClick={(e) => {\n                this.setState({\n                  showSettings: true,\n                });\n              }}\n            >\n              Expand\n            </button>\n            <button\n              style={{\n                display: this.state.showSettings ? \"block\" : \"none\",\n              }}\n              type=\"button\"\n              className=\"button-link\"\n              onClick={(e) => {\n                this.setState({\n                  showSettings: false,\n                });\n              }}\n            >\n              Hide\n            </button>\n            <div>\n              <h2>{`AlignmentViewer 2.0 Settings Demo`}</h2>\n              {alignmentDescription}\n            </div>\n          </div>\n          <div\n            style={{\n              display: this.state.showSettings ? \"block\" : \"none\",\n              position: \"relative\",\n            }}\n          >\n            {this.renderAlignmentTypeLabel(style)}\n            {this.renderSortControl()}\n            {this.renderColorScheme(style)}\n            {this.renderResidueDetail(style)}\n            {this.renderPositionStyling(style)}\n            {this.renderSequenceLogo()}\n            {this.renderZoomButtons()}\n            {this.renderMiniMapToggle()}\n            {this.renderAnnotationToggle()}\n            <br></br>\n            {this.renderFileUpload()}\n            {this.renderExampleLinks()}\n            <div\n              className=\"loader\"\n              style={{\n                display: this.state.loading ? \"block\" : \"none\",\n              }}\n            ></div>\n          </div>\n        </form>\n      </div>\n    );\n  };\n\n  protected renderSortControl = () => {\n    const { sortBy } = this.state;\n    return (\n      <div>\n        <label>\n          <strong>Sort order:</strong>\n          <select\n            value={sortBy.key}\n            onChange={(e) =>\n              this.setState({\n                sortBy: SequenceSortOptions.fromKey(e.target.value)!,\n              })\n            }\n          >\n            {SequenceSortOptions.list.map((sso) => {\n              return (\n                <option value={sso.key} key={sso.key}>\n                  {sso.description}\n                </option>\n              );\n            })}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderAlignmentTypeLabel = (\n    style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle\n  ) => {\n    return (\n      <div>\n        <label>\n          <strong>Alignment Type:</strong>\n          <select\n            value={style.alignmentType.key}\n            onChange={(e) =>\n              this.setState({\n                style: AlignmentStyle.fromAlignmentType(\n                  AlignmentTypes.fromKey(e.target.value)!\n                ),\n              })\n            }\n          >\n            {AlignmentTypes.list.map((alignmentType) => {\n              return (\n                <option value={alignmentType.key} key={alignmentType.key}>\n                  {alignmentType.description}\n                </option>\n              );\n            })}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderColorScheme = (\n    style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle\n  ) => {\n    return (\n      <div>\n        <label>\n          <strong>Style:</strong>\n          <select\n            value={style.alignmentType.allColorSchemes.indexOf(\n              style.colorScheme\n            )}\n            onChange={(e) => {\n              this.setState({\n                style: {\n                  ...style!,\n                  colorScheme:\n                    style.alignmentType.allColorSchemes[\n                      parseInt(e.target.value)\n                    ],\n                },\n              });\n            }}\n          >\n            {style.alignmentType.allColorSchemes.map(\n              (colorScheme: IColorScheme, index: number) => {\n                return (\n                  <option key={index} value={index}>\n                    {colorScheme.description}\n                  </option>\n                );\n              }\n            )}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderResidueDetail = (\n    style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle\n  ) => {\n    return (\n      <div>\n        <label>\n          <strong>Residue Detail:</strong>\n          <select\n            value={style.residueDetail.key}\n            onChange={(e) => {\n              this.setState({\n                style: {\n                  ...style,\n                  residueDetail: ResidueDetailTypes.fromKey(e.target.value)!,\n                },\n              });\n            }}\n          >\n            {ResidueDetailTypes.list.map((rd) => {\n              return (\n                <option key={rd.key} value={rd.key}>\n                  {rd.description}\n                </option>\n              );\n            })}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderPositionStyling = (\n    style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle\n  ) => {\n    return (\n      <div>\n        <label>\n          <strong>Positions to Style:</strong>\n          <select\n            value={PositionsToStyle.list.indexOf(style.positionsToStyle)}\n            onChange={(e) => {\n              this.setState({\n                style: {\n                  ...style,\n                  positionsToStyle:\n                    PositionsToStyle.list[parseInt(e.target.value)],\n                },\n              });\n            }}\n          >\n            {PositionsToStyle.list.map(\n              (pts: PositionsToStyle, index: number) => {\n                return (\n                  <option key={index} value={index}>\n                    {pts.description}\n                  </option>\n                );\n              }\n            )}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderSequenceLogo = () => {\n    const { logoPlotStyle } = this.state;\n    return (\n      <div>\n        <label>\n          <strong>Sequence Logo Style:</strong>\n          <select\n            value={logoPlotStyle}\n            onChange={(e) => {\n              this.setState({\n                logoPlotStyle: e.target.value as LOGO_TYPES,\n              });\n            }}\n          >\n            {Object.values(LOGO_TYPES).map((logoType) => {\n              return (\n                <option key={logoType} value={logoType}>\n                  {logoType}\n                </option>\n              );\n            })}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderZoomButtons = () => {\n    const { zoomLevel } = this.state;\n    return (\n      <div>\n        <label>\n          <strong>Character size:</strong>\n          <div className=\"zoom-level\">\n            <button\n              type=\"button\"\n              disabled={zoomLevel < 3}\n              onClick={(e) => {\n                this.setState({\n                  zoomLevel: zoomLevel - 1,\n                });\n              }}\n            >\n              -\n            </button>\n            {zoomLevel}\n            <button\n              type=\"button\"\n              disabled={zoomLevel > 15}\n              onClick={(e) => {\n                this.setState({\n                  zoomLevel: zoomLevel + 1,\n                });\n              }}\n            >\n              +\n            </button>\n          </div>\n        </label>\n      </div>\n    );\n  };\n\n  protected renderFileUpload = () => {\n    return (\n      <div>\n        <FileInputComponent\n          labelText={\"Upload Sequence File:\"}\n          onFileLoadCb={this.onFileUpload}\n        />\n      </div>\n    );\n  };\n\n  protected renderExampleLinks = () => {\n    return (\n      <div className=\"examples\">\n        <label>\n          <strong>Example Alignments:</strong>\n\n          <ExampleFileComponent\n            labelText=\"β-lactamase\"\n            fileURL={`${process.env.PUBLIC_URL}/7fa1c5691376beab198788a726917d48_b0.4.a2m`}\n            fileName=\"7fa1c5691376beab198788a726917d48_b0.4.a2m\"\n            onFileLoaded={this.onFileUpload}\n            onStartLoading={() => this.setState({ loading: true })}\n          />\n        </label>\n      </div>\n    );\n  };\n\n  protected renderMiniMapToggle = () => {\n    return (\n      <div className=\"minimap-toggle\">\n        <label>\n          <strong>Show MiniMap:</strong>\n\n          <input\n            name=\"showMiniMap\"\n            type=\"checkbox\"\n            checked={this.state.showMiniMap}\n            onChange={(e) => {\n              const target = e.target;\n              this.setState({\n                showMiniMap: target.checked,\n              });\n            }}\n          />\n        </label>\n      </div>\n    );\n  };\n\n  protected renderAnnotationToggle = () => {\n    return (\n      <div className=\"annotation-toggle\">\n        <label>\n          <strong>Show Annotations:</strong>\n\n          <input\n            name=\"showAnnotations\"\n            type=\"checkbox\"\n            checked={this.state.showAnnotations}\n            onChange={(e) => {\n              const target = e.target;\n              this.setState({\n                showAnnotations: target.checked,\n              });\n            }}\n          />\n        </label>\n      </div>\n    );\n  };\n\n  protected onFileUpload = async (file: File) => {\n    //const fileText = await file.text(); //doesn't work in modern safari or even slightly older firefox\n    this.setState({\n      loading: true,\n    });\n    var reader = new FileReader();\n    reader.onload = (e) => {\n      const fileText = reader.result as string;\n      const alignment = Alignment.fromFileContents(file.name, fileText);\n      this.setState({\n        alignment: alignment,\n        style:\n          alignment.getPredictedType() === AlignmentTypes.NUCLEOTIDE\n            ? new NucleotideAlignmentStyle()\n            : new AminoAcidAlignmentStyle(),\n        loading: false,\n      });\n    };\n    reader.readAsText(file);\n  };\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"acePrefix\":\"ace_\",\"preAceLetterObjClass\":\"obj\",\"preAceQueryClass\":\"query\",\"preAceConsensusClass\":\"consensus\",\"aceLetterObjClass\":\"ace_obj\",\"aceQueryClass\":\"ace_query\",\"aceConsensusClass\":\"ace_consensus\",\"transparentLetterClass\":\"transparent-letters\",\"transparentBackgroundClass\":\"transparent-background\",\"aaAlignTypeClass\":\"alignment-aa\",\"ntAlignTypeClass\":\"alignment-nt\",\"styPosAllClass\":\"alignment-positions-tostyle-all\",\"styPosQueryClass\":\"alignment-positions-tostyle-query\",\"styPosQueryDiffClass\":\"alignment-positions-tostyle-query-diff\",\"styPosConsensusClass\":\"alignment-positions-tostyle-consensus\",\"styPosConsensusDiffClass\":\"alignment-positions-tostyle-consensus-diff\",\"aaStyClass_Default\":\"aa-alignment-style-default\",\"aaStyDesc_Default\":\"Default\",\"aaStyBGAlpha_Default\":\".25\",\"aaStyColorOrder_Default\":\"A,R,N,D,C,Q,E,G,H,I,L,K,M,F,P,S,T,W,Y,V\",\"aaStyColors_Default\":\"#3c0,#c00,#60c,#03f,#ff0,#60c,#03f,#3c0,#090,#3c0,#3c0,#c00,#3c0,#090,#3c0,#09f,#09f,#090,#090,#3c0\",\"aaStyClass_Hydrophobicity\":\"aa-alignment-style-hydrophobicity\",\"aaStyDesc_Hydrophobicity\":\"Hydrophobicity\",\"aaStyBGAlpha_Hydrophobicity\":\".25\",\"aaStyColorOrder_Hydrophobicity\":\"F,I,W,L,V,M,Y,C,A,T,H,G,S,Q,R,K,N,E,P,D\",\"aaStyColors_Hydrophobicity\":\"red,red,#ff0606,#ff0606,#ff4c4c,#ff5252,#f77,#ffa5a5,#ffc0c0,#e1e1ff,#d0d0ff,#b6b6ff,#a5a5ff,#9595ff,#8787ff,#6969ff,#5959ff,#4f4fff,#1d1dff,blue\",\"ntStyClass_Default\":\"nt-alignment-style-default\",\"ntStyDesc_Default\":\"Default\",\"ntStyBGAlpha_Default\":\".25\",\"ntStyColorOrder_Default\":\"A,C,G,T,U,R,Y\",\"ntStyColors_Default\":\"#5050ff,#e00000,#00c000,#e6e600,#c90,#2e8b57,#ff8c00\"};"],"sourceRoot":""}